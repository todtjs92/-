---
title: "결로예측"
author: "물 먹는 하마"
date: "7/11/2020"
output: html_document
editor_options: 
  chunk_output_type: console
---

# library
```{r library}
.libPaths('C:/library')
setwd('C:/Users/todtj/OneDrive/바탕 화면/본선/본선')

dew_point = function(temp,hum){
  a = 243.12*(log(hum/100)+ (17.62*temp)/(243.12+temp))
  b = 17.62-(log(hum/100) + (17.62*temp)/(243.12+temp))
  return(a/b)
}
library(lubridate)
library(dplyr)
library(mice)
library(xgboost)
library(forecast)
library(caret)
library(zoo)
library(xgboost)
library(caret)
```

# Preprocessing plant1
```{r Preprocessing1}
plant1_train = read.csv("plant1_train.csv")
plant1_train = plant1_train[,c(2:16)]
before = names(plant1_train)
after = vector()
for (i in 1:15){
  after = c(after, strsplit(before, "plant1_train.")[[i]][2])
}
names(plant1_train) = after
plant1_train$mea_ddhr = ymd_hm(plant1_train$mea_ddhr, tz='Asia/Seoul')

plant1_train$date = as.Date(plant1_train$mea_ddhr)

dew_point = function(temp,hum){
  a = 243.12*(log(hum/100)+ (17.62*temp)/(243.12+temp))
  b = 17.62-(log(hum/100) + (17.62*temp)/(243.12+temp))
  return(a/b)
}

z = data.frame()

plant1_train$dif = plant1_train$tem_coil_loc1 - mapply(dew_point, plant1_train[,c('tem_in_loc1')], plant1_train[,c('hum_in_loc1')])

plant1_train$hour = hour(plant1_train$mea_ddhr)
plant1_train$day = day(plant1_train$mea_ddhr)
plant1_train$month = month(plant1_train$mea_ddhr)
plant1_train$year = year(plant1_train$mea_ddhr)
plant1_train$cond_loc1 = as.factor(plant1_train$cond_loc1)
plant1_train$cond_loc2 = as.factor(plant1_train$cond_loc2)
plant1_train$cond_loc3 = as.factor(plant1_train$cond_loc3)


plant1_recent = plant1_train %>% filter(date >= '2018-06-12')
plant1_recent %>% is.na() %>% sum
imp = mice(plant1_recent[, sapply(plant1_recent, is.numeric)],seed=1)    
plant1_recent[, sapply(plant1_recent, is.numeric)] = complete(imp)

imp2 = mice(plant1_recent[, c('tem_in_loc3', 'tem_coil_loc3')],seed=1)    
plant1_recent[, c('tem_in_loc3', 'tem_coil_loc3')] = complete(imp2)

songac_tem_19 = read.csv("songac_tem_19.csv")
names(songac_tem_19) = c('day', 'hour', 'lag', 'value')
songac_tem_20 = read.csv("songac_tem_20.csv")
names(songac_tem_20) = c('day', 'hour', 'lag', 'value')

songac_hum_19 = read.csv("songac_hum_19.csv")
names(songac_hum_19) = c('day', 'hour', 'lag', 'value')
songac_hum_20 = read.csv("songac_hum_20.csv")
names(songac_hum_20) = c('day', 'hour', 'lag', 'value')

songac_rainprob_19 = read.csv("songac_rainprob_19.csv")
names(songac_rainprob_19) = c('day', 'hour', 'lag', 'value')
songac_rainprob_20 = read.csv("songac_rainprob_20.csv")
names(songac_rainprob_20) = c('day', 'hour', 'lag', 'value')

songac_ws_19 = read.csv("songac_ws_19.csv")
names(songac_ws_19) = c('day', 'hour', 'lag', 'value')
songac_ws_20 = read.csv("songac_ws_20.csv")
names(songac_ws_20) = c('day', 'hour', 'lag', 'value')

songac_wd_19 = read.csv("songac_wd_19.csv")
names(songac_wd_19) = c('day', 'hour', 'lag', 'value')
songac_wd_20 = read.csv("songac_wd_20.csv")
names(songac_wd_20) = c('day', 'hour', 'lag', 'value')

#songac 24hour
songac_hum_24 = rbind(songac_hum_19[songac_hum_19$lag == 16,], songac_hum_20[songac_hum_20$lag == 16,]) %>% na.omit()
songac_tem_24 = rbind(songac_tem_19[songac_tem_19$lag == 16,], songac_tem_20[songac_tem_20$lag == 16,]) %>% na.omit()
songac_rainprob_24 = rbind(songac_rainprob_19[songac_rainprob_19$lag == 16,], songac_rainprob_20[songac_rainprob_20$lag == 16,]) %>% na.omit()
songac_ws_24 = rbind(songac_ws_19[songac_ws_19$lag == 16,], songac_ws_20[songac_ws_20$lag == 16,]) %>% na.omit()
songac_wd_24 = rbind(songac_wd_19[songac_wd_19$lag == 16,], songac_wd_20[songac_wd_20$lag == 16,]) %>% na.omit()

#songac 48 hour
songac_hum_48 = rbind(songac_hum_19[songac_hum_19$lag == 40,], songac_hum_20[songac_hum_20$lag == 40,]) %>% na.omit()
songac_tem_48 = rbind(songac_tem_19[songac_tem_19$lag == 40,], songac_tem_20[songac_tem_20$lag == 40,]) %>% na.omit()
songac_rainprob_48 = rbind(songac_rainprob_19[songac_rainprob_19$lag == 40,], songac_rainprob_20[songac_rainprob_20$lag == 40,]) %>% na.omit()
songac_ws_48 = rbind(songac_ws_19[songac_ws_19$lag == 40,], songac_ws_20[songac_ws_20$lag == 40,]) %>% na.omit()
songac_wd_48 = rbind(songac_wd_19[songac_wd_19$lag == 40,], songac_wd_20[songac_wd_20$lag == 40,]) %>% na.omit()

songac2 = cbind(songac_hum_24, 
                     tem_24 = songac_tem_24$value, 
                     rainprob_24 = songac_rainprob_24$value,
                     ws_24 = songac_ws_24$value,
                     wd_24 = songac_wd_24$value,
                     hum_48 = songac_hum_48$value, 
                     tem_48 = songac_tem_48$value, 
                     rainprob_48 = songac_rainprob_48$value,
                     ws_48 = songac_ws_48$value,
                     wd_48 = songac_wd_48$value)


start_date = as.Date('2018-06-30')
z = as.data.frame(apply(songac2, 2, as.numeric))
z$day = as.numeric(rep(1:640, each=8))
y = sapply(z$day,function(x) start_date + ddays(x))
z$date = ymd(as.Date(y, origin='1970-01-01'), tz='Asia/Seoul')
z$hour = z$hour / 100
y = mapply(function(date, hour) date + dhours(hour), z$date, z$hour)
z$mea_ddhr = as.POSIXct(y, origin='1970-01-01')
z$date_point = as.POSIXct(y, origin='1970-01-01')
y = mapply(function(date, lag) date + dhours(lag), z$mea_ddhr, z$lag)
z$mea_ddhr = as.POSIXct(y, origin='1970-01-01')
z = cbind(mea_ddhr = z$mea_ddhr, 
                tem_24 = z$tem_24, 
                hum_24 = z$value,
                rainprob_24 = z$rainprob_24,
                ws_24 = z$ws_24,
                wd_24 = z$wd_24,
                tem_48 = z$tem_48, 
                hum_48 = z$hum_48,
                rainprob_48 = z$rainprob_48,
                ws_48 = z$ws_48,
                wd_48 = z$wd_48,
                point = z$date_point)

plant1_2 = merge(plant1_recent %>% filter(mea_ddhr >= '2018-07-01 02:00:00'), z, by.x='mea_ddhr', by.y='point', all.x=T)
plant1_2$hum_24 = na.interp(plant1_2$hum_24)
plant1_2$tem_24 = na.interp(plant1_2$tem_24)
plant1_2$rainprob_24 = na.interp(plant1_2$rainprob_24)
plant1_2$ws_24 = na.interp(plant1_2$ws_24)
plant1_2$wd_24 = na.interp(plant1_2$wd_24)
plant1_2$hum_48 = na.interp(plant1_2$hum_48)
plant1_2$tem_48 = na.interp(plant1_2$tem_48)
plant1_2$rainprob_48 = na.interp(plant1_2$rainprob_48)
plant1_2$ws_48 = na.interp(plant1_2$ws_48)
plant1_2$wd_48 = na.interp(plant1_2$wd_48)


plant1_2$wd_24 = ifelse(plant1_2$wd_24 >= 0 & plant1_2$wd_24 <45, 'North',
                      ifelse(plant1_2$wd_24 >= 315 & plant1_2$wd_24 <= 360, 'North',
                             ifelse(plant1_2$wd_24 >= 45 & plant1_2$wd_24 < 135, 'East',
                                    ifelse(plant1_2$wd_24 >= 135 & plant1_2$wd_24 < 225, 'South',
                                           ifelse(plant1_2$wd_24 >= 225 & plant1_2$wd_24 < 315, 'West', 'What')))))

plant1_2$wd_48 = ifelse(plant1_2$wd_48 >= 0 & plant1_2$wd_48 <45, 'North',
                      ifelse(plant1_2$wd_48 >= 315 & plant1_2$wd_48 <= 360, 'North',
                             ifelse(plant1_2$wd_48 >= 45 & plant1_2$wd_48 < 135, 'East',
                                    ifelse(plant1_2$wd_48 >= 135 & plant1_2$wd_48 < 225, 'South',
                                           ifelse(plant1_2$wd_48 >= 225 & plant1_2$wd_48 < 315, 'West', 'What')))))

plant1_2 = plant1_2 %>% transform( 
  wd_24_n = ifelse (plant1_2$wd_24 == 'North', 1, 0),
  wd_24_e = ifelse (plant1_2$wd_24 == 'East', 1, 0),
  wd_24_s = ifelse (plant1_2$wd_24 == 'South', 1, 0),
  wd_24_w = ifelse (plant1_2$wd_24 == 'West', 1, 0))

plant1_2 = plant1_2 %>% transform( 
  wd_48_n = ifelse (plant1_2$wd_48 == 'North', 1, 0),
  wd_48_e = ifelse (plant1_2$wd_48 == 'East', 1, 0),
  wd_48_s = ifelse (plant1_2$wd_48 == 'South', 1, 0),
  wd_48_w = ifelse (plant1_2$wd_48 == 'West', 1, 0))


plant1_2 = plant1_2 %>% transform( 
  summer_1 = ifelse (plant1_2$tem_in_loc3>20, 1, 0),
  summer_0 = ifelse (plant1_2$tem_in_loc3<=20, 1, 0),
  time_0 = ifelse (plant1_2$tem_in_loc3 >20, 1, 0),
  time_1 = ifelse (plant1_2$hour %in% c(9, 10, 11, 12, 13, 14, 15, 16, 17), 1, 0),
  time_2 = ifelse (plant1_2$hour %in% c(18, 19, 20, 21, 22, 23, 34), 1, 0))


HI = function(tem, hum){
  -42.379 + 2.04901523 * tem + 10.14333127 * hum - 
    0.22475541 * tem * hum - 6.83783 * 10 ** (-3) * tem ** 2 - 5.481717 * 10 ** (-2) * hum ** 2 +
    1.22874 * 10 ** (-3) * tem ** 2 * hum + 8.5282 * 10 ** (-4) * tem * hum ** 2 -
    1.99 * 10 ** (-6) * tem ** (2) * hum ** (2)
}

plant1_2$hi_24 = mapply(HI, plant1_2$tem_24, plant1_2$hum_24)
plant1_2$hi_48 = mapply(HI, plant1_2$tem_48, plant1_2$hum_48)
#write.csv(plant1_2, file = "plant1_2.csv", row.names = F)

plant1_z = plant1_train %>% filter(date >= '2017-05-01' & date < '2018-06-01')
imp = mice(plant1_z[, sapply(plant1_z, is.numeric)],seed=1)    
plant1_z[, sapply(plant1_z, is.numeric)] = complete(imp)

imp2 = mice(plant1_z[, c('tem_in_loc3', 'tem_coil_loc3')],seed=1)    
plant1_z[, c('tem_in_loc3', 'tem_coil_loc3')] = complete(imp2)

songac_tem_1 = read.csv("songac_tem_1.csv")
names(songac_tem_1) = c('day', 'hour', 'lag', 'value')
songac_tem_1$day = as.integer(songac_tem_1$day)
songac_tem_2 = read.csv("songac_tem_2.csv")
names(songac_tem_2) = c('day', 'hour', 'lag', 'value')

songac_hum_1 = read.csv("songac_hum_1.csv")
names(songac_hum_1) = c('day', 'hour', 'lag', 'value')
songac_hum_1$day = as.integer(songac_hum_1$day)
songac_hum_2 = read.csv("songac_hum_2.csv")
names(songac_hum_2) = c('day', 'hour', 'lag', 'value')

songac_rainprob_1 = read.csv("songac_rainprob_1.csv")
names(songac_rainprob_1) = c('day', 'hour', 'lag', 'value')
songac_rainprob_1$day = as.integer(songac_rainprob_1$day)
songac_rainprob_2 = read.csv("songac_rainprob_2.csv")
names(songac_rainprob_2) = c('day', 'hour', 'lag', 'value')

songac_6h_rain_1 = read.csv("songac_rain_1.csv")
names(songac_6h_rain_1) = c('day', 'hour', 'lag', 'value')
songac_6h_rain_1$day = as.integer(songac_6h_rain_1$day)
songac_6h_rain_2 = read.csv("songac_rain_2.csv")
names(songac_6h_rain_2) = c('day', 'hour', 'lag', 'value')

songac_ws_1 = read.csv("songac_ws_1.csv")
names(songac_ws_1) = c('day', 'hour', 'lag', 'value')
songac_ws_1$day = as.integer(songac_ws_1$day)
songac_ws_2 = read.csv("songac_ws_2.csv")
names(songac_ws_2) = c('day', 'hour', 'lag', 'value')

songac_wd_1 = read.csv("songac_wd_1.csv")
names(songac_wd_1) = c('day', 'hour', 'lag', 'value')
songac_wd_1$day = as.integer(songac_wd_1$day)
songac_wd_2 = read.csv("songac_wd_2.csv")
names(songac_wd_2) = c('day', 'hour', 'lag', 'value')

songac_hum_24 = rbind(songac_hum_1[songac_hum_1$lag == 16,], songac_hum_2[songac_hum_2$lag == 16,]) %>% na.omit()
songac_tem_24 = rbind(songac_tem_1[songac_tem_1$lag == 16,], songac_tem_2[songac_tem_2$lag == 16,]) %>% na.omit()
songac_rainprob_24 = rbind(songac_rainprob_1[songac_rainprob_1$lag == 16,], songac_rainprob_2[songac_rainprob_2$lag == 16,]) %>% na.omit()
songac_ws_24 = rbind(songac_ws_1[songac_ws_1$lag == 16,], songac_ws_2[songac_ws_2$lag == 16,]) %>% na.omit()
songac_wd_24 = rbind(songac_wd_1[songac_wd_1$lag == 16,], songac_wd_2[songac_wd_2$lag == 16,]) %>% na.omit()


songac_hum_48 = rbind(songac_hum_1[songac_hum_1$lag == 40,], songac_hum_2[songac_hum_2$lag == 40,]) %>% na.omit()
songac_tem_48 = rbind(songac_tem_1[songac_tem_1$lag == 40,], songac_tem_2[songac_tem_2$lag == 40,]) %>% na.omit()
songac_rainprob_48 = rbind(songac_rainprob_1[songac_rainprob_1$lag == 40,], songac_rainprob_2[songac_rainprob_2$lag == 40,]) %>% na.omit()
songac_ws_48 = rbind(songac_ws_1[songac_ws_1$lag == 40,], songac_ws_2[songac_ws_2$lag == 40,]) %>% na.omit()
songac_wd_48 = rbind(songac_wd_1[songac_wd_1$lag == 40,], songac_wd_2[songac_wd_2$lag == 40,]) %>% na.omit()


songac = cbind(songac_hum_24, 
                    tem_24 = songac_tem_24$value, 
                    rainprob_24 = songac_rainprob_24$value,
                    ws_24 = songac_ws_24$value,
                    wd_24 = songac_wd_24$value,
                    hum_48 = songac_hum_48$value, 
                    tem_48 = songac_tem_48$value, 
                    rainprob_48 = songac_rainprob_48$value,
                    ws_48 = songac_ws_48$value,
                    wd_48 = songac_wd_48$value)


start_date = as.Date('2017-04-30')
z2 = apply(songac, 2, as.numeric)
z2 = as.data.frame(z2)
z2$day = as.numeric(rep(1:396, each=8))
y = sapply(z2$day,function(x) start_date + ddays(x))
z2$date = ymd(as.Date(y, origin='1970-01-01'), tz='Asia/Seoul')
z2$hour = z2$hour / 100
y = mapply(function(date, hour) date + dhours(hour), z2$date, z2$hour)
z2$mea_ddhr = as.POSIXct(y, origin='1970-01-01')
z2$date_point = as.POSIXct(y, origin='1970-01-01')
y = mapply(function(date, lag) date + dhours(lag), z2$mea_ddhr, z2$lag)
z2$mea_ddhr = as.POSIXct(y, origin='1970-01-01')
z2 = cbind(mea_ddhr = z2$mea_ddhr, 
                tem_24 = z2$tem_24, 
                hum_24 = z2$value,
                rainprob_24 = z2$rainprob_24,
                ws_24 = z2$ws_24,
                wd_24 = z2$wd_24,
                tem_48 = z2$tem_48, 
                hum_48 = z2$hum_48,
                rainprob_48 = z2$rainprob_48,
                ws_48 = z2$ws_48,
                wd_48 = z2$wd_48,
                point = z2$date_point)


plant1_1 = merge(plant1_z %>% filter(mea_ddhr >= '2017-05-01 02:00:00'), z2, by.x='mea_ddhr', by.y='point', all.x=T)
plant1_1$hum_24 = na.interp(plant1_1$hum_24)
plant1_1$tem_24 = na.interp(plant1_1$tem_24)
plant1_1$rainprob_24 = na.interp(plant1_1$rainprob_24)
plant1_1$ws_24 = na.interp(plant1_1$ws_24)
plant1_1$wd_24 = na.interp(plant1_1$wd_24)
plant1_1$hum_48 = na.interp(plant1_1$hum_48)
plant1_1$tem_48 = na.interp(plant1_1$tem_48)
plant1_1$rainprob_48 = na.interp(plant1_1$rainprob_48)
plant1_1$ws_48 = na.interp(plant1_1$ws_48)
plant1_1$wd_48 = na.interp(plant1_1$wd_48)

plant1_1$wd_24 = ifelse(plant1_1$wd_24 >= 0 & plant1_1$wd_24 <45, 'North',
                      ifelse(plant1_1$wd_24 >= 315 & plant1_1$wd_24 <= 360, 'North',
                             ifelse(plant1_1$wd_24 >= 45 & plant1_1$wd_24 < 135, 'East',
                                    ifelse(plant1_1$wd_24 >= 135 & plant1_1$wd_24 < 225, 'South',
                                           ifelse(plant1_1$wd_24 >= 225 & plant1_1$wd_24 < 315, 'West', 'What')))))

plant1_1$wd_48 = ifelse(plant1_1$wd_48 >= 0 & plant1_1$wd_48 <45, 'North',
                      ifelse(plant1_1$wd_48 >= 315 & plant1_1$wd_48 <= 360, 'North',
                             ifelse(plant1_1$wd_48 >= 45 & plant1_1$wd_48 < 135, 'East',
                                    ifelse(plant1_1$wd_48 >= 135 & plant1_1$wd_48 < 225, 'South',
                                           ifelse(plant1_1$wd_48 >= 225 & plant1_1$wd_48 < 315, 'West', 'What')))))

plant1_1 = plant1_1 %>% transform( 
  wd_24_n = ifelse (plant1_1$wd_24 == 'North', 1, 0),
  wd_24_e = ifelse (plant1_1$wd_24 == 'East', 1, 0),
  wd_24_s = ifelse (plant1_1$wd_24 == 'South', 1, 0),
  wd_24_w = ifelse (plant1_1$wd_24 == 'West', 1, 0))

plant1_1 = plant1_1 %>% transform( 
  wd_48_n = ifelse (plant1_1$wd_48 == 'North', 1, 0),
  wd_48_e = ifelse (plant1_1$wd_48 == 'East', 1, 0),
  wd_48_s = ifelse (plant1_1$wd_48 == 'South', 1, 0),
  wd_48_w = ifelse (plant1_1$wd_48 == 'West', 1, 0))
plant1_1

plant1_1 = plant1_1 %>% transform( 
  summer_1 = ifelse (plant1_1$tem_in_loc3 >20, 1, 0),
  summer_0 = ifelse (plant1_1$tem_in_loc3 <=20, 1, 0),
  time_0 = ifelse (plant1_1$tem_in_loc3 >20, 1, 0),
  time_1 = ifelse (plant1_1$hour %in% c(9, 10, 11, 12, 13, 14, 15, 16, 17), 1, 0),
  time_2 = ifelse (plant1_1$hour %in% c(18, 19, 20, 21, 22, 23, 34), 1, 0))


HI = function(tem, hum){
  -42.379 + 2.04901523 * tem + 10.14333127 * hum - 
    0.22475541 * tem * hum - 6.83783 * 10 ** (-3) * tem ** 2 - 5.481717 * 10 ** (-2) * hum ** 2 +
    1.22874 * 10 ** (-3) * tem ** 2 * hum + 8.5282 * 10 ** (-4) * tem * hum ** 2 -
    1.99 * 10 ** (-6) * tem ** (2) * hum ** (2)
}

plant1_1$hi_24 = mapply(HI, plant1_1$tem_24, plant1_1$hum_24)
plant1_1$hi_48 = mapply(HI, plant1_1$tem_48, plant1_1$hum_48)

plant1_1 = plant1_1 %>% filter(mea_ddhr <= '2018-03-21 23:00:00')
write.csv(plant1_1, file = "plant1_1.csv", row.names = F)
write.csv(plant1_2, file = "plant1_2.csv", row.names = F)

```

# Preprocessing plant2
```{r Preprocessing2}
plant2_train = read.csv("plant2_train.csv")
plant2_train = plant2_train[,c(2:16)]
before = names(plant2_train)
after = vector()
for (i in 1:15){
  after = c(after, strsplit(before, "plant2_train.")[[i]][2])
}

names(plant2_train) = after

plant2_train$mea_ddhr = ymd_hm(plant2_train$mea_ddhr, tz='Asia/Seoul')

plant2_train$date = as.Date(plant2_train$mea_ddhr)

dew_point = function(temp,hum){
  a = 243.12*(log(hum/100)+ (17.62*temp)/(243.12+temp))
  b = 17.62-(log(hum/100) + (17.62*temp)/(243.12+temp))
  return(a/b)
}


plant2_train$dif = plant2_train$tem_coil_loc1 - mapply(dew_point, plant2_train[,c('tem_in_loc1')], plant2_train[,c('hum_in_loc1')])
plant2_train$hour = hour(plant2_train$mea_ddhr)
plant2_train$day = day(plant2_train$mea_ddhr)
plant2_train$month = month(plant2_train$mea_ddhr)
plant2_train$year = year(plant2_train$mea_ddhr)
plant2_train$cond_loc1 = as.factor(plant2_train$cond_loc1)
plant2_train$cond_loc2 = as.factor(plant2_train$cond_loc2)
plant2_train$cond_loc3 = as.factor(plant2_train$cond_loc3)

plant2_recent = plant2_train %>% filter(date >= '2018-06-12')
imp = mice(plant2_recent[, sapply(plant2_recent, is.numeric)],seed=1)    
plant2_recent[, sapply(plant2_recent, is.numeric)] = complete(imp)

imp2 = mice(plant2_recent[, c('tem_in_loc2', 'tem_coil_loc2', 'tem_coil_loc3')],seed=1)    
plant2_recent[, c('tem_in_loc2', 'tem_coil_loc2', 'tem_coil_loc3')] = complete(imp2)

imp3 = mice(plant2_recent[,c('tem_in_loc2', 'tem_coil_loc3')],seed=1)    
plant2_recent[,c('tem_in_loc2','tem_coil_loc3')] = complete(imp3)


plant2_2 = merge(plant2_recent %>% filter(mea_ddhr >= '2018-07-01 02:00:00'), z, by.x='mea_ddhr', by.y='point', all.x=T)
plant2_2$hum_24 = na.interp(plant2_2$hum_24)
plant2_2$tem_24 = na.interp(plant2_2$tem_24)
plant2_2$rainprob_24 = na.interp(plant2_2$rainprob_24)
plant2_2$ws_24 = na.interp(plant2_2$ws_24)
plant2_2$wd_24 = na.interp(plant2_2$wd_24)
plant2_2$hum_48 = na.interp(plant2_2$hum_48)
plant2_2$tem_48 = na.interp(plant2_2$tem_48)
plant2_2$rainprob_48 = na.interp(plant2_2$rainprob_48)
plant2_2$ws_48 = na.interp(plant2_2$ws_48)
plant2_2$wd_48 = na.interp(plant2_2$wd_48)


plant2_2$wd_24 = ifelse(plant2_2$wd_24 >= 0 & plant2_2$wd_24 <45, 'North',
                      ifelse(plant2_2$wd_24 >= 315 & plant2_2$wd_24 <= 360, 'North',
                             ifelse(plant2_2$wd_24 >= 45 & plant2_2$wd_24 < 135, 'East',
                                    ifelse(plant2_2$wd_24 >= 135 & plant2_2$wd_24 < 225, 'South',
                                           ifelse(plant2_2$wd_24 >= 225 & plant2_2$wd_24 < 315, 'West', 'What')))))

plant2_2$wd_48 = ifelse(plant2_2$wd_48 >= 0 & plant2_2$wd_48 <45, 'North',
                      ifelse(plant2_2$wd_48 >= 315 & plant2_2$wd_48 <= 360, 'North',
                             ifelse(plant2_2$wd_48 >= 45 & plant2_2$wd_48 < 135, 'East',
                                    ifelse(plant2_2$wd_48 >= 135 & plant2_2$wd_48 < 225, 'South',
                                           ifelse(plant2_2$wd_48 >= 225 & plant2_2$wd_48 < 315, 'West', 'What')))))

plant2_2 = plant2_2 %>% transform( 
  wd_24_n = ifelse (plant2_2$wd_24 == 'North', 1, 0),
  wd_24_e = ifelse (plant2_2$wd_24 == 'East', 1, 0),
  wd_24_s = ifelse (plant2_2$wd_24 == 'South', 1, 0),
  wd_24_w = ifelse (plant2_2$wd_24 == 'West', 1, 0))

plant2_2 = plant2_2 %>% transform( 
  wd_48_n = ifelse (plant2_2$wd_48 == 'North', 1, 0),
  wd_48_e = ifelse (plant2_2$wd_48 == 'East', 1, 0),
  wd_48_s = ifelse (plant2_2$wd_48 == 'South', 1, 0),
  wd_48_w = ifelse (plant2_2$wd_48 == 'West', 1, 0))


plant2_2 = plant2_2 %>% transform( 
  summer_1 = ifelse (plant2_2$tem_in_loc3>20, 1, 0),
  summer_0 = ifelse (plant2_2$tem_in_loc3<=20, 1, 0),
  time_0 = ifelse (plant2_2$tem_in_loc3 >20, 1, 0),
  time_1 = ifelse (plant2_2$hour %in% c(9, 10, 11, 12, 13, 14, 15, 16, 17), 1, 0),
  time_2 = ifelse (plant2_2$hour %in% c(18, 19, 20, 21, 22, 23, 34), 1, 0))


HI = function(tem, hum){
  -42.379 + 2.04901523 * tem + 10.14333127 * hum - 
    0.22475541 * tem * hum - 6.83783 * 10 ** (-3) * tem ** 2 - 5.481717 * 10 ** (-2) * hum ** 2 +
    1.22874 * 10 ** (-3) * tem ** 2 * hum + 8.5282 * 10 ** (-4) * tem * hum ** 2 -
    1.99 * 10 ** (-6) * tem ** (2) * hum ** (2)
}

plant2_2$hi_24 = mapply(HI, plant2_2$tem_24, plant2_2$hum_24)
plant2_2$hi_48 = mapply(HI, plant2_2$tem_48, plant2_2$hum_48)
#write.csv(plant2_2, file = "plant2_2.csv", row.names = F)

plant2_z = plant2_train %>% filter(date >= '2017-05-01' & date < '2018-06-01')
imp = mice(plant2_z[, sapply(plant2_z, is.numeric)],seed=1)    
plant2_z[, sapply(plant2_z, is.numeric)] = complete(imp)

imp2 = mice(plant2_z[, c('tem_coil_loc2', 'tem_coil_loc3')],seed=1)    
plant2_z[, c('tem_coil_loc2', 'tem_coil_loc3')] = complete(imp2)

plant2_1 = merge(plant2_z %>% filter(mea_ddhr >= '2017-05-01 02:00:00'), z2, by.x='mea_ddhr', by.y='point', all.x=T)
plant2_1$hum_24 = na.interp(plant2_1$hum_24)
plant2_1$tem_24 = na.interp(plant2_1$tem_24)
plant2_1$rainprob_24 = na.interp(plant2_1$rainprob_24)
plant2_1$ws_24 = na.interp(plant2_1$ws_24)
plant2_1$wd_24 = na.interp(plant2_1$wd_24)
plant2_1$hum_48 = na.interp(plant2_1$hum_48)
plant2_1$tem_48 = na.interp(plant2_1$tem_48)
plant2_1$rainprob_48 = na.interp(plant2_1$rainprob_48)
plant2_1$ws_48 = na.interp(plant2_1$ws_48)
plant2_1$wd_48 = na.interp(plant2_1$wd_48)

plant2_1$wd_24 = ifelse(plant2_1$wd_24 >= 0 & plant2_1$wd_24 <45, 'North',
                      ifelse(plant2_1$wd_24 >= 315 & plant2_1$wd_24 <= 360, 'North',
                             ifelse(plant2_1$wd_24 >= 45 & plant2_1$wd_24 < 135, 'East',
                                    ifelse(plant2_1$wd_24 >= 135 & plant2_1$wd_24 < 225, 'South',
                                           ifelse(plant2_1$wd_24 >= 225 & plant2_1$wd_24 < 315, 'West', 'What')))))

plant2_1$wd_48 = ifelse(plant2_1$wd_48 >= 0 & plant2_1$wd_48 <45, 'North',
                      ifelse(plant2_1$wd_48 >= 315 & plant2_1$wd_48 <= 360, 'North',
                             ifelse(plant2_1$wd_48 >= 45 & plant2_1$wd_48 < 135, 'East',
                                    ifelse(plant2_1$wd_48 >= 135 & plant2_1$wd_48 < 225, 'South',
                                           ifelse(plant2_1$wd_48 >= 225 & plant2_1$wd_48 < 315, 'West', 'What')))))

plant2_1 = plant2_1 %>% transform( 
  wd_24_n = ifelse (plant2_1$wd_24 == 'North', 1, 0),
  wd_24_e = ifelse (plant2_1$wd_24 == 'East', 1, 0),
  wd_24_s = ifelse (plant2_1$wd_24 == 'South', 1, 0),
  wd_24_w = ifelse (plant2_1$wd_24 == 'West', 1, 0))

plant2_1 = plant2_1 %>% transform( 
  wd_48_n = ifelse (plant2_1$wd_48 == 'North', 1, 0),
  wd_48_e = ifelse (plant2_1$wd_48 == 'East', 1, 0),
  wd_48_s = ifelse (plant2_1$wd_48 == 'South', 1, 0),
  wd_48_w = ifelse (plant2_1$wd_48 == 'West', 1, 0))


plant2_1 = plant2_1 %>% transform( 
  summer_1 = ifelse (plant2_1$tem_in_loc3 >20 , 1, 0),
  summer_0 = ifelse (plant2_1$tem_in_loc3 <= 20, 1, 0),
  time_0 = ifelse (plant2_1$tem_in_loc3 >20, 1, 0),
  time_1 = ifelse (plant2_1$hour %in% c(9, 10, 11, 12, 13, 14, 15, 16, 17), 1, 0),
  time_2 = ifelse (plant2_1$hour %in% c(18, 19, 20, 21, 22, 23, 34), 1, 0))


HI = function(tem, hum){
  -42.379 + 2.04901523 * tem + 10.14333127 * hum - 
    0.22475541 * tem * hum - 6.83783 * 10 ** (-3) * tem ** 2 - 5.481717 * 10 ** (-2) * hum ** 2 +
    1.22874 * 10 ** (-3) * tem ** 2 * hum + 8.5282 * 10 ** (-4) * tem * hum ** 2 -
    1.99 * 10 ** (-6) * tem ** (2) * hum ** (2)
}

plant2_1$hi_24 = mapply(HI, plant2_1$tem_24, plant2_1$hum_24)
plant2_1$hi_48 = mapply(HI, plant2_1$tem_48, plant2_1$hum_48)
str(plant2_1)
plant2_1 = plant2_1 %>% filter(mea_ddhr <= '2018-03-21 23:00:00')
write.csv(plant2_1, file = "plant2_1.csv", row.names = F)
write.csv(plant2_2, file = "plant2_2.csv", row.names = F)
```

# plant1 location1 온도, 습도, 코일 예측 24시간 후

## data load
```{r library}
plant1_1 = read.csv("plant1_1.csv")
plant1_2 = read.csv("plant1_2.csv")
plant2_1 = read.csv("plant2_1.csv")
plant2_2 = read.csv("plant2_2.csv")
```

## p1 hum_in_loc1
```{r p1_hum_in_loc1}
dataset1 = plant1_1
dataset2 = plant1_2
dataset1$mea_ddhr = ymd_hms(dataset1$mea_ddhr)
dataset2$mea_ddhr = ymd_hms(dataset2$mea_ddhr)
str(dataset1)
target1 = dataset1[dataset1$mea_ddhr >= '2017-05-02 02:00:00',]$hum_in_loc1
target2 = dataset2[dataset2$mea_ddhr >= '2018-07-02 02:00:00',]$hum_in_loc1
dataset_1 = dataset1[1:length(target1),]
dataset_2 = dataset2[1:length(target2),]
dataset = rbind(dataset_1, dataset_2)
target = c(target1, target2)
dataset = cbind(dataset, target=target)
set.seed(0)
SL=sample(1:nrow(dataset),nrow(dataset)*0.8,replace=FALSE)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]
str(TEST)
str(TRAIN2)
str(TRAIN)
TRAIN2 = TRAIN
TRAIN2$hum_24
TRAIN2$wd_24_n_hum_24_ws_24
TRAIN2$hum_24_sq_tem_24 = TRAIN2$hum_24 ** 2 * TRAIN2$tem_24
TRAIN2$summer_1_hum_24 = TRAIN2$summer_1 * TRAIN2$hum_24
TRAIN2$summer_0_hum_24 = TRAIN2$summer_0 * TRAIN2$hum_24
TRAIN2$summer_0_tem_24_sq = TRAIN2$summer_0 * TRAIN2$tem_24 ** 2
TRAIN2$wd_24_n_hum_24_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_s_hum_24_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_w_hum_24_ws_24 = TRAIN2$wd_24_w * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_n_hum_24_summer_0_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$wd_24_s_hum_24_summer_0_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0


z = TRAIN2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24', 'hi_24', 'summer_0', 'summer_1_hum_24',
               'summer_0_hum_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24')]
str(TEST2)
TEST2 = TEST
TEST2$hum_24_sq_tem_24 = TEST2$hum_24 ** 2 * TEST2$tem_24
TEST2$summer_1_hum_24 = TEST2$summer_1 * TEST2$hum_24
TEST2$summer_0_hum_24 = TEST2$summer_0 * TEST2$hum_24
TEST2$summer_0_tem_24_sq = TEST2$summer_0 * TEST2$tem_24 ** 2
TEST2$wd_24_n_hum_24_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_s_hum_24_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_w_hum_24_ws_24 = TEST2$wd_24_w * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_n_hum_24_summer_0_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0
TEST2$wd_24_s_hum_24_summer_0_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0


z2 = TEST2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24', 'hi_24', 'summer_0', 'summer_1_hum_24',
               'summer_0_hum_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24')]

dtrain = xgb.DMatrix(data = as.matrix(z), label= TRAIN$target)
dtest = xgb.DMatrix(data = as.matrix(z2), label= TEST$target)

params = list(booster = "gbtree", objective = "reg:squarederror", eta=0.01, gamma=0, max_depth=15, min_chi_24ld_weight=1, subsample=1, colsample_bytree=1)
xgb_plant1_hum_in_loc1_24 = xgb.train( params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_24d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant1_hum_in_loc1_24, dtest)
## k = xgb.importance(colnames(dtrain), model = xgb_plant1_hum_in_loc1_24)
## xgb.ggplot.importance(k, rel_to_first = TRUE, xlab = "Relative importance")
TEST$ind = seq(1:nrow(TEST))
z = data.frame(x=TEST$target, y=y_pred, t=TEST$ind)
g1 = ggplot(z) + 
  geom_line(aes(x=t, y=x, color='#348ABD')) + 
  geom_line(aes(x=t, y=y, color='#A60628')) + 
  ggtitle('24시간 후 hum_in_loc1') + 
  scale_color_manual(name='습도',
                     values = c('#348ABD', '#A60628'),
                     labels = c('실제', '예측'))

p1_hum_in_loc1_rmse = sqrt(sum((TEST$target - y_pred)^2)/length(y_pred))
```

## p1 tem_in_loc1
```{r p1_tem_in_loc1}
target1 = dataset1[dataset1$mea_ddhr >= '2017-05-02 02:00:00',]$tem_in_loc1
target2 = dataset2[dataset2$mea_ddhr >= '2018-07-02 02:00:00',]$tem_in_loc1

dataset_1 = dataset1[1:length(target1),]
dataset_2 = dataset2[1:length(target2),]
dataset = rbind(dataset_1, dataset_2)
target = c(target1, target2)
dataset = cbind(dataset, target=target)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN
TRAIN2$hum_24_sq_tem_24 = TRAIN2$hum_24 ** 2 * TRAIN2$tem_24
TRAIN2$summer_0_tem_24_sq = TRAIN2$summer_0 * TRAIN2$tem_24 ** 2
TRAIN2$wd_24_n_hum_24_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_s_hum_24_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_w_hum_24_ws_24 = TRAIN2$wd_24_w * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_n_hum_24_summer_0_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$wd_24_s_hum_24_summer_0_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$tem_in_loc1_sq_tem_24 = TRAIN2$tem_in_loc1 ** 2 * TRAIN2$tem_24


z = TRAIN2[,c('hum_24', 'tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24', 'hi_24', 'tem_in_loc1', 'tem_in_loc1_sq_tem_24')]

TEST2 = TEST
TEST2$hum_24_sq_tem_24 = TEST2$hum_24 ** 2 * TEST2$tem_24
TEST2$summer_0_tem_24_sq = TEST2$summer_0 * TEST2$tem_24 ** 2
TEST2$wd_24_n_hum_24_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_s_hum_24_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_w_hum_24_ws_24 = TEST2$wd_24_w * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_n_hum_24_summer_0_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0
TEST2$wd_24_s_hum_24_summer_0_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0
TEST2$tem_in_loc1_sq_tem_24 = TEST2$tem_in_loc1 ** 2 * TEST2$tem_24

z2 = TEST2[,c('hum_24', 'tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24', 'hi_24', 'tem_in_loc1', 'tem_in_loc1_sq_tem_24')]

library(xgboost)
dtrain = xgb.DMatrix(data = as.matrix(z), label= TRAIN$target)
dtest = xgb.DMatrix(data = as.matrix(z2), label= TEST$target)

params = list(booster = "gbtree", objective = "reg:squarederror", eta=0.01, gamma=0, max_depth=15, min_chi_24ld_weight=1, subsample=1, colsample_bytree=1)
xgb_plant1_tem_in_loc1_24 = xgb.train( params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_24d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant1_tem_in_loc1_24, dtest)
## k = xgb.importance(colnames(dtrain), model = xgb_plant1_tem_in_loc1_24)
## xgb.ggplot.importance(k, rel_to_first = TRUE, xlab = "Relative importance")
TEST$ind = seq(1:nrow(TEST))
z = data.frame(x=TEST$target, y=y_pred, t=TEST$ind)
g2 = ggplot(z) + 
  geom_line(aes(x=t, y=x, color='#348ABD')) + 
  geom_line(aes(x=t, y=y, color='#A60628')) + 
  ggtitle('24시간 후 tem_in_loc1') + 
  scale_color_manual(name='온도',
                     values = c('#348ABD', '#A60628'),
                     labels = c('실제', '예측'))

p1_tem_in_loc1_rmse = sqrt(sum((TEST$target - y_pred)^2)/length(y_pred))

```

## p1 tem_coil_LOC1
```{r p1_tem_coil_LOC1}

target1 = dataset1[dataset1$mea_ddhr >= '2017-05-02 02:00:00',]$tem_coil_loc1
target2 = dataset2[dataset2$mea_ddhr >= '2018-07-02 02:00:00',]$tem_coil_loc1
dataset_1 = dataset1[1:length(target1),]
dataset_2 = dataset2[1:length(target2),]
dataset = rbind(dataset_1, dataset_2)
target = c(target1, target2)
dataset = cbind(dataset, target=target)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN

TRAIN2$hum_24_sq_tem_24 = TRAIN2$hum_24 ** 2 * TRAIN2$tem_24
TRAIN2$summer_0_tem_24_sq = TRAIN2$summer_0 * TRAIN2$tem_24 ** 2
TRAIN2$wd_24_n_hum_24_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_s_hum_24_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_w_hum_24_ws_24 = TRAIN2$wd_24_w * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_n_hum_24_summer_0_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$wd_24_s_hum_24_summer_0_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$tem_in_loc1_sq_tem_24 = TRAIN2$tem_in_loc1 ** 2 * TRAIN2$tem_24
TRAIN2$tem_pred_loc1_24 = predict(xgb_plant1_tem_in_loc1_24, 
                                   as.matrix(TRAIN2[,c('hum_24', 'tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24',  'hi_24', 'tem_in_loc1', 'tem_in_loc1_sq_tem_24')]))

z = TRAIN2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24', 'time_1',
               'summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24', 'tem_in_loc1', 'tem_in_loc1_sq_tem_24', 'tem_coil_loc1', 'tem_pred_loc1_24')]

TEST2 = TEST

TEST2$hum_24_sq_tem_24 = TEST2$hum_24 ** 2 * TEST2$tem_24
TEST2$summer_0_tem_24_sq = TEST2$summer_0 * TEST2$tem_24 ** 2
TEST2$wd_24_n_hum_24_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_s_hum_24_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_w_hum_24_ws_24 = TEST2$wd_24_w * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_n_hum_24_summer_0_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0
TEST2$wd_24_s_hum_24_summer_0_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0
TEST2$tem_in_loc1_sq_tem_24 = TEST2$tem_in_loc1 ** 2 * TEST2$tem_24
TEST2$tem_pred_loc1_24 = predict(xgb_plant1_tem_in_loc1_24, 
                                   as.matrix(TEST2[,c('hum_24', 'tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24',  'hi_24', 'tem_in_loc1', 'tem_in_loc1_sq_tem_24')]))

z2 = TEST2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24', 'time_1',
               'summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24', 'tem_in_loc1', 'tem_in_loc1_sq_tem_24', 'tem_coil_loc1', 'tem_pred_loc1_24')]


dtrain = xgb.DMatrix(data = as.matrix(z), label= TRAIN$target)
dtest = xgb.DMatrix(data = as.matrix(z2), label= TEST$target)

params = list(booster = "gbtree", objective = "reg:squarederror", eta=0.01, gamma=0, max_depth=15, min_chi_24ld_weight=1, subsample=1, colsample_bytree=1)

xgb_plant1_tem_coil_loc1_24 = xgb.train( params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_24d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant1_tem_coil_loc1_24, dtest)
## k = xgb.importance(colnames(dtrain), model = xgb_plant1_tem_coil_loc1_24)
## xgb.ggplot.importance(k, rel_to_first = TRUE, xlab = "Relative importance")
TEST$ind = seq(1:nrow(TEST))
z = data.frame(x=TEST$target, y=y_pred, t=TEST$ind)
g3 = ggplot(z) + 
  geom_line(aes(x=t, y=x, color='#348ABD')) + 
  geom_line(aes(x=t, y=y, color='#A60628')) + 
  ggtitle('24시간 후 tem_coil_loc1') + 
  scale_color_manual(name='코일온도',
                     values = c('#348ABD', '#A60628'),
                     labels = c('실제', '예측'))

p1_tem_coil_loc1_rmse = sqrt(sum((TEST$target - y_pred)^2)/length(y_pred))
```

# plant1 location2 온도, 습도, 코일 예측 24시간 후

## p1 hum_in_loc2
```{r p1_hum_in_loc2}
target1 = dataset1[dataset1$mea_ddhr >= '2017-05-02 02:00:00',]$hum_in_loc2
target2 = dataset2[dataset2$mea_ddhr >= '2018-07-02 02:00:00',]$hum_in_loc2
dataset_1 = dataset1[1:length(target1),]
dataset_2 = dataset2[1:length(target2),]
dataset = rbind(dataset_1, dataset_2)
target = c(target1, target2)
dataset = cbind(dataset, target=target)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN
TRAIN2$hum_24_sq_tem_24 = TRAIN2$hum_24 ** 2 * TRAIN2$tem_24
TRAIN2$summer_1_hum_24 = TRAIN2$summer_1 * TRAIN2$hum_24
TRAIN2$summer_0_hum_24 = TRAIN2$summer_0 * TRAIN2$hum_24
TRAIN2$summer_0_tem_24_sq = TRAIN2$summer_0 * TRAIN2$tem_24 ** 2
TRAIN2$wd_24_n_hum_24_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_s_hum_24_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_w_hum_24_ws_24 = TRAIN2$wd_24_w * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_n_hum_24_summer_0_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$wd_24_s_hum_24_summer_0_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0


z = TRAIN2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'hi_24', 'summer_1', 'summer_0', 'summer_1_hum_24',
               'summer_0_hum_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24')]

TEST2 = TEST
TEST2$hum_24_sq_tem_24 = TEST2$hum_24 ** 2 * TEST2$tem_24
TEST2$summer_1_hum_24 = TEST2$summer_1 * TEST2$hum_24
TEST2$summer_0_hum_24 = TEST2$summer_0 * TEST2$hum_24
TEST2$summer_0_tem_24_sq = TEST2$summer_0 * TEST2$tem_24 ** 2
TEST2$wd_24_n_hum_24_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_s_hum_24_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_w_hum_24_ws_24 = TEST2$wd_24_w * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_n_hum_24_summer_0_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0
TEST2$wd_24_s_hum_24_summer_0_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0


z2 = TEST2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'hi_24', 'summer_1', 'summer_0', 'summer_1_hum_24',
               'summer_0_hum_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24')]

dtrain = xgb.DMatrix(data = as.matrix(z), label= TRAIN$target)
dtest = xgb.DMatrix(data = as.matrix(z2), label= TEST$target)

params = list(booster = "gbtree", objective = "reg:squarederror", eta=0.01, gamma=0, max_depth=15, min_chi_24ld_weight=1, subsample=1, colsample_bytree=1)

xgb_plant1_hum_in_loc2_24 = xgb.train( params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_24d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant1_hum_in_loc2_24, dtest)
## k = xgb.importance(colnames(dtrain), model = xgb_plant1_hum_in_loc2_24)
## xgb.ggplot.importance(k, rel_to_first = TRUE, xlab = "Relative importance")
TEST$ind = seq(1:nrow(TEST))
z = data.frame(x=TEST$target, y=y_pred, t=TEST$ind)
g4 = ggplot(z) + 
  geom_line(aes(x=t, y=x, color='#348ABD')) + 
  geom_line(aes(x=t, y=y, color='#A60628')) + 
  ggtitle('24시간 후 hum_in_loc2') + 
  scale_color_manual(name='습도',
                     values = c('#348ABD', '#A60628'),
                     labels = c('실제', '예측'))

p1_hum_in_loc2_rmse = sqrt(sum((TEST$target - y_pred)^2)/length(y_pred))
```

## p1 tem_in_loc2
```{r p1_tem_in_loc2}
target1 = dataset1[dataset1$mea_ddhr >= '2017-05-02 02:00:00',]$tem_in_loc2
target2 = dataset2[dataset2$mea_ddhr >= '2018-07-02 02:00:00',]$tem_in_loc2
dataset_1 = dataset1[1:length(target1),]
dataset_2 = dataset2[1:length(target2),]
dataset = rbind(dataset_1, dataset_2)
target = c(target1, target2)
dataset = cbind(dataset, target=target)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN
TRAIN2$hum_24_sq_tem_24 = TRAIN2$hum_24 ** 2 * TRAIN2$tem_24
TRAIN2$summer_0_tem_24_sq = TRAIN2$summer_0 * TRAIN2$tem_24 ** 2
TRAIN2$wd_24_n_hum_24_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_s_hum_24_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_w_hum_24_ws_24 = TRAIN2$wd_24_w * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_n_hum_24_summer_0_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$wd_24_s_hum_24_summer_0_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$tem_in_loc2_sq_tem_24 = TRAIN2$tem_in_loc2 ** 2 * TRAIN2$tem_24


z = TRAIN2[,c('hum_24', 'tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'hi_24', 'tem_in_loc2', 'tem_in_loc2_sq_tem_24')]

TEST2 = TEST
TEST2$hum_24_sq_tem_24 = TEST2$hum_24 ** 2 * TEST2$tem_24
TEST2$summer_0_tem_24_sq = TEST2$summer_0 * TEST2$tem_24 ** 2
TEST2$wd_24_n_hum_24_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_s_hum_24_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_w_hum_24_ws_24 = TEST2$wd_24_w * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_n_hum_24_summer_0_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0
TEST2$wd_24_s_hum_24_summer_0_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0
TEST2$tem_in_loc2_sq_tem_24 = TEST2$tem_in_loc2 ** 2 * TEST2$tem_24

z2 = TEST2[,c('hum_24', 'tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'hi_24', 'tem_in_loc2', 'tem_in_loc2_sq_tem_24')]


dtrain = xgb.DMatrix(data = as.matrix(z), label= TRAIN$target)
dtest = xgb.DMatrix(data = as.matrix(z2), label= TEST$target)

params = list(booster = "gbtree", objective = "reg:squarederror", eta=0.01, gamma=0, max_depth=15, min_chi_24ld_weight=1, subsample=1, colsample_bytree=1)
xgb_plant1_tem_in_loc2_24 = xgb.train( params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_24d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant1_tem_in_loc2_24, dtest)
## k = xgb.importance(colnames(dtrain), model = xgb_plant1_tem_in_loc2_24)
## xgb.ggplot.importance(k, rel_to_first = TRUE, xlab = "Relative importance")
TEST$ind = seq(1:nrow(TEST))
z = data.frame(x=TEST$target, y=y_pred, t=TEST$ind)
g5 = ggplot(z) + 
  geom_line(aes(x=t, y=x, color='#348ABD')) + 
  geom_line(aes(x=t, y=y, color='#A60628')) + 
  ggtitle('24시간 후 tem_in_loc2') + 
  scale_color_manual(name='온도',
                     values = c('#348ABD', '#A60628'),
                     labels = c('실제', '예측'))

p1_tem_in_loc2_rmse = sqrt(sum((TEST$target - y_pred)^2)/length(y_pred))
```

## p1 tem_coil_Loc2
```{r p1_tem_coil_Loc2}
target1 = dataset1[dataset1$mea_ddhr >= '2017-05-02 02:00:00',]$tem_coil_loc2
target2 = dataset2[dataset2$mea_ddhr >= '2018-07-02 02:00:00',]$tem_coil_loc2
dataset_1 = dataset1[1:length(target1),]
dataset_2 = dataset2[1:length(target2),]
dataset = rbind(dataset_1, dataset_2)
target = c(target1, target2)
dataset = cbind(dataset, target=target)
SL=sample(1:nrow(dataset),nrow(dataset)*0.8,replace=FALSE)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN

TRAIN2$hum_24_sq_tem_24 = TRAIN2$hum_24 ** 2 * TRAIN2$tem_24
TRAIN2$summer_0_tem_24_sq = TRAIN2$summer_0 * TRAIN2$tem_24 ** 2
TRAIN2$wd_24_n_hum_24_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_s_hum_24_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_w_hum_24_ws_24 = TRAIN2$wd_24_w * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_n_hum_24_summer_0_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$wd_24_s_hum_24_summer_0_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$tem_in_loc2_sq_tem_24 = TRAIN2$tem_in_loc2 ** 2 * TRAIN2$tem_24
TRAIN2$tem_pred_loc2_24 = predict(xgb_plant1_tem_in_loc2_24, 
                                   as.matrix(TRAIN2[,c('hum_24', 'tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24',  'hi_24', 'tem_in_loc2', 'tem_in_loc2_sq_tem_24')]))

z = TRAIN2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'time_1',
               'summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24', 'tem_in_loc2', 'tem_in_loc2_sq_tem_24', 'tem_coil_loc2', 'tem_pred_loc2_24')]

TEST2 = TEST

TEST2$hum_24_sq_tem_24 = TEST2$hum_24 ** 2 * TEST2$tem_24
TEST2$summer_0_tem_24_sq = TEST2$summer_0 * TEST2$tem_24 ** 2
TEST2$wd_24_n_hum_24_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_s_hum_24_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_w_hum_24_ws_24 = TEST2$wd_24_w * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_n_hum_24_summer_0_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0
TEST2$wd_24_s_hum_24_summer_0_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0
TEST2$tem_in_loc2_sq_tem_24 = TEST2$tem_in_loc2 ** 2 * TEST2$tem_24
TEST2$tem_pred_loc2_24 = predict(xgb_plant1_tem_in_loc2_24, 
                                   as.matrix(TEST2[,c('hum_24', 'tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24',  'hi_24', 'tem_in_loc2', 'tem_in_loc2_sq_tem_24')]))

z2 = TEST2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'time_1',
               'summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24', 'tem_in_loc2', 'tem_in_loc2_sq_tem_24', 'tem_coil_loc2', 'tem_pred_loc2_24')]


dtrain = xgb.DMatrix(data = as.matrix(z), label= TRAIN$target)
dtest = xgb.DMatrix(data = as.matrix(z2), label= TEST$target)

params = list(booster = "gbtree", objective = "reg:squarederror", eta=0.01, gamma=0, max_depth=15, min_chi_24ld_weight=1, subsample=1, colsample_bytree=1)

xgb_plant1_tem_coil_loc2_24 = xgb.train( params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_24d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant1_tem_coil_loc2_24, dtest)
## k = xgb.importance(colnames(dtrain), model = xgb_plant1_tem_coil_loc2_24)
## xgb.ggplot.importance(k, rel_to_first = TRUE, xlab = "Relative importance")
TEST$ind = seq(1:nrow(TEST))
z = data.frame(x=TEST$target, y=y_pred, t=TEST$ind)
g6 = ggplot(z) + 
  geom_line(aes(x=t, y=x, color='#348ABD')) + 
  geom_line(aes(x=t, y=y, color='#A60628')) + 
  ggtitle('24시간 후 tem_coil_loc2') + 
  scale_color_manual(name='코일온도',
                     values = c('#348ABD', '#A60628'),
                     labels = c('실제', '예측'))

p1_tem_coil_loc2_rmse = sqrt(sum((TEST$target - y_pred)^2)/length(y_pred))

```

# plant1 location3 온도, 습도, 코일 예측 24시간 후

## hum_in_loc3
```{r p1_hum_in_loc3}
target1 = dataset1[dataset1$mea_ddhr >= '2017-05-02 02:00:00',]$hum_in_loc3
target2 = dataset2[dataset2$mea_ddhr >= '2018-07-02 02:00:00',]$hum_in_loc3
dataset_1 = dataset1[1:length(target1),]
dataset_2 = dataset2[1:length(target2),]
dataset = rbind(dataset_1, dataset_2)
target = c(target1, target2)
dataset = cbind(dataset, target=target)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN
TRAIN2$hum_24_sq_tem_24 = TRAIN2$hum_24 ** 2 * TRAIN2$tem_24
TRAIN2$summer_1_hum_24 = TRAIN2$summer_1 * TRAIN2$hum_24
TRAIN2$summer_0_hum_24 = TRAIN2$summer_0 * TRAIN2$hum_24
TRAIN2$summer_0_tem_24_sq = TRAIN2$summer_0 * TRAIN2$tem_24 ** 2
TRAIN2$wd_24_n_hum_24_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_s_hum_24_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_w_hum_24_ws_24 = TRAIN2$wd_24_w * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_n_hum_24_summer_0_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$wd_24_s_hum_24_summer_0_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0


z = TRAIN2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'hi_24', 'summer_1', 'summer_0', 'summer_1_hum_24',
               'summer_0_hum_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24')]

TEST2 = TEST
TEST2$hum_24_sq_tem_24 = TEST2$hum_24 ** 2 * TEST2$tem_24
TEST2$summer_1_hum_24 = TEST2$summer_1 * TEST2$hum_24
TEST2$summer_0_hum_24 = TEST2$summer_0 * TEST2$hum_24
TEST2$summer_0_tem_24_sq = TEST2$summer_0 * TEST2$tem_24 ** 2
TEST2$wd_24_n_hum_24_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_s_hum_24_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_w_hum_24_ws_24 = TEST2$wd_24_w * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_n_hum_24_summer_0_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0
TEST2$wd_24_s_hum_24_summer_0_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0


z2 = TEST2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'hi_24', 'summer_1', 'summer_0', 'summer_1_hum_24',
               'summer_0_hum_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24')]

dtrain = xgb.DMatrix(data = as.matrix(z), label= TRAIN$target)
dtest = xgb.DMatrix(data = as.matrix(z2), label= TEST$target)

params = list(booster = "gbtree", objective = "reg:squarederror", eta=0.01, gamma=0, max_depth=15, min_chi_24ld_weight=1, subsample=1, colsample_bytree=1)

xgb_plant1_hum_in_loc3_24 = xgb.train( params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_24d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant1_hum_in_loc3_24, dtest)
## k = xgb.importance(colnames(dtrain), model = xgb_plant1_hum_in_loc3_24)
## xgb.ggplot.importance(k, rel_to_first = TRUE, xlab = "Relative importance")
TEST$ind = seq(1:nrow(TEST))
z = data.frame(x=TEST$target, y=y_pred, t=TEST$ind)
g24 = ggplot(z) + 
  geom_line(aes(x=t, y=x, color='#348ABD')) + 
  geom_line(aes(x=t, y=y, color='#A60628')) + 
  ggtitle('24시간 후 hum_in_loc3') + 
  scale_color_manual(name='습도',
                     values = c('#348ABD', '#A60628'),
                     labels = c('실제', '예측'))

p1_hum_in_loc3_rmse = sqrt(sum((TEST$target - y_pred)^2)/length(y_pred))

```

## tem_in_loc3
```{r p1_tem_in_loc3}
target1 = dataset1[dataset1$mea_ddhr >= '2017-05-02 02:00:00',]$tem_in_loc3
target2 = dataset2[dataset2$mea_ddhr >= '2018-07-02 02:00:00',]$tem_in_loc3
dataset_1 = dataset1[1:length(target1),]
dataset_2 = dataset2[1:length(target2),]
dataset = rbind(dataset_1, dataset_2)
target = c(target1, target2)
dataset = cbind(dataset, target=target)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN
TRAIN2$hum_24_sq_tem_24 = TRAIN2$hum_24 ** 2 * TRAIN2$tem_24
TRAIN2$summer_0_tem_24_sq = TRAIN2$summer_0 * TRAIN2$tem_24 ** 2
TRAIN2$wd_24_n_hum_24_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_s_hum_24_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_w_hum_24_ws_24 = TRAIN2$wd_24_w * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_n_hum_24_summer_0_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$wd_24_s_hum_24_summer_0_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$tem_in_loc3_sq_tem_24 = TRAIN2$tem_in_loc3 ** 2 * TRAIN2$tem_24


z = TRAIN2[,c('hum_24', 'tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'hi_24', 'tem_in_loc3', 'tem_in_loc3_sq_tem_24')]

TEST2 = TEST
TEST2$hum_24_sq_tem_24 = TEST2$hum_24 ** 2 * TEST2$tem_24
TEST2$summer_0_tem_24_sq = TEST2$summer_0 * TEST2$tem_24 ** 2
TEST2$wd_24_n_hum_24_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_s_hum_24_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_w_hum_24_ws_24 = TEST2$wd_24_w * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_n_hum_24_summer_0_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0
TEST2$wd_24_s_hum_24_summer_0_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0
TEST2$tem_in_loc3_sq_tem_24 = TEST2$tem_in_loc3 ** 2 * TEST2$tem_24

z2 = TEST2[,c('hum_24', 'tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'hi_24', 'tem_in_loc3', 'tem_in_loc3_sq_tem_24')]


dtrain = xgb.DMatrix(data = as.matrix(z), label= TRAIN$target)
dtest = xgb.DMatrix(data = as.matrix(z2), label= TEST$target)

params = list(booster = "gbtree", objective = "reg:squarederror", eta=0.01, gamma=0, max_depth=15, min_chi_24ld_weight=1, subsample=1, colsample_bytree=1)

xgb_plant1_tem_in_loc3_24 = xgb.train( params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_24d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant1_tem_in_loc3_24, dtest)
## k = xgb.importance(colnames(dtrain), model = xgb8)
## xgb.ggplot.importance(k, rel_to_first = TRUE, xlab = "Relative importance")
TEST$ind = seq(1:nrow(TEST))
z = data.frame(x=TEST$target, y=y_pred, t=TEST$ind)
g25 = ggplot(z) + 
  geom_line(aes(x=t, y=x, color='#348ABD')) + 
  geom_line(aes(x=t, y=y, color='#A60628')) + 
  ggtitle('24시간 후 tem_in_loc3') + 
  scale_color_manual(name='온도',
                     values = c('#348ABD', '#A60628'),
                     labels = c('실제', '예측'))

p1_tem_in_loc3_rmse = sqrt(sum((TEST$target - y_pred)^2)/length(y_pred))
```

## tem_coil_loc3
```{r p2_tem_coil_loc3}

target1 = dataset1[dataset1$mea_ddhr >= '2017-05-02 02:00:00',]$tem_coil_loc3
target2 = dataset2[dataset2$mea_ddhr >= '2018-07-02 02:00:00',]$tem_coil_loc3
dataset_1 = dataset1[1:length(target1),]
dataset_2 = dataset2[1:length(target2),]
dataset = rbind(dataset_1, dataset_2)
target = c(target1, target2)
dataset = cbind(dataset, target=target)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN

TRAIN2$hum_24_sq_tem_24 = TRAIN2$hum_24 ** 2 * TRAIN2$tem_24
TRAIN2$summer_0_tem_24_sq = TRAIN2$summer_0 * TRAIN2$tem_24 ** 2
TRAIN2$wd_24_n_hum_24_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_s_hum_24_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_w_hum_24_ws_24 = TRAIN2$wd_24_w * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_n_hum_24_summer_0_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$wd_24_s_hum_24_summer_0_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$tem_in_loc3_sq_tem_24 = TRAIN2$tem_in_loc3 ** 2 * TRAIN2$tem_24
TRAIN2$tem_pred_loc3_24 = predict(xgb_plant1_tem_in_loc3_24, 
                                   as.matrix(TRAIN2[,c('hum_24', 'tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24',  'hi_24', 'tem_in_loc3', 'tem_in_loc3_sq_tem_24')]))

z = TRAIN2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'time_1',
               'summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24', 'tem_in_loc3', 'tem_in_loc3_sq_tem_24', 'tem_coil_loc3', 'tem_pred_loc3_24')]

TEST2 = TEST

TEST2$hum_24_sq_tem_24 = TEST2$hum_24 ** 2 * TEST2$tem_24
TEST2$summer_0_tem_24_sq = TEST2$summer_0 * TEST2$tem_24 ** 2
TEST2$wd_24_n_hum_24_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_s_hum_24_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_w_hum_24_ws_24 = TEST2$wd_24_w * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_n_hum_24_summer_0_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0
TEST2$wd_24_s_hum_24_summer_0_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0
TEST2$tem_in_loc3_sq_tem_24 = TEST2$tem_in_loc3 ** 2 * TEST2$tem_24
TEST2$tem_pred_loc3_24 = predict(xgb_plant1_tem_in_loc3_24, 
                                   as.matrix(TEST2[,c('hum_24', 'tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24',  'hi_24', 'tem_in_loc3', 'tem_in_loc3_sq_tem_24')]))

z2 = TEST2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'time_1',
               'summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24', 'tem_in_loc3', 'tem_in_loc3_sq_tem_24', 'tem_coil_loc3', 'tem_pred_loc3_24')]


dtrain = xgb.DMatrix(data = as.matrix(z), label= TRAIN$target)
dtest = xgb.DMatrix(data = as.matrix(z2), label= TEST$target)

params = list(booster = "gbtree", objective = "reg:squarederror", eta=0.01, gamma=0, max_depth=15, min_chi_24ld_weight=1, subsample=1, colsample_bytree=1)

xgb_plant1_tem_coil_loc3_24 = xgb.train( params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_24d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant1_tem_coil_loc3_24, dtest)
## k = xgb.importance(colnames(dtrain), model = xgb_plant1_tem_coil_loc3_24)
## xgb.ggplot.importance(k, rel_to_first = TRUE, xlab = "Relative importance")
TEST$ind = seq(1:nrow(TEST))
z = data.frame(x=TEST$target, y=y_pred, t=TEST$ind)
g26 = ggplot(z) + 
  geom_line(aes(x=t, y=x, color='#348ABD')) + 
  geom_line(aes(x=t, y=y, color='#A60628')) + 
  ggtitle('24시간 후 tem_coil_loc3') + 
  scale_color_manual(name='코일온도',
                     values = c('#348ABD', '#A60628'),
                     labels = c('실제', '예측'))

p1_tem_coil_loc3_rmse = sqrt(sum((TEST$target - y_pred)^2)/length(y_pred))
```


# plant2 location1 온도, 습도, 코일 예측 24시간 후

## p2 hum_in_loc1
```{r p2_hum_in_loc1}
dataset3 = plant2_1
dataset4 = plant2_2
dataset3$mea_ddhr = ymd_hms(dataset3$mea_ddhr)
dataset4$mea_ddhr = ymd_hms(dataset4$mea_ddhr)

target1 = dataset3[dataset3$mea_ddhr >= '2017-05-02 02:00:00',]$hum_in_loc1
target2 = dataset4[dataset4$mea_ddhr >= '2018-07-02 02:00:00',]$hum_in_loc1
dataset_3 = dataset3[1:length(target1),]
dataset_4 = dataset4[1:length(target2),]
dataset = rbind(dataset_3, dataset_4)
target = c(target1, target2)
dataset = cbind(dataset, target=target)
set.seed(0)
SL=sample(1:nrow(dataset),nrow(dataset)*0.8,replace=FALSE)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN
TRAIN2$hum_24_sq_tem_24 = TRAIN2$hum_24 ** 2 * TRAIN2$tem_24
TRAIN2$summer_1_hum_24 = TRAIN2$summer_1 * TRAIN2$hum_24
TRAIN2$summer_0_hum_24 = TRAIN2$summer_0 * TRAIN2$hum_24
TRAIN2$summer_0_tem_24_sq = TRAIN2$summer_0 * TRAIN2$tem_24 ** 2
TRAIN2$wd_24_n_hum_24_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_s_hum_24_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_w_hum_24_ws_24 = TRAIN2$wd_24_w * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_n_hum_24_summer_0_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$wd_24_s_hum_24_summer_0_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0


z = TRAIN2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24', 'hi_24', 'summer_0', 'summer_1_hum_24',
               'summer_0_hum_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24')]

TEST2 = TEST
TEST2$hum_24_sq_tem_24 = TEST2$hum_24 ** 2 * TEST2$tem_24
TEST2$summer_1_hum_24 = TEST2$summer_1 * TEST2$hum_24
TEST2$summer_0_hum_24 = TEST2$summer_0 * TEST2$hum_24
TEST2$summer_0_tem_24_sq = TEST2$summer_0 * TEST2$tem_24 ** 2
TEST2$wd_24_n_hum_24_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_s_hum_24_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_w_hum_24_ws_24 = TEST2$wd_24_w * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_n_hum_24_summer_0_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0
TEST2$wd_24_s_hum_24_summer_0_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0


z2 = TEST2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24', 'hi_24', 'summer_0', 'summer_1_hum_24',
               'summer_0_hum_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24')]

dtrain = xgb.DMatrix(data = as.matrix(z), label= TRAIN$target)
dtest = xgb.DMatrix(data = as.matrix(z2), label= TEST$target)

params = list(booster = "gbtree", objective = "reg:squarederror", eta=0.01, gamma=0, max_depth=15, min_chi_24ld_weight=1, subsample=1, colsample_bytree=1)
xgb_plant2_hum_in_loc1_24 = xgb.train( params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_24d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant2_hum_in_loc1_24, dtest)
## k = xgb.importance(colnames(dtrain), model = xgb_plant2_hum_in_loc1_24)
## xgb.ggplot.importance(k, rel_to_first = TRUE, xlab = "Relative importance")
TEST$ind = seq(1:nrow(TEST))
z = data.frame(x=TEST$target, y=y_pred, t=TEST$ind)
g1 = ggplot(z) + 
  geom_line(aes(x=t, y=x, color='#348ABD')) + 
  geom_line(aes(x=t, y=y, color='#A60628')) + 
  ggtitle('24시간 후 hum_in_loc1') + 
  scale_color_manual(name='습도',
                     values = c('#348ABD', '#A60628'),
                     labels = c('실제', '예측'))

p2_hum_in_loc1_rmse = sqrt(sum((TEST$target - y_pred)^2)/length(y_pred))
```

## p2 tem_in_loc1
```{r p2_tem_in_loc1}
target1 = dataset3[dataset3$mea_ddhr >= '2017-05-02 02:00:00',]$tem_in_loc1
target2 = dataset4[dataset4$mea_ddhr >= '2018-07-02 02:00:00',]$tem_in_loc1
dataset_3 = dataset3[1:length(target1),]
dataset_4 = dataset4[1:length(target2),]
dataset = rbind(dataset_3, dataset_4)
target = c(target1, target2)
dataset = cbind(dataset, target=target)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN
TRAIN2$hum_24_sq_tem_24 = TRAIN2$hum_24 ** 2 * TRAIN2$tem_24
TRAIN2$summer_0_tem_24_sq = TRAIN2$summer_0 * TRAIN2$tem_24 ** 2
TRAIN2$wd_24_n_hum_24_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_s_hum_24_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_w_hum_24_ws_24 = TRAIN2$wd_24_w * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_n_hum_24_summer_0_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$wd_24_s_hum_24_summer_0_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$tem_in_loc1_sq_tem_24 = TRAIN2$tem_in_loc1 ** 2 * TRAIN2$tem_24


z = TRAIN2[,c('hum_24', 'tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24', 'hi_24', 'tem_in_loc1', 'tem_in_loc1_sq_tem_24')]

TEST2 = TEST
TEST2$hum_24_sq_tem_24 = TEST2$hum_24 ** 2 * TEST2$tem_24
TEST2$summer_0_tem_24_sq = TEST2$summer_0 * TEST2$tem_24 ** 2
TEST2$wd_24_n_hum_24_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_s_hum_24_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_w_hum_24_ws_24 = TEST2$wd_24_w * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_n_hum_24_summer_0_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0
TEST2$wd_24_s_hum_24_summer_0_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0
TEST2$tem_in_loc1_sq_tem_24 = TEST2$tem_in_loc1 ** 2 * TEST2$tem_24

z2 = TEST2[,c('hum_24', 'tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24', 'hi_24', 'tem_in_loc1', 'tem_in_loc1_sq_tem_24')]

library(xgboost)
dtrain = xgb.DMatrix(data = as.matrix(z), label= TRAIN$target)
dtest = xgb.DMatrix(data = as.matrix(z2), label= TEST$target)

params = list(booster = "gbtree", objective = "reg:squarederror", eta=0.01, gamma=0, max_depth=15, min_chi_24ld_weight=1, subsample=1, colsample_bytree=1)
xgb_plant2_tem_in_loc1_24 = xgb.train( params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_24d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant2_tem_in_loc1_24, dtest)
## k = xgb.importance(colnames(dtrain), model = xgb_plant2_tem_in_loc1_24)
## xgb.ggplot.importance(k, rel_to_first = TRUE, xlab = "Relative importance")
TEST$ind = seq(1:nrow(TEST))
z = data.frame(x=TEST$target, y=y_pred, t=TEST$ind)
g2 = ggplot(z) + 
  geom_line(aes(x=t, y=x, color='#348ABD')) + 
  geom_line(aes(x=t, y=y, color='#A60628')) + 
  ggtitle('24시간 후 tem_in_loc1') + 
  scale_color_manual(name='온도',
                     values = c('#348ABD', '#A60628'),
                     labels = c('실제', '예측'))

p2_tem_in_loc1_rmse = sqrt(sum((TEST$target - y_pred)^2)/length(y_pred))

```

## p2 tem_coil_LOC1
```{r p2_tem_coil_LOC1}

target1 = dataset3[dataset3$mea_ddhr >= '2017-05-02 02:00:00',]$tem_coil_loc1
target2 = dataset4[dataset4$mea_ddhr >= '2018-07-02 02:00:00',]$tem_coil_loc1
dataset_3 = dataset3[1:length(target1),]
dataset_4 = dataset4[1:length(target2),]
dataset = rbind(dataset_3, dataset_4)
target = c(target1, target2)
dataset = cbind(dataset, target=target)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN

TRAIN2$hum_24_sq_tem_24 = TRAIN2$hum_24 ** 2 * TRAIN2$tem_24
TRAIN2$summer_0_tem_24_sq = TRAIN2$summer_0 * TRAIN2$tem_24 ** 2
TRAIN2$wd_24_n_hum_24_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_s_hum_24_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_w_hum_24_ws_24 = TRAIN2$wd_24_w * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_n_hum_24_summer_0_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$wd_24_s_hum_24_summer_0_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$tem_in_loc1_sq_tem_24 = TRAIN2$tem_in_loc1 ** 2 * TRAIN2$tem_24
TRAIN2$tem_pred_loc1_24 = predict(xgb_plant2_tem_in_loc1_24, 
                                   as.matrix(TRAIN2[,c('hum_24', 'tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24',  'hi_24', 'tem_in_loc1', 'tem_in_loc1_sq_tem_24')]))

z = TRAIN2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24', 'time_1',
               'summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24', 'tem_in_loc1', 'tem_in_loc1_sq_tem_24', 'tem_coil_loc1', 'tem_pred_loc1_24')]

TEST2 = TEST

TEST2$hum_24_sq_tem_24 = TEST2$hum_24 ** 2 * TEST2$tem_24
TEST2$summer_0_tem_24_sq = TEST2$summer_0 * TEST2$tem_24 ** 2
TEST2$wd_24_n_hum_24_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_s_hum_24_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_w_hum_24_ws_24 = TEST2$wd_24_w * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_n_hum_24_summer_0_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0
TEST2$wd_24_s_hum_24_summer_0_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0
TEST2$tem_in_loc1_sq_tem_24 = TEST2$tem_in_loc1 ** 2 * TEST2$tem_24
TEST2$tem_pred_loc1_24 = predict(xgb_plant2_tem_in_loc1_24, 
                                   as.matrix(TEST2[,c('hum_24', 'tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24',  'hi_24', 'tem_in_loc1', 'tem_in_loc1_sq_tem_24')]))

z2 = TEST2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24', 'time_1',
               'summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24', 'tem_in_loc1', 'tem_in_loc1_sq_tem_24', 'tem_coil_loc1', 'tem_pred_loc1_24')]


dtrain = xgb.DMatrix(data = as.matrix(z), label= TRAIN$target)
dtest = xgb.DMatrix(data = as.matrix(z2), label= TEST$target)

params = list(booster = "gbtree", objective = "reg:squarederror", eta=0.01, gamma=0, max_depth=15, min_chi_24ld_weight=1, subsample=1, colsample_bytree=1)

xgb_plant2_tem_coil_loc1_24 = xgb.train( params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_24d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant2_tem_coil_loc1_24, dtest)
## k = xgb.importance(colnames(dtrain), model = xgb_plant2_tem_coil_loc1_24)
## xgb.ggplot.importance(k, rel_to_first = TRUE, xlab = "Relative importance")
TEST$ind = seq(1:nrow(TEST))
z = data.frame(x=TEST$target, y=y_pred, t=TEST$ind)
g3 = ggplot(z) + 
  geom_line(aes(x=t, y=x, color='#348ABD')) + 
  geom_line(aes(x=t, y=y, color='#A60628')) + 
  ggtitle('24시간 후 tem_coil_loc1') + 
  scale_color_manual(name='코일온도',
                     values = c('#348ABD', '#A60628'),
                     labels = c('실제', '예측'))

p2_tem_coil_loc1_rmse = sqrt(sum((TEST$target - y_pred)^2)/length(y_pred))
```

# plant2 location2 온도, 습도, 코일 예측 24시간 후

## p2 hum_in_loc2
```{r p2_hum_in_loc2}
target1 = dataset3[dataset3$mea_ddhr >= '2017-05-02 02:00:00',]$hum_in_loc2
target2 = dataset4[dataset4$mea_ddhr >= '2018-07-02 02:00:00',]$hum_in_loc2
dataset_3 = dataset3[1:length(target1),]
dataset_4 = dataset4[1:length(target2),]
dataset = rbind(dataset_3, dataset_4)
target = c(target1, target2)
dataset = cbind(dataset, target=target)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN
TRAIN2$hum_24_sq_tem_24 = TRAIN2$hum_24 ** 2 * TRAIN2$tem_24
TRAIN2$summer_1_hum_24 = TRAIN2$summer_1 * TRAIN2$hum_24
TRAIN2$summer_0_hum_24 = TRAIN2$summer_0 * TRAIN2$hum_24
TRAIN2$summer_0_tem_24_sq = TRAIN2$summer_0 * TRAIN2$tem_24 ** 2
TRAIN2$wd_24_n_hum_24_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_s_hum_24_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_w_hum_24_ws_24 = TRAIN2$wd_24_w * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_n_hum_24_summer_0_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$wd_24_s_hum_24_summer_0_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0


z = TRAIN2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'hi_24', 'summer_1', 'summer_0', 'summer_1_hum_24',
               'summer_0_hum_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24')]

TEST2 = TEST
TEST2$hum_24_sq_tem_24 = TEST2$hum_24 ** 2 * TEST2$tem_24
TEST2$summer_1_hum_24 = TEST2$summer_1 * TEST2$hum_24
TEST2$summer_0_hum_24 = TEST2$summer_0 * TEST2$hum_24
TEST2$summer_0_tem_24_sq = TEST2$summer_0 * TEST2$tem_24 ** 2
TEST2$wd_24_n_hum_24_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_s_hum_24_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_w_hum_24_ws_24 = TEST2$wd_24_w * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_n_hum_24_summer_0_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0
TEST2$wd_24_s_hum_24_summer_0_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0


z2 = TEST2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'hi_24', 'summer_1', 'summer_0', 'summer_1_hum_24',
               'summer_0_hum_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24')]

dtrain = xgb.DMatrix(data = as.matrix(z), label= TRAIN$target)
dtest = xgb.DMatrix(data = as.matrix(z2), label= TEST$target)

params = list(booster = "gbtree", objective = "reg:squarederror", eta=0.01, gamma=0, max_depth=15, min_chi_24ld_weight=1, subsample=1, colsample_bytree=1)

xgb_plant2_hum_in_loc2_24 = xgb.train( params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_24d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant2_hum_in_loc2_24, dtest)
## k = xgb.importance(colnames(dtrain), model = xgb_plant2_hum_in_loc2_24)
## xgb.ggplot.importance(k, rel_to_first = TRUE, xlab = "Relative importance")
TEST$ind = seq(1:nrow(TEST))
z = data.frame(x=TEST$target, y=y_pred, t=TEST$ind)
g4 = ggplot(z) + 
  geom_line(aes(x=t, y=x, color='#348ABD')) + 
  geom_line(aes(x=t, y=y, color='#A60628')) + 
  ggtitle('24시간 후 hum_in_loc2') + 
  scale_color_manual(name='습도',
                     values = c('#348ABD', '#A60628'),
                     labels = c('실제', '예측'))

p2_hum_in_loc2_rmse = sqrt(sum((TEST$target - y_pred)^2)/length(y_pred))
```

## p2 tem_in_loc2
```{r p2_tem_in_loc2}
target1 = dataset3[dataset3$mea_ddhr >= '2017-05-02 02:00:00',]$tem_in_loc2
target2 = dataset4[dataset4$mea_ddhr >= '2018-07-02 02:00:00',]$tem_in_loc2
dataset_3 = dataset3[1:length(target1),]
dataset_4 = dataset4[1:length(target2),]
dataset = rbind(dataset_3, dataset_4)
target = c(target1, target2)
dataset = cbind(dataset, target=target)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN
TRAIN2$hum_24_sq_tem_24 = TRAIN2$hum_24 ** 2 * TRAIN2$tem_24
TRAIN2$summer_0_tem_24_sq = TRAIN2$summer_0 * TRAIN2$tem_24 ** 2
TRAIN2$wd_24_n_hum_24_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_s_hum_24_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_w_hum_24_ws_24 = TRAIN2$wd_24_w * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_n_hum_24_summer_0_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$wd_24_s_hum_24_summer_0_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$tem_in_loc2_sq_tem_24 = TRAIN2$tem_in_loc2 ** 2 * TRAIN2$tem_24


z = TRAIN2[,c('hum_24', 'tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'hi_24', 'tem_in_loc2', 'tem_in_loc2_sq_tem_24')]

TEST2 = TEST
TEST2$hum_24_sq_tem_24 = TEST2$hum_24 ** 2 * TEST2$tem_24
TEST2$summer_0_tem_24_sq = TEST2$summer_0 * TEST2$tem_24 ** 2
TEST2$wd_24_n_hum_24_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_s_hum_24_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_w_hum_24_ws_24 = TEST2$wd_24_w * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_n_hum_24_summer_0_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0
TEST2$wd_24_s_hum_24_summer_0_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0
TEST2$tem_in_loc2_sq_tem_24 = TEST2$tem_in_loc2 ** 2 * TEST2$tem_24

z2 = TEST2[,c('hum_24', 'tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'hi_24', 'tem_in_loc2', 'tem_in_loc2_sq_tem_24')]


dtrain = xgb.DMatrix(data = as.matrix(z), label= TRAIN$target)
dtest = xgb.DMatrix(data = as.matrix(z2), label= TEST$target)

params = list(booster = "gbtree", objective = "reg:squarederror", eta=0.01, gamma=0, max_depth=15, min_chi_24ld_weight=1, subsample=1, colsample_bytree=1)
xgb_plant2_tem_in_loc2_24 = xgb.train( params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_24d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant2_tem_in_loc2_24, dtest)
## k = xgb.importance(colnames(dtrain), model = xgb_plant2_tem_in_loc2_24)
## xgb.ggplot.importance(k, rel_to_first = TRUE, xlab = "Relative importance")
TEST$ind = seq(1:nrow(TEST))
z = data.frame(x=TEST$target, y=y_pred, t=TEST$ind)
g5 = ggplot(z) + 
  geom_line(aes(x=t, y=x, color='#348ABD')) + 
  geom_line(aes(x=t, y=y, color='#A60628')) + 
  ggtitle('24시간 후 tem_in_loc2') + 
  scale_color_manual(name='온도',
                     values = c('#348ABD', '#A60628'),
                     labels = c('실제', '예측'))

p2_tem_in_loc2_rmse = sqrt(sum((TEST$target - y_pred)^2)/length(y_pred))
```

## p2 tem_coil_Loc2
```{r p2_tem_coil_Loc2}
target1 = dataset3[dataset3$mea_ddhr >= '2017-05-02 02:00:00',]$tem_coil_loc2
target2 = dataset4[dataset4$mea_ddhr >= '2018-07-02 02:00:00',]$tem_coil_loc2
dataset_3 = dataset3[1:length(target1),]
dataset_4 = dataset4[1:length(target2),]
dataset = rbind(dataset_3, dataset_4)
target = c(target1, target2)
dataset = cbind(dataset, target=target)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN

TRAIN2$hum_24_sq_tem_24 = TRAIN2$hum_24 ** 2 * TRAIN2$tem_24
TRAIN2$summer_0_tem_24_sq = TRAIN2$summer_0 * TRAIN2$tem_24 ** 2
TRAIN2$wd_24_n_hum_24_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_s_hum_24_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_w_hum_24_ws_24 = TRAIN2$wd_24_w * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_n_hum_24_summer_0_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$wd_24_s_hum_24_summer_0_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$tem_in_loc2_sq_tem_24 = TRAIN2$tem_in_loc2 ** 2 * TRAIN2$tem_24
TRAIN2$tem_pred_loc2_24 = predict(xgb_plant2_tem_in_loc2_24, 
                                   as.matrix(TRAIN2[,c('hum_24', 'tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24',  'hi_24', 'tem_in_loc2', 'tem_in_loc2_sq_tem_24')]))

z = TRAIN2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'time_1',
               'summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24', 'tem_in_loc2', 'tem_in_loc2_sq_tem_24', 'tem_coil_loc2', 'tem_pred_loc2_24')]

TEST2 = TEST

TEST2$hum_24_sq_tem_24 = TEST2$hum_24 ** 2 * TEST2$tem_24
TEST2$summer_0_tem_24_sq = TEST2$summer_0 * TEST2$tem_24 ** 2
TEST2$wd_24_n_hum_24_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_s_hum_24_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_w_hum_24_ws_24 = TEST2$wd_24_w * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_n_hum_24_summer_0_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0
TEST2$wd_24_s_hum_24_summer_0_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0
TEST2$tem_in_loc2_sq_tem_24 = TEST2$tem_in_loc2 ** 2 * TEST2$tem_24
TEST2$tem_pred_loc2_24 = predict(xgb_plant2_tem_in_loc2_24, 
                                   as.matrix(TEST2[,c('hum_24', 'tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24',  'hi_24', 'tem_in_loc2', 'tem_in_loc2_sq_tem_24')]))

z2 = TEST2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'time_1',
               'summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24', 'tem_in_loc2', 'tem_in_loc2_sq_tem_24', 'tem_coil_loc2', 'tem_pred_loc2_24')]


dtrain = xgb.DMatrix(data = as.matrix(z), label= TRAIN$target)
dtest = xgb.DMatrix(data = as.matrix(z2), label= TEST$target)

params = list(booster = "gbtree", objective = "reg:squarederror", eta=0.01, gamma=0, max_depth=15, min_chi_24ld_weight=1, subsample=1, colsample_bytree=1)

xgb_plant2_tem_coil_loc2_24 = xgb.train( params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_24d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant2_tem_coil_loc2_24, dtest)
## k = xgb.importance(colnames(dtrain), model = xgb_plant2_tem_coil_loc2_24)
## xgb.ggplot.importance(k, rel_to_first = TRUE, xlab = "Relative importance")
TEST$ind = seq(1:nrow(TEST))
z = data.frame(x=TEST$target, y=y_pred, t=TEST$ind)
g6 = ggplot(z) + 
  geom_line(aes(x=t, y=x, color='#348ABD')) + 
  geom_line(aes(x=t, y=y, color='#A60628')) + 
  ggtitle('24시간 후 tem_coil_loc2') + 
  scale_color_manual(name='코일온도',
                     values = c('#348ABD', '#A60628'),
                     labels = c('실제', '예측'))

p2_tem_coil_loc2_rmse = sqrt(sum((TEST$target - y_pred)^2)/length(y_pred))
```

# plant2 location3 온도, 습도, 코일 예측 24시간 후

## hum_in_loc3
```{r p2_hum_in_loc3}
target1 = dataset3[dataset3$mea_ddhr >= '2017-05-02 02:00:00',]$hum_in_loc3
target2 = dataset4[dataset4$mea_ddhr >= '2018-07-02 02:00:00',]$hum_in_loc3
dataset_3 = dataset3[1:length(target1),]
dataset_4 = dataset4[1:length(target2),]
dataset = rbind(dataset_3, dataset_4)
target = c(target1, target2)
dataset = cbind(dataset, target=target)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN
TRAIN2$hum_24_sq_tem_24 = TRAIN2$hum_24 ** 2 * TRAIN2$tem_24
TRAIN2$summer_1_hum_24 = TRAIN2$summer_1 * TRAIN2$hum_24
TRAIN2$summer_0_hum_24 = TRAIN2$summer_0 * TRAIN2$hum_24
TRAIN2$summer_0_tem_24_sq = TRAIN2$summer_0 * TRAIN2$tem_24 ** 2
TRAIN2$wd_24_n_hum_24_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_s_hum_24_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_w_hum_24_ws_24 = TRAIN2$wd_24_w * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_n_hum_24_summer_0_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$wd_24_s_hum_24_summer_0_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0


z = TRAIN2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'hi_24', 'summer_1', 'summer_0', 'summer_1_hum_24',
               'summer_0_hum_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24')]

TEST2 = TEST
TEST2$hum_24_sq_tem_24 = TEST2$hum_24 ** 2 * TEST2$tem_24
TEST2$summer_1_hum_24 = TEST2$summer_1 * TEST2$hum_24
TEST2$summer_0_hum_24 = TEST2$summer_0 * TEST2$hum_24
TEST2$summer_0_tem_24_sq = TEST2$summer_0 * TEST2$tem_24 ** 2
TEST2$wd_24_n_hum_24_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_s_hum_24_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_w_hum_24_ws_24 = TEST2$wd_24_w * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_n_hum_24_summer_0_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0
TEST2$wd_24_s_hum_24_summer_0_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0


z2 = TEST2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'hi_24', 'summer_1', 'summer_0', 'summer_1_hum_24',
               'summer_0_hum_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24')]

dtrain = xgb.DMatrix(data = as.matrix(z), label= TRAIN$target)
dtest = xgb.DMatrix(data = as.matrix(z2), label= TEST$target)

params = list(booster = "gbtree", objective = "reg:squarederror", eta=0.01, gamma=0, max_depth=15, min_chi_24ld_weight=1, subsample=1, colsample_bytree=1)

xgb_plant2_hum_in_loc3_24 = xgb.train( params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_24d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant2_hum_in_loc3_24, dtest)
## k = xgb.importance(colnames(dtrain), model = xgb_plant2_hum_in_loc3_24)
## xgb.ggplot.importance(k, rel_to_first = TRUE, xlab = "Relative importance")
TEST$ind = seq(1:nrow(TEST))
z = data.frame(x=TEST$target, y=y_pred, t=TEST$ind)
g24 = ggplot(z) + 
  geom_line(aes(x=t, y=x, color='#348ABD')) + 
  geom_line(aes(x=t, y=y, color='#A60628')) + 
  ggtitle('24시간 후 hum_in_loc3') + 
  scale_color_manual(name='습도',
                     values = c('#348ABD', '#A60628'),
                     labels = c('실제', '예측'))

p2_hum_in_loc3_rmse = sqrt(sum((TEST$target - y_pred)^2)/length(y_pred))

```

## tem_in_loc3
```{r p2_tem_in_loc3}
target1 = dataset3[dataset3$mea_ddhr >= '2017-05-02 02:00:00',]$tem_in_loc3
target2 = dataset4[dataset4$mea_ddhr >= '2018-07-02 02:00:00',]$tem_in_loc3
dataset_3 = dataset3[1:length(target1),]
dataset_4 = dataset4[1:length(target2),]
dataset = rbind(dataset_3, dataset_4)
target = c(target1, target2)
dataset = cbind(dataset, target=target)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN
TRAIN2$hum_24_sq_tem_24 = TRAIN2$hum_24 ** 2 * TRAIN2$tem_24
TRAIN2$summer_0_tem_24_sq = TRAIN2$summer_0 * TRAIN2$tem_24 ** 2
TRAIN2$wd_24_n_hum_24_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_s_hum_24_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_w_hum_24_ws_24 = TRAIN2$wd_24_w * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_n_hum_24_summer_0_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$wd_24_s_hum_24_summer_0_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$tem_in_loc3_sq_tem_24 = TRAIN2$tem_in_loc3 ** 2 * TRAIN2$tem_24


z = TRAIN2[,c('hum_24', 'tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'hi_24', 'tem_in_loc3', 'tem_in_loc3_sq_tem_24')]

TEST2 = TEST
TEST2$hum_24_sq_tem_24 = TEST2$hum_24 ** 2 * TEST2$tem_24
TEST2$summer_0_tem_24_sq = TEST2$summer_0 * TEST2$tem_24 ** 2
TEST2$wd_24_n_hum_24_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_s_hum_24_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_w_hum_24_ws_24 = TEST2$wd_24_w * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_n_hum_24_summer_0_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0
TEST2$wd_24_s_hum_24_summer_0_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0
TEST2$tem_in_loc3_sq_tem_24 = TEST2$tem_in_loc3 ** 2 * TEST2$tem_24

z2 = TEST2[,c('hum_24', 'tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'hi_24', 'tem_in_loc3', 'tem_in_loc3_sq_tem_24')]


dtrain = xgb.DMatrix(data = as.matrix(z), label= TRAIN$target)
dtest = xgb.DMatrix(data = as.matrix(z2), label= TEST$target)

params = list(booster = "gbtree", objective = "reg:squarederror", eta=0.01, gamma=0, max_depth=15, min_chi_24ld_weight=1, subsample=1, colsample_bytree=1)

xgb_plant2_tem_in_loc3_24 = xgb.train( params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_24d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant2_tem_in_loc3_24, dtest)
## k = xgb.importance(colnames(dtrain), model = xgb8)
## xgb.ggplot.importance(k, rel_to_first = TRUE, xlab = "Relative importance")
TEST$ind = seq(1:nrow(TEST))
z = data.frame(x=TEST$target, y=y_pred, t=TEST$ind)
g25 = ggplot(z) + 
  geom_line(aes(x=t, y=x, color='#348ABD')) + 
  geom_line(aes(x=t, y=y, color='#A60628')) + 
  ggtitle('24시간 후 tem_in_loc3') + 
  scale_color_manual(name='온도',
                     values = c('#348ABD', '#A60628'),
                     labels = c('실제', '예측'))

p2_tem_in_loc3_rmse = sqrt(sum((TEST$target - y_pred)^2)/length(y_pred))
```

## tem_coil_loc3
```{r p2_tem_coil_loc3}

target1 = dataset3[dataset3$mea_ddhr >= '2017-05-02 02:00:00',]$tem_coil_loc3
target2 = dataset4[dataset4$mea_ddhr >= '2018-07-02 02:00:00',]$tem_coil_loc3
dataset_3 = dataset3[1:length(target1),]
dataset_4 = dataset4[1:length(target2),]
dataset = rbind(dataset_3, dataset_4)
target = c(target1, target2)
dataset = cbind(dataset, target=target)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN

TRAIN2$hum_24_sq_tem_24 = TRAIN2$hum_24 ** 2 * TRAIN2$tem_24
TRAIN2$summer_0_tem_24_sq = TRAIN2$summer_0 * TRAIN2$tem_24 ** 2
TRAIN2$wd_24_n_hum_24_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_s_hum_24_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_w_hum_24_ws_24 = TRAIN2$wd_24_w * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_n_hum_24_summer_0_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$wd_24_s_hum_24_summer_0_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$tem_in_loc3_sq_tem_24 = TRAIN2$tem_in_loc3 ** 2 * TRAIN2$tem_24
TRAIN2$tem_pred_loc3_24 = predict(xgb_plant2_tem_in_loc3_24, 
                                   as.matrix(TRAIN2[,c('hum_24', 'tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24',  'hi_24', 'tem_in_loc3', 'tem_in_loc3_sq_tem_24')]))

z = TRAIN2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'time_1',
               'summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24', 'tem_in_loc3', 'tem_in_loc3_sq_tem_24', 'tem_coil_loc3', 'tem_pred_loc3_24')]

TEST2 = TEST

TEST2$hum_24_sq_tem_24 = TEST2$hum_24 ** 2 * TEST2$tem_24
TEST2$summer_0_tem_24_sq = TEST2$summer_0 * TEST2$tem_24 ** 2
TEST2$wd_24_n_hum_24_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_s_hum_24_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_w_hum_24_ws_24 = TEST2$wd_24_w * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_n_hum_24_summer_0_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0
TEST2$wd_24_s_hum_24_summer_0_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0
TEST2$tem_in_loc3_sq_tem_24 = TEST2$tem_in_loc3 ** 2 * TEST2$tem_24
TEST2$tem_pred_loc3_24 = predict(xgb_plant2_tem_in_loc3_24, 
                                   as.matrix(TEST2[,c('hum_24', 'tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24',  'hi_24', 'tem_in_loc3', 'tem_in_loc3_sq_tem_24')]))

z2 = TEST2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'time_1',
               'summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24', 'tem_in_loc3', 'tem_in_loc3_sq_tem_24', 'tem_coil_loc3', 'tem_pred_loc3_24')]


dtrain = xgb.DMatrix(data = as.matrix(z), label= TRAIN$target)
dtest = xgb.DMatrix(data = as.matrix(z2), label= TEST$target)

params = list(booster = "gbtree", objective = "reg:squarederror", eta=0.01, gamma=0, max_depth=15, min_chi_24ld_weight=1, subsample=1, colsample_bytree=1)

xgb_plant2_tem_coil_loc3_24 = xgb.train( params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_24d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant2_tem_coil_loc3_24, dtest)
## k = xgb.importance(colnames(dtrain), model = xgb_plant2_tem_coil_loc3_24)
## xgb.ggplot.importance(k, rel_to_first = TRUE, xlab = "Relative importance")
TEST$ind = seq(1:nrow(TEST))
z = data.frame(x=TEST$target, y=y_pred, t=TEST$ind)
g26 = ggplot(z) + 
  geom_line(aes(x=t, y=x, color='#348ABD')) + 
  geom_line(aes(x=t, y=y, color='#A60628')) + 
  ggtitle('24시간 후 tem_coil_loc3') + 
  scale_color_manual(name='코일온도',
                     values = c('#348ABD', '#A60628'),
                     labels = c('실제', '예측'))

p2_tem_coil_loc3_rmse = sqrt(sum((TEST$target - y_pred)^2)/length(y_pred))
```


# plant1 location1 온도, 습도, 코일 예측 48시간 후

## p1 hum_in_loc1
```{r p1_hum_in_loc1}

target1 = dataset1[dataset1$mea_ddhr >= '2017-05-03 02:00:00',]$hum_in_loc1
target2 = dataset2[dataset2$mea_ddhr >= '2018-07-03 02:00:00',]$hum_in_loc1
dataset_1 = dataset1[1:length(target1),]
dataset_2 = dataset2[1:length(target2),]
dataset = rbind(dataset_1, dataset_2)
target = c(target1, target2)
dataset = cbind(dataset, target=target)
set.seed(0)
SL=sample(1:nrow(dataset),nrow(dataset)*0.8,replace=FALSE)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN
TRAIN2$hum_48_sq_tem_48 = TRAIN2$hum_48 ** 2 * TRAIN2$tem_48
TRAIN2$summer_1_hum_48 = TRAIN2$summer_1 * TRAIN2$hum_48
TRAIN2$summer_0_hum_48 = TRAIN2$summer_0 * TRAIN2$hum_48
TRAIN2$summer_0_tem_48_sq = TRAIN2$summer_0 * TRAIN2$tem_48 ** 2
TRAIN2$wd_48_n_hum_48_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_s_hum_48_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_w_hum_48_ws_48 = TRAIN2$wd_48_w * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_n_hum_48_summer_0_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0
TRAIN2$wd_48_s_hum_48_summer_0_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0


z = TRAIN2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'hi_48', 'summer_0', 'summer_1_hum_48',
               'summer_0_hum_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48')]

TEST2 = TEST
TEST2$hum_48_sq_tem_48 = TEST2$hum_48 ** 2 * TEST2$tem_48
TEST2$summer_1_hum_48 = TEST2$summer_1 * TEST2$hum_48
TEST2$summer_0_hum_48 = TEST2$summer_0 * TEST2$hum_48
TEST2$summer_0_tem_48_sq = TEST2$summer_0 * TEST2$tem_48 ** 2
TEST2$wd_48_n_hum_48_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_s_hum_48_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_w_hum_48_ws_48 = TEST2$wd_48_w * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_n_hum_48_summer_0_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0
TEST2$wd_48_s_hum_48_summer_0_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0


z2 = TEST2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'hi_48', 'summer_0', 'summer_1_hum_48',
               'summer_0_hum_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48')]

dtrain = xgb.DMatrix(data = as.matrix(z), label= TRAIN$target)
dtest = xgb.DMatrix(data = as.matrix(z2), label= TEST$target)

params = list(booster = "gbtree", objective = "reg:squarederror", eta=0.01, gamma=0, max_depth=15, min_chi_48ld_weight=1, subsample=1, colsample_bytree=1)
xgb_plant1_hum_in_loc1_48 = xgb.train( params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_48d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant1_hum_in_loc1_48, dtest)
## k = xgb.importance(colnames(dtrain), model = xgb_plant1_hum_in_loc1_48)
## xgb.ggplot.importance(k, rel_to_first = TRUE, xlab = "Relative importance")
TEST$ind = seq(1:nrow(TEST))
z = data.frame(x=TEST$target, y=y_pred, t=TEST$ind)
g1 = ggplot(z) + 
  geom_line(aes(x=t, y=x, color='#348ABD')) + 
  geom_line(aes(x=t, y=y, color='#A60628')) + 
  ggtitle('24시간 후 hum_in_loc1') + 
  scale_color_manual(name='습도',
                     values = c('#348ABD', '#A60628'),
                     labels = c('실제', '예측'))

p1_hum_in_loc1_rmse_48 = sqrt(sum((TEST$target - y_pred)^2)/length(y_pred))
```

## p1 tem_in_loc1
```{r p1_tem_in_loc1}
target1 = dataset1[dataset1$mea_ddhr >= '2017-05-03 02:00:00',]$tem_in_loc1
target2 = dataset2[dataset2$mea_ddhr >= '2018-07-03 02:00:00',]$tem_in_loc1

dataset_1 = dataset1[1:length(target1),]
dataset_2 = dataset2[1:length(target2),]
dataset = rbind(dataset_1, dataset_2)
target = c(target1, target2)
dataset = cbind(dataset, target=target)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN
TRAIN2$hum_48_sq_tem_48 = TRAIN2$hum_48 ** 2 * TRAIN2$tem_48
TRAIN2$summer_0_tem_48_sq = TRAIN2$summer_0 * TRAIN2$tem_48 ** 2
TRAIN2$wd_48_n_hum_48_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_s_hum_48_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_w_hum_48_ws_48 = TRAIN2$wd_48_w * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_n_hum_48_summer_0_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0
TRAIN2$wd_48_s_hum_48_summer_0_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0
TRAIN2$tem_in_loc1_sq_tem_48 = TRAIN2$tem_in_loc1 ** 2 * TRAIN2$tem_48


z = TRAIN2[,c('hum_48', 'tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'hi_48', 'tem_in_loc1', 'tem_in_loc1_sq_tem_48')]

TEST2 = TEST
TEST2$hum_48_sq_tem_48 = TEST2$hum_48 ** 2 * TEST2$tem_48
TEST2$summer_0_tem_48_sq = TEST2$summer_0 * TEST2$tem_48 ** 2
TEST2$wd_48_n_hum_48_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_s_hum_48_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_w_hum_48_ws_48 = TEST2$wd_48_w * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_n_hum_48_summer_0_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0
TEST2$wd_48_s_hum_48_summer_0_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0
TEST2$tem_in_loc1_sq_tem_48 = TEST2$tem_in_loc1 ** 2 * TEST2$tem_48

z2 = TEST2[,c('hum_48', 'tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'hi_48', 'tem_in_loc1', 'tem_in_loc1_sq_tem_48')]

library(xgboost)
dtrain = xgb.DMatrix(data = as.matrix(z), label= TRAIN$target)
dtest = xgb.DMatrix(data = as.matrix(z2), label= TEST$target)

params = list(booster = "gbtree", objective = "reg:squarederror", eta=0.01, gamma=0, max_depth=15, min_chi_48ld_weight=1, subsample=1, colsample_bytree=1)
xgb_plant1_tem_in_loc1_48 = xgb.train( params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_48d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant1_tem_in_loc1_48, dtest)
## k = xgb.importance(colnames(dtrain), model = xgb_plant1_tem_in_loc1_48)
## xgb.ggplot.importance(k, rel_to_first = TRUE, xlab = "Relative importance")
TEST$ind = seq(1:nrow(TEST))
z = data.frame(x=TEST$target, y=y_pred, t=TEST$ind)
g2 = ggplot(z) + 
  geom_line(aes(x=t, y=x, color='#348ABD')) + 
  geom_line(aes(x=t, y=y, color='#A60628')) + 
  ggtitle('24시간 후 tem_in_loc1') + 
  scale_color_manual(name='온도',
                     values = c('#348ABD', '#A60628'),
                     labels = c('실제', '예측'))

p1_tem_in_loc1_rmse_48 = sqrt(sum((TEST$target - y_pred)^2)/length(y_pred))

```

## p1 tem_coil_LOC1
```{r p1_tem_coil_LOC1}

target1 = dataset1[dataset1$mea_ddhr >= '2017-05-03 02:00:00',]$tem_coil_loc1
target2 = dataset2[dataset2$mea_ddhr >= '2018-07-03 02:00:00',]$tem_coil_loc1
dataset_1 = dataset1[1:length(target1),]
dataset_2 = dataset2[1:length(target2),]
dataset = rbind(dataset_1, dataset_2)
target = c(target1, target2)
dataset = cbind(dataset, target=target)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN

TRAIN2$hum_48_sq_tem_48 = TRAIN2$hum_48 ** 2 * TRAIN2$tem_48
TRAIN2$summer_0_tem_48_sq = TRAIN2$summer_0 * TRAIN2$tem_48 ** 2
TRAIN2$wd_48_n_hum_48_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_s_hum_48_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_w_hum_48_ws_48 = TRAIN2$wd_48_w * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_n_hum_48_summer_0_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0
TRAIN2$wd_48_s_hum_48_summer_0_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0
TRAIN2$tem_in_loc1_sq_tem_48 = TRAIN2$tem_in_loc1 ** 2 * TRAIN2$tem_48
TRAIN2$tem_pred_loc1_48 = predict(xgb_plant1_tem_in_loc1_48, 
                                   as.matrix(TRAIN2[,c('hum_48', 'tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48',  'hi_48', 'tem_in_loc1', 'tem_in_loc1_sq_tem_48')]))

z = TRAIN2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'time_1',
               'summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48', 'tem_in_loc1', 'tem_in_loc1_sq_tem_48', 'tem_coil_loc1', 'tem_pred_loc1_48')]

TEST2 = TEST

TEST2$hum_48_sq_tem_48 = TEST2$hum_48 ** 2 * TEST2$tem_48
TEST2$summer_0_tem_48_sq = TEST2$summer_0 * TEST2$tem_48 ** 2
TEST2$wd_48_n_hum_48_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_s_hum_48_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_w_hum_48_ws_48 = TEST2$wd_48_w * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_n_hum_48_summer_0_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0
TEST2$wd_48_s_hum_48_summer_0_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0
TEST2$tem_in_loc1_sq_tem_48 = TEST2$tem_in_loc1 ** 2 * TEST2$tem_48
TEST2$tem_pred_loc1_48 = predict(xgb_plant1_tem_in_loc1_48, 
                                   as.matrix(TEST2[,c('hum_48', 'tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48',  'hi_48', 'tem_in_loc1', 'tem_in_loc1_sq_tem_48')]))

z2 = TEST2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'time_1',
               'summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48', 'tem_in_loc1', 'tem_in_loc1_sq_tem_48', 'tem_coil_loc1', 'tem_pred_loc1_48')]


dtrain = xgb.DMatrix(data = as.matrix(z), label= TRAIN$target)
dtest = xgb.DMatrix(data = as.matrix(z2), label= TEST$target)

params = list(booster = "gbtree", objective = "reg:squarederror", eta=0.01, gamma=0, max_depth=15, min_chi_48ld_weight=1, subsample=1, colsample_bytree=1)

xgb_plant1_tem_coil_loc1_48 = xgb.train( params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_48d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant1_tem_coil_loc1_48, dtest)
## k = xgb.importance(colnames(dtrain), model = xgb_plant1_tem_coil_loc1_48)
## xgb.ggplot.importance(k, rel_to_first = TRUE, xlab = "Relative importance")
TEST$ind = seq(1:nrow(TEST))
z = data.frame(x=TEST$target, y=y_pred, t=TEST$ind)
g3 = ggplot(z) + 
  geom_line(aes(x=t, y=x, color='#348ABD')) + 
  geom_line(aes(x=t, y=y, color='#A60628')) + 
  ggtitle('24시간 후 tem_coil_loc1') + 
  scale_color_manual(name='코일온도',
                     values = c('#348ABD', '#A60628'),
                     labels = c('실제', '예측'))

p1_tem_coil_loc1_rmse_48 = sqrt(sum((TEST$target - y_pred)^2)/length(y_pred))
```

# plant1 location2 온도, 습도, 코일 예측 48시간 후

## p1 hum_in_loc2
```{r p1_hum_in_loc2}
target1 = dataset1[dataset1$mea_ddhr >= '2017-05-03 02:00:00',]$hum_in_loc2
target2 = dataset2[dataset2$mea_ddhr >= '2018-07-03 02:00:00',]$hum_in_loc2
dataset_1 = dataset1[1:length(target1),]
dataset_2 = dataset2[1:length(target2),]
dataset = rbind(dataset_1, dataset_2)
target = c(target1, target2)
dataset = cbind(dataset, target=target)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN
TRAIN2$hum_48_sq_tem_48 = TRAIN2$hum_48 ** 2 * TRAIN2$tem_48
TRAIN2$summer_1_hum_48 = TRAIN2$summer_1 * TRAIN2$hum_48
TRAIN2$summer_0_hum_48 = TRAIN2$summer_0 * TRAIN2$hum_48
TRAIN2$summer_0_tem_48_sq = TRAIN2$summer_0 * TRAIN2$tem_48 ** 2
TRAIN2$wd_48_n_hum_48_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_s_hum_48_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_w_hum_48_ws_48 = TRAIN2$wd_48_w * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_n_hum_48_summer_0_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0
TRAIN2$wd_48_s_hum_48_summer_0_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0


z = TRAIN2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'hi_48', 'summer_1', 'summer_0', 'summer_1_hum_48',
               'summer_0_hum_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48')]

TEST2 = TEST
TEST2$hum_48_sq_tem_48 = TEST2$hum_48 ** 2 * TEST2$tem_48
TEST2$summer_1_hum_48 = TEST2$summer_1 * TEST2$hum_48
TEST2$summer_0_hum_48 = TEST2$summer_0 * TEST2$hum_48
TEST2$summer_0_tem_48_sq = TEST2$summer_0 * TEST2$tem_48 ** 2
TEST2$wd_48_n_hum_48_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_s_hum_48_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_w_hum_48_ws_48 = TEST2$wd_48_w * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_n_hum_48_summer_0_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0
TEST2$wd_48_s_hum_48_summer_0_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0


z2 = TEST2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'hi_48', 'summer_1', 'summer_0', 'summer_1_hum_48',
               'summer_0_hum_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48')]

dtrain = xgb.DMatrix(data = as.matrix(z), label= TRAIN$target)
dtest = xgb.DMatrix(data = as.matrix(z2), label= TEST$target)

params = list(booster = "gbtree", objective = "reg:squarederror", eta=0.01, gamma=0, max_depth=15, min_chi_48ld_weight=1, subsample=1, colsample_bytree=1)

xgb_plant1_hum_in_loc2_48 = xgb.train( params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_48d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant1_hum_in_loc2_48, dtest)
## k = xgb.importance(colnames(dtrain), model = xgb_plant1_hum_in_loc2_48)
## xgb.ggplot.importance(k, rel_to_first = TRUE, xlab = "Relative importance")
TEST$ind = seq(1:nrow(TEST))
z = data.frame(x=TEST$target, y=y_pred, t=TEST$ind)
g4 = ggplot(z) + 
  geom_line(aes(x=t, y=x, color='#348ABD')) + 
  geom_line(aes(x=t, y=y, color='#A60628')) + 
  ggtitle('24시간 후 hum_in_loc2') + 
  scale_color_manual(name='습도',
                     values = c('#348ABD', '#A60628'),
                     labels = c('실제', '예측'))

p1_hum_in_loc2_rmse_48 = sqrt(sum((TEST$target - y_pred)^2)/length(y_pred))
```

## p1 tem_in_loc2
```{r p1_tem_in_loc2}
target1 = dataset1[dataset1$mea_ddhr >= '2017-05-03 02:00:00',]$tem_in_loc2
target2 = dataset2[dataset2$mea_ddhr >= '2018-07-03 02:00:00',]$tem_in_loc2
dataset_1 = dataset1[1:length(target1),]
dataset_2 = dataset2[1:length(target2),]
dataset = rbind(dataset_1, dataset_2)
target = c(target1, target2)
dataset = cbind(dataset, target=target)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN
TRAIN2$hum_48_sq_tem_48 = TRAIN2$hum_48 ** 2 * TRAIN2$tem_48
TRAIN2$summer_0_tem_48_sq = TRAIN2$summer_0 * TRAIN2$tem_48 ** 2
TRAIN2$wd_48_n_hum_48_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_s_hum_48_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_w_hum_48_ws_48 = TRAIN2$wd_48_w * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_n_hum_48_summer_0_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0
TRAIN2$wd_48_s_hum_48_summer_0_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0
TRAIN2$tem_in_loc2_sq_tem_48 = TRAIN2$tem_in_loc2 ** 2 * TRAIN2$tem_48


z = TRAIN2[,c('hum_48', 'tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'hi_48', 'tem_in_loc2', 'tem_in_loc2_sq_tem_48')]

TEST2 = TEST
TEST2$hum_48_sq_tem_48 = TEST2$hum_48 ** 2 * TEST2$tem_48
TEST2$summer_0_tem_48_sq = TEST2$summer_0 * TEST2$tem_48 ** 2
TEST2$wd_48_n_hum_48_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_s_hum_48_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_w_hum_48_ws_48 = TEST2$wd_48_w * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_n_hum_48_summer_0_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0
TEST2$wd_48_s_hum_48_summer_0_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0
TEST2$tem_in_loc2_sq_tem_48 = TEST2$tem_in_loc2 ** 2 * TEST2$tem_48

z2 = TEST2[,c('hum_48', 'tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'hi_48', 'tem_in_loc2', 'tem_in_loc2_sq_tem_48')]


dtrain = xgb.DMatrix(data = as.matrix(z), label= TRAIN$target)
dtest = xgb.DMatrix(data = as.matrix(z2), label= TEST$target)

params = list(booster = "gbtree", objective = "reg:squarederror", eta=0.01, gamma=0, max_depth=15, min_chi_48ld_weight=1, subsample=1, colsample_bytree=1)
xgb_plant1_tem_in_loc2_48 = xgb.train( params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_48d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant1_tem_in_loc2_48, dtest)
## k = xgb.importance(colnames(dtrain), model = xgb_plant1_tem_in_loc2_48)
## xgb.ggplot.importance(k, rel_to_first = TRUE, xlab = "Relative importance")
TEST$ind = seq(1:nrow(TEST))
z = data.frame(x=TEST$target, y=y_pred, t=TEST$ind)
g5 = ggplot(z) + 
  geom_line(aes(x=t, y=x, color='#348ABD')) + 
  geom_line(aes(x=t, y=y, color='#A60628')) + 
  ggtitle('24시간 후 tem_in_loc2') + 
  scale_color_manual(name='온도',
                     values = c('#348ABD', '#A60628'),
                     labels = c('실제', '예측'))

p1_tem_in_loc2_rmse_48 = sqrt(sum((TEST$target - y_pred)^2)/length(y_pred))
```

## p1 tem_coil_Loc2
```{r p1_tem_coil_Loc2}
target1 = dataset1[dataset1$mea_ddhr >= '2017-05-03 02:00:00',]$tem_coil_loc2
target2 = dataset2[dataset2$mea_ddhr >= '2018-07-03 02:00:00',]$tem_coil_loc2
dataset_1 = dataset1[1:length(target1),]
dataset_2 = dataset2[1:length(target2),]
dataset = rbind(dataset_1, dataset_2)
target = c(target1, target2)
dataset = cbind(dataset, target=target)
SL=sample(1:nrow(dataset),nrow(dataset)*0.8,replace=FALSE)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN

TRAIN2$hum_48_sq_tem_48 = TRAIN2$hum_48 ** 2 * TRAIN2$tem_48
TRAIN2$summer_0_tem_48_sq = TRAIN2$summer_0 * TRAIN2$tem_48 ** 2
TRAIN2$wd_48_n_hum_48_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_s_hum_48_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_w_hum_48_ws_48 = TRAIN2$wd_48_w * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_n_hum_48_summer_0_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0
TRAIN2$wd_48_s_hum_48_summer_0_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0
TRAIN2$tem_in_loc2_sq_tem_48 = TRAIN2$tem_in_loc2 ** 2 * TRAIN2$tem_48
TRAIN2$tem_pred_loc2_48 = predict(xgb_plant1_tem_in_loc2_48, 
                                   as.matrix(TRAIN2[,c('hum_48', 'tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48',  'hi_48', 'tem_in_loc2', 'tem_in_loc2_sq_tem_48')]))

z = TRAIN2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'time_1',
               'summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48', 'tem_in_loc2', 'tem_in_loc2_sq_tem_48', 'tem_coil_loc2', 'tem_pred_loc2_48')]

TEST2 = TEST

TEST2$hum_48_sq_tem_48 = TEST2$hum_48 ** 2 * TEST2$tem_48
TEST2$summer_0_tem_48_sq = TEST2$summer_0 * TEST2$tem_48 ** 2
TEST2$wd_48_n_hum_48_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_s_hum_48_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_w_hum_48_ws_48 = TEST2$wd_48_w * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_n_hum_48_summer_0_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0
TEST2$wd_48_s_hum_48_summer_0_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0
TEST2$tem_in_loc2_sq_tem_48 = TEST2$tem_in_loc2 ** 2 * TEST2$tem_48
TEST2$tem_pred_loc2_48 = predict(xgb_plant1_tem_in_loc2_48, 
                                   as.matrix(TEST2[,c('hum_48', 'tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48',  'hi_48', 'tem_in_loc2', 'tem_in_loc2_sq_tem_48')]))

z2 = TEST2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'time_1',
               'summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48', 'tem_in_loc2', 'tem_in_loc2_sq_tem_48', 'tem_coil_loc2', 'tem_pred_loc2_48')]


dtrain = xgb.DMatrix(data = as.matrix(z), label= TRAIN$target)
dtest = xgb.DMatrix(data = as.matrix(z2), label= TEST$target)

params = list(booster = "gbtree", objective = "reg:squarederror", eta=0.01, gamma=0, max_depth=15, min_chi_48ld_weight=1, subsample=1, colsample_bytree=1)

xgb_plant1_tem_coil_loc2_48 = xgb.train( params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_48d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant1_tem_coil_loc2_48, dtest)
## k = xgb.importance(colnames(dtrain), model = xgb_plant1_tem_coil_loc2_48)
## xgb.ggplot.importance(k, rel_to_first = TRUE, xlab = "Relative importance")
TEST$ind = seq(1:nrow(TEST))
z = data.frame(x=TEST$target, y=y_pred, t=TEST$ind)
g6 = ggplot(z) + 
  geom_line(aes(x=t, y=x, color='#348ABD')) + 
  geom_line(aes(x=t, y=y, color='#A60628')) + 
  ggtitle('24시간 후 tem_coil_loc2') + 
  scale_color_manual(name='코일온도',
                     values = c('#348ABD', '#A60628'),
                     labels = c('실제', '예측'))

p1_tem_coil_loc2_rmse_48 = sqrt(sum((TEST$target - y_pred)^2)/length(y_pred))
```

# plant1 location3 온도, 습도, 코일 예측 48시간 후

## hum_in_loc3
```{r p1_hum_in_loc3}
target1 = dataset1[dataset1$mea_ddhr >= '2017-05-03 02:00:00',]$hum_in_loc3
target2 = dataset2[dataset2$mea_ddhr >= '2018-07-03 02:00:00',]$hum_in_loc3
dataset_1 = dataset1[1:length(target1),]
dataset_2 = dataset2[1:length(target2),]
dataset = rbind(dataset_1, dataset_2)
target = c(target1, target2)
dataset = cbind(dataset, target=target)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN
TRAIN2$hum_48_sq_tem_48 = TRAIN2$hum_48 ** 2 * TRAIN2$tem_48
TRAIN2$summer_1_hum_48 = TRAIN2$summer_1 * TRAIN2$hum_48
TRAIN2$summer_0_hum_48 = TRAIN2$summer_0 * TRAIN2$hum_48
TRAIN2$summer_0_tem_48_sq = TRAIN2$summer_0 * TRAIN2$tem_48 ** 2
TRAIN2$wd_48_n_hum_48_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_s_hum_48_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_w_hum_48_ws_48 = TRAIN2$wd_48_w * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_n_hum_48_summer_0_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0
TRAIN2$wd_48_s_hum_48_summer_0_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0


z = TRAIN2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'hi_48', 'summer_1', 'summer_0', 'summer_1_hum_48',
               'summer_0_hum_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48')]

TEST2 = TEST
TEST2$hum_48_sq_tem_48 = TEST2$hum_48 ** 2 * TEST2$tem_48
TEST2$summer_1_hum_48 = TEST2$summer_1 * TEST2$hum_48
TEST2$summer_0_hum_48 = TEST2$summer_0 * TEST2$hum_48
TEST2$summer_0_tem_48_sq = TEST2$summer_0 * TEST2$tem_48 ** 2
TEST2$wd_48_n_hum_48_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_s_hum_48_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_w_hum_48_ws_48 = TEST2$wd_48_w * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_n_hum_48_summer_0_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0
TEST2$wd_48_s_hum_48_summer_0_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0


z2 = TEST2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'hi_48', 'summer_1', 'summer_0', 'summer_1_hum_48',
               'summer_0_hum_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48')]

dtrain = xgb.DMatrix(data = as.matrix(z), label= TRAIN$target)
dtest = xgb.DMatrix(data = as.matrix(z2), label= TEST$target)

params = list(booster = "gbtree", objective = "reg:squarederror", eta=0.01, gamma=0, max_depth=15, min_chi_48ld_weight=1, subsample=1, colsample_bytree=1)

xgb_plant1_hum_in_loc3_48 = xgb.train( params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_48d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant1_hum_in_loc3_48, dtest)
## k = xgb.importance(colnames(dtrain), model = xgb_plant1_hum_in_loc3_48)
## xgb.ggplot.importance(k, rel_to_first = TRUE, xlab = "Relative importance")
TEST$ind = seq(1:nrow(TEST))
z = data.frame(x=TEST$target, y=y_pred, t=TEST$ind)
g24 = ggplot(z) + 
  geom_line(aes(x=t, y=x, color='#348ABD')) + 
  geom_line(aes(x=t, y=y, color='#A60628')) + 
  ggtitle('24시간 후 hum_in_loc3') + 
  scale_color_manual(name='습도',
                     values = c('#348ABD', '#A60628'),
                     labels = c('실제', '예측'))

p1_hum_in_loc3_rmse_48 = sqrt(sum((TEST$target - y_pred)^2)/length(y_pred))

```

## tem_in_loc3
```{r p1_tem_in_loc3}
target1 = dataset1[dataset1$mea_ddhr >= '2017-05-03 02:00:00',]$tem_in_loc3
target2 = dataset2[dataset2$mea_ddhr >= '2018-07-03 02:00:00',]$tem_in_loc3
dataset_1 = dataset1[1:length(target1),]
dataset_2 = dataset2[1:length(target2),]
dataset = rbind(dataset_1, dataset_2)
target = c(target1, target2)
dataset = cbind(dataset, target=target)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN
TRAIN2$hum_48_sq_tem_48 = TRAIN2$hum_48 ** 2 * TRAIN2$tem_48
TRAIN2$summer_0_tem_48_sq = TRAIN2$summer_0 * TRAIN2$tem_48 ** 2
TRAIN2$wd_48_n_hum_48_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_s_hum_48_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_w_hum_48_ws_48 = TRAIN2$wd_48_w * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_n_hum_48_summer_0_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0
TRAIN2$wd_48_s_hum_48_summer_0_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0
TRAIN2$tem_in_loc3_sq_tem_48 = TRAIN2$tem_in_loc3 ** 2 * TRAIN2$tem_48


z = TRAIN2[,c('hum_48', 'tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'hi_48', 'tem_in_loc3', 'tem_in_loc3_sq_tem_48')]

TEST2 = TEST
TEST2$hum_48_sq_tem_48 = TEST2$hum_48 ** 2 * TEST2$tem_48
TEST2$summer_0_tem_48_sq = TEST2$summer_0 * TEST2$tem_48 ** 2
TEST2$wd_48_n_hum_48_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_s_hum_48_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_w_hum_48_ws_48 = TEST2$wd_48_w * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_n_hum_48_summer_0_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0
TEST2$wd_48_s_hum_48_summer_0_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0
TEST2$tem_in_loc3_sq_tem_48 = TEST2$tem_in_loc3 ** 2 * TEST2$tem_48

z2 = TEST2[,c('hum_48', 'tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'hi_48', 'tem_in_loc3', 'tem_in_loc3_sq_tem_48')]


dtrain = xgb.DMatrix(data = as.matrix(z), label= TRAIN$target)
dtest = xgb.DMatrix(data = as.matrix(z2), label= TEST$target)

params = list(booster = "gbtree", objective = "reg:squarederror", eta=0.01, gamma=0, max_depth=15, min_chi_48ld_weight=1, subsample=1, colsample_bytree=1)

xgb_plant1_tem_in_loc3_48 = xgb.train( params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_48d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant1_tem_in_loc3_48, dtest)
## k = xgb.importance(colnames(dtrain), model = xgb8)
## xgb.ggplot.importance(k, rel_to_first = TRUE, xlab = "Relative importance")
TEST$ind = seq(1:nrow(TEST))
z = data.frame(x=TEST$target, y=y_pred, t=TEST$ind)
g25 = ggplot(z) + 
  geom_line(aes(x=t, y=x, color='#348ABD')) + 
  geom_line(aes(x=t, y=y, color='#A60628')) + 
  ggtitle('24시간 후 tem_in_loc3') + 
  scale_color_manual(name='온도',
                     values = c('#348ABD', '#A60628'),
                     labels = c('실제', '예측'))

p1_tem_in_loc3_rmse_48 = sqrt(sum((TEST$target - y_pred)^2)/length(y_pred))
```

## tem_coil_loc3
```{r p1_tem_coil_loc3}

target1 = dataset1[dataset1$mea_ddhr >= '2017-05-03 02:00:00',]$tem_coil_loc3
target2 = dataset2[dataset2$mea_ddhr >= '2018-07-03 02:00:00',]$tem_coil_loc3
dataset_1 = dataset1[1:length(target1),]
dataset_2 = dataset2[1:length(target2),]
dataset = rbind(dataset_1, dataset_2)
target = c(target1, target2)
dataset = cbind(dataset, target=target)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN

TRAIN2$hum_48_sq_tem_48 = TRAIN2$hum_48 ** 2 * TRAIN2$tem_48
TRAIN2$summer_0_tem_48_sq = TRAIN2$summer_0 * TRAIN2$tem_48 ** 2
TRAIN2$wd_48_n_hum_48_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_s_hum_48_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_w_hum_48_ws_48 = TRAIN2$wd_48_w * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_n_hum_48_summer_0_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0
TRAIN2$wd_48_s_hum_48_summer_0_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0
TRAIN2$tem_in_loc3_sq_tem_48 = TRAIN2$tem_in_loc3 ** 2 * TRAIN2$tem_48
TRAIN2$tem_pred_loc3_48 = predict(xgb_plant1_tem_in_loc3_48, 
                                   as.matrix(TRAIN2[,c('hum_48', 'tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48',  'hi_48', 'tem_in_loc3', 'tem_in_loc3_sq_tem_48')]))

z = TRAIN2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'time_1',
               'summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48', 'tem_in_loc3', 'tem_in_loc3_sq_tem_48', 'tem_coil_loc3', 'tem_pred_loc3_48')]

TEST2 = TEST

TEST2$hum_48_sq_tem_48 = TEST2$hum_48 ** 2 * TEST2$tem_48
TEST2$summer_0_tem_48_sq = TEST2$summer_0 * TEST2$tem_48 ** 2
TEST2$wd_48_n_hum_48_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_s_hum_48_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_w_hum_48_ws_48 = TEST2$wd_48_w * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_n_hum_48_summer_0_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0
TEST2$wd_48_s_hum_48_summer_0_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0
TEST2$tem_in_loc3_sq_tem_48 = TEST2$tem_in_loc3 ** 2 * TEST2$tem_48
TEST2$tem_pred_loc3_48 = predict(xgb_plant1_tem_in_loc3_48, 
                                   as.matrix(TEST2[,c('hum_48', 'tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48',  'hi_48', 'tem_in_loc3', 'tem_in_loc3_sq_tem_48')]))

z2 = TEST2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'time_1',
               'summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48', 'tem_in_loc3', 'tem_in_loc3_sq_tem_48', 'tem_coil_loc3', 'tem_pred_loc3_48')]


dtrain = xgb.DMatrix(data = as.matrix(z), label= TRAIN$target)
dtest = xgb.DMatrix(data = as.matrix(z2), label= TEST$target)

params = list(booster = "gbtree", objective = "reg:squarederror", eta=0.01, gamma=0, max_depth=15, min_chi_48ld_weight=1, subsample=1, colsample_bytree=1)

xgb_plant1_tem_coil_loc3_48 = xgb.train( params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_48d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant1_tem_coil_loc3_48, dtest)
## k = xgb.importance(colnames(dtrain), model = xgb_plant1_tem_coil_loc3_48)
## xgb.ggplot.importance(k, rel_to_first = TRUE, xlab = "Relative importance")
TEST$ind = seq(1:nrow(TEST))
z = data.frame(x=TEST$target, y=y_pred, t=TEST$ind)
g26 = ggplot(z) + 
  geom_line(aes(x=t, y=x, color='#348ABD')) + 
  geom_line(aes(x=t, y=y, color='#A60628')) + 
  ggtitle('24시간 후 tem_coil_loc3') + 
  scale_color_manual(name='코일온도',
                     values = c('#348ABD', '#A60628'),
                     labels = c('실제', '예측'))

p1_tem_coil_loc3_rmse_48 = sqrt(sum((TEST$target - y_pred)^2)/length(y_pred))
```


# plant2 location1 온도, 습도, 코일 예측 48시간 후

## p2 hum_in_loc1
```{r p2_hum_in_loc1}

target1 = dataset3[dataset3$mea_ddhr >= '2017-05-03 02:00:00',]$hum_in_loc1
target2 = dataset4[dataset4$mea_ddhr >= '2018-07-03 02:00:00',]$hum_in_loc1
dataset_3 = dataset3[1:length(target1),]
dataset_4 = dataset4[1:length(target2),]
dataset = rbind(dataset_3, dataset_4)
target = c(target1, target2)
dataset = cbind(dataset, target=target)
set.seed(0)
SL=sample(1:nrow(dataset),nrow(dataset)*0.8,replace=FALSE)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN
TRAIN2$hum_48_sq_tem_48 = TRAIN2$hum_48 ** 2 * TRAIN2$tem_48
TRAIN2$summer_1_hum_48 = TRAIN2$summer_1 * TRAIN2$hum_48
TRAIN2$summer_0_hum_48 = TRAIN2$summer_0 * TRAIN2$hum_48
TRAIN2$summer_0_tem_48_sq = TRAIN2$summer_0 * TRAIN2$tem_48 ** 2
TRAIN2$wd_48_n_hum_48_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_s_hum_48_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_w_hum_48_ws_48 = TRAIN2$wd_48_w * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_n_hum_48_summer_0_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0
TRAIN2$wd_48_s_hum_48_summer_0_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0


z = TRAIN2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'hi_48', 'summer_0', 'summer_1_hum_48',
               'summer_0_hum_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48')]

TEST2 = TEST
TEST2$hum_48_sq_tem_48 = TEST2$hum_48 ** 2 * TEST2$tem_48
TEST2$summer_1_hum_48 = TEST2$summer_1 * TEST2$hum_48
TEST2$summer_0_hum_48 = TEST2$summer_0 * TEST2$hum_48
TEST2$summer_0_tem_48_sq = TEST2$summer_0 * TEST2$tem_48 ** 2
TEST2$wd_48_n_hum_48_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_s_hum_48_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_w_hum_48_ws_48 = TEST2$wd_48_w * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_n_hum_48_summer_0_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0
TEST2$wd_48_s_hum_48_summer_0_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0


z2 = TEST2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'hi_48', 'summer_0', 'summer_1_hum_48',
               'summer_0_hum_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48')]

dtrain = xgb.DMatrix(data = as.matrix(z), label= TRAIN$target)
dtest = xgb.DMatrix(data = as.matrix(z2), label= TEST$target)

params = list(booster = "gbtree", objective = "reg:squarederror", eta=0.01, gamma=0, max_depth=15, min_chi_48ld_weight=1, subsample=1, colsample_bytree=1)
xgb_plant2_hum_in_loc1_48 = xgb.train( params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_48d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant2_hum_in_loc1_48, dtest)
## k = xgb.importance(colnames(dtrain), model = xgb_plant2_hum_in_loc1_48)
## xgb.ggplot.importance(k, rel_to_first = TRUE, xlab = "Relative importance")
TEST$ind = seq(1:nrow(TEST))
z = data.frame(x=TEST$target, y=y_pred, t=TEST$ind)
g1 = ggplot(z) + 
  geom_line(aes(x=t, y=x, color='#348ABD')) + 
  geom_line(aes(x=t, y=y, color='#A60628')) + 
  ggtitle('24시간 후 hum_in_loc1') + 
  scale_color_manual(name='습도',
                     values = c('#348ABD', '#A60628'),
                     labels = c('실제', '예측'))

p2_hum_in_loc1_rmse_48 = sqrt(sum((TEST$target - y_pred)^2)/length(y_pred))
```

## p2 tem_in_loc1
```{r p2_tem_in_loc1}
target1 = dataset3[dataset3$mea_ddhr >= '2017-05-03 02:00:00',]$tem_in_loc1
target2 = dataset4[dataset4$mea_ddhr >= '2018-07-03 02:00:00',]$tem_in_loc1
dataset_3 = dataset3[1:length(target1),]
dataset_4 = dataset4[1:length(target2),]
dataset = rbind(dataset_3, dataset_4)
target = c(target1, target2)
dataset = cbind(dataset, target=target)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN
TRAIN2$hum_48_sq_tem_48 = TRAIN2$hum_48 ** 2 * TRAIN2$tem_48
TRAIN2$summer_0_tem_48_sq = TRAIN2$summer_0 * TRAIN2$tem_48 ** 2
TRAIN2$wd_48_n_hum_48_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_s_hum_48_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_w_hum_48_ws_48 = TRAIN2$wd_48_w * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_n_hum_48_summer_0_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0
TRAIN2$wd_48_s_hum_48_summer_0_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0
TRAIN2$tem_in_loc1_sq_tem_48 = TRAIN2$tem_in_loc1 ** 2 * TRAIN2$tem_48


z = TRAIN2[,c('hum_48', 'tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'hi_48', 'tem_in_loc1', 'tem_in_loc1_sq_tem_48')]

TEST2 = TEST
TEST2$hum_48_sq_tem_48 = TEST2$hum_48 ** 2 * TEST2$tem_48
TEST2$summer_0_tem_48_sq = TEST2$summer_0 * TEST2$tem_48 ** 2
TEST2$wd_48_n_hum_48_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_s_hum_48_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_w_hum_48_ws_48 = TEST2$wd_48_w * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_n_hum_48_summer_0_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0
TEST2$wd_48_s_hum_48_summer_0_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0
TEST2$tem_in_loc1_sq_tem_48 = TEST2$tem_in_loc1 ** 2 * TEST2$tem_48

z2 = TEST2[,c('hum_48', 'tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'hi_48', 'tem_in_loc1', 'tem_in_loc1_sq_tem_48')]

library(xgboost)
dtrain = xgb.DMatrix(data = as.matrix(z), label= TRAIN$target)
dtest = xgb.DMatrix(data = as.matrix(z2), label= TEST$target)

params = list(booster = "gbtree", objective = "reg:squarederror", eta=0.01, gamma=0, max_depth=15, min_chi_48ld_weight=1, subsample=1, colsample_bytree=1)
xgb_plant2_tem_in_loc1_48 = xgb.train( params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_48d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant2_tem_in_loc1_48, dtest)
## k = xgb.importance(colnames(dtrain), model = xgb_plant2_tem_in_loc1_48)
## xgb.ggplot.importance(k, rel_to_first = TRUE, xlab = "Relative importance")
TEST$ind = seq(1:nrow(TEST))
z = data.frame(x=TEST$target, y=y_pred, t=TEST$ind)
g2 = ggplot(z) + 
  geom_line(aes(x=t, y=x, color='#348ABD')) + 
  geom_line(aes(x=t, y=y, color='#A60628')) + 
  ggtitle('24시간 후 tem_in_loc1') + 
  scale_color_manual(name='온도',
                     values = c('#348ABD', '#A60628'),
                     labels = c('실제', '예측'))

p2_tem_in_loc1_rmse_48 = sqrt(sum((TEST$target - y_pred)^2)/length(y_pred))



```

## p2 tem_coil_LOC1
```{r p2_tem_coil_LOC1}

target1 = dataset3[dataset3$mea_ddhr >= '2017-05-03 02:00:00',]$tem_coil_loc1
target2 = dataset4[dataset4$mea_ddhr >= '2018-07-03 02:00:00',]$tem_coil_loc1
dataset_3 = dataset3[1:length(target1),]
dataset_4 = dataset4[1:length(target2),]
dataset = rbind(dataset_3, dataset_4)
target = c(target1, target2)
dataset = cbind(dataset, target=target)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN

TRAIN2$hum_48_sq_tem_48 = TRAIN2$hum_48 ** 2 * TRAIN2$tem_48
TRAIN2$summer_0_tem_48_sq = TRAIN2$summer_0 * TRAIN2$tem_48 ** 2
TRAIN2$wd_48_n_hum_48_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_s_hum_48_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_w_hum_48_ws_48 = TRAIN2$wd_48_w * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_n_hum_48_summer_0_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0
TRAIN2$wd_48_s_hum_48_summer_0_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0
TRAIN2$tem_in_loc1_sq_tem_48 = TRAIN2$tem_in_loc1 ** 2 * TRAIN2$tem_48
TRAIN2$tem_pred_loc1_48 = predict(xgb_plant2_tem_in_loc1_48, 
                                   as.matrix(TRAIN2[,c('hum_48', 'tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48',  'hi_48', 'tem_in_loc1', 'tem_in_loc1_sq_tem_48')]))

z = TRAIN2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'time_1',
               'summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48', 'tem_in_loc1', 'tem_in_loc1_sq_tem_48', 'tem_coil_loc1', 'tem_pred_loc1_48')]

TEST2 = TEST

TEST2$hum_48_sq_tem_48 = TEST2$hum_48 ** 2 * TEST2$tem_48
TEST2$summer_0_tem_48_sq = TEST2$summer_0 * TEST2$tem_48 ** 2
TEST2$wd_48_n_hum_48_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_s_hum_48_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_w_hum_48_ws_48 = TEST2$wd_48_w * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_n_hum_48_summer_0_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0
TEST2$wd_48_s_hum_48_summer_0_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0
TEST2$tem_in_loc1_sq_tem_48 = TEST2$tem_in_loc1 ** 2 * TEST2$tem_48
TEST2$tem_pred_loc1_48 = predict(xgb_plant2_tem_in_loc1_48, 
                                   as.matrix(TEST2[,c('hum_48', 'tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48',  'hi_48', 'tem_in_loc1', 'tem_in_loc1_sq_tem_48')]))

z2 = TEST2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'time_1',
               'summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48', 'tem_in_loc1', 'tem_in_loc1_sq_tem_48', 'tem_coil_loc1', 'tem_pred_loc1_48')]


dtrain = xgb.DMatrix(data = as.matrix(z), label= TRAIN$target)
dtest = xgb.DMatrix(data = as.matrix(z2), label= TEST$target)

params = list(booster = "gbtree", objective = "reg:squarederror", eta=0.01, gamma=0, max_depth=15, min_chi_48ld_weight=1, subsample=1, colsample_bytree=1)

xgb_plant2_tem_coil_loc1_48 = xgb.train( params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_48d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant2_tem_coil_loc1_48, dtest)
## k = xgb.importance(colnames(dtrain), model = xgb_plant2_tem_coil_loc1_48)
## xgb.ggplot.importance(k, rel_to_first = TRUE, xlab = "Relative importance")
TEST$ind = seq(1:nrow(TEST))
z = data.frame(x=TEST$target, y=y_pred, t=TEST$ind)
g3 = ggplot(z) + 
  geom_line(aes(x=t, y=x, color='#348ABD')) + 
  geom_line(aes(x=t, y=y, color='#A60628')) + 
  ggtitle('24시간 후 tem_coil_loc1') + 
  scale_color_manual(name='코일온도',
                     values = c('#348ABD', '#A60628'),
                     labels = c('실제', '예측'))

p2_tem_coil_loc1_rmse_48 = sqrt(sum((TEST$target - y_pred)^2)/length(y_pred))
```

# plant2 location2 온도, 습도, 코일 예측 48시간 후

## p2 hum_in_loc2
```{r p2_hum_in_loc2}
target1 = dataset3[dataset3$mea_ddhr >= '2017-05-03 02:00:00',]$hum_in_loc2
target2 = dataset4[dataset4$mea_ddhr >= '2018-07-03 02:00:00',]$hum_in_loc2
dataset_3 = dataset3[1:length(target1),]
dataset_4 = dataset4[1:length(target2),]
dataset = rbind(dataset_3, dataset_4)
target = c(target1, target2)
dataset = cbind(dataset, target=target)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN
TRAIN2$hum_48_sq_tem_48 = TRAIN2$hum_48 ** 2 * TRAIN2$tem_48
TRAIN2$summer_1_hum_48 = TRAIN2$summer_1 * TRAIN2$hum_48
TRAIN2$summer_0_hum_48 = TRAIN2$summer_0 * TRAIN2$hum_48
TRAIN2$summer_0_tem_48_sq = TRAIN2$summer_0 * TRAIN2$tem_48 ** 2
TRAIN2$wd_48_n_hum_48_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_s_hum_48_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_w_hum_48_ws_48 = TRAIN2$wd_48_w * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_n_hum_48_summer_0_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0
TRAIN2$wd_48_s_hum_48_summer_0_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0


z = TRAIN2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'hi_48', 'summer_1', 'summer_0', 'summer_1_hum_48',
               'summer_0_hum_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48')]

TEST2 = TEST
TEST2$hum_48_sq_tem_48 = TEST2$hum_48 ** 2 * TEST2$tem_48
TEST2$summer_1_hum_48 = TEST2$summer_1 * TEST2$hum_48
TEST2$summer_0_hum_48 = TEST2$summer_0 * TEST2$hum_48
TEST2$summer_0_tem_48_sq = TEST2$summer_0 * TEST2$tem_48 ** 2
TEST2$wd_48_n_hum_48_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_s_hum_48_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_w_hum_48_ws_48 = TEST2$wd_48_w * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_n_hum_48_summer_0_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0
TEST2$wd_48_s_hum_48_summer_0_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0


z2 = TEST2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'hi_48', 'summer_1', 'summer_0', 'summer_1_hum_48',
               'summer_0_hum_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48')]

dtrain = xgb.DMatrix(data = as.matrix(z), label= TRAIN$target)
dtest = xgb.DMatrix(data = as.matrix(z2), label= TEST$target)

params = list(booster = "gbtree", objective = "reg:squarederror", eta=0.01, gamma=0, max_depth=15, min_chi_48ld_weight=1, subsample=1, colsample_bytree=1)

xgb_plant2_hum_in_loc2_48 = xgb.train( params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_48d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant2_hum_in_loc2_48, dtest)
## k = xgb.importance(colnames(dtrain), model = xgb_plant2_hum_in_loc2_48)
## xgb.ggplot.importance(k, rel_to_first = TRUE, xlab = "Relative importance")
TEST$ind = seq(1:nrow(TEST))
z = data.frame(x=TEST$target, y=y_pred, t=TEST$ind)
g4 = ggplot(z) + 
  geom_line(aes(x=t, y=x, color='#348ABD')) + 
  geom_line(aes(x=t, y=y, color='#A60628')) + 
  ggtitle('24시간 후 hum_in_loc2') + 
  scale_color_manual(name='습도',
                     values = c('#348ABD', '#A60628'),
                     labels = c('실제', '예측'))

p2_hum_in_loc2_rmse_48 = sqrt(sum((TEST$target - y_pred)^2)/length(y_pred))
```

## p2 tem_in_loc2
```{r p2_tem_in_loc2}
target1 = dataset3[dataset3$mea_ddhr >= '2017-05-03 02:00:00',]$tem_in_loc2
target2 = dataset4[dataset4$mea_ddhr >= '2018-07-03 02:00:00',]$tem_in_loc2
dataset_3 = dataset3[1:length(target1),]
dataset_4 = dataset4[1:length(target2),]
dataset = rbind(dataset_3, dataset_4)
target = c(target1, target2)
dataset = cbind(dataset, target=target)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN
TRAIN2$hum_48_sq_tem_48 = TRAIN2$hum_48 ** 2 * TRAIN2$tem_48
TRAIN2$summer_0_tem_48_sq = TRAIN2$summer_0 * TRAIN2$tem_48 ** 2
TRAIN2$wd_48_n_hum_48_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_s_hum_48_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_w_hum_48_ws_48 = TRAIN2$wd_48_w * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_n_hum_48_summer_0_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0
TRAIN2$wd_48_s_hum_48_summer_0_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0
TRAIN2$tem_in_loc2_sq_tem_48 = TRAIN2$tem_in_loc2 ** 2 * TRAIN2$tem_48


z = TRAIN2[,c('hum_48', 'tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'hi_48', 'tem_in_loc2', 'tem_in_loc2_sq_tem_48')]

TEST2 = TEST
TEST2$hum_48_sq_tem_48 = TEST2$hum_48 ** 2 * TEST2$tem_48
TEST2$summer_0_tem_48_sq = TEST2$summer_0 * TEST2$tem_48 ** 2
TEST2$wd_48_n_hum_48_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_s_hum_48_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_w_hum_48_ws_48 = TEST2$wd_48_w * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_n_hum_48_summer_0_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0
TEST2$wd_48_s_hum_48_summer_0_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0
TEST2$tem_in_loc2_sq_tem_48 = TEST2$tem_in_loc2 ** 2 * TEST2$tem_48

z2 = TEST2[,c('hum_48', 'tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'hi_48', 'tem_in_loc2', 'tem_in_loc2_sq_tem_48')]


dtrain = xgb.DMatrix(data = as.matrix(z), label= TRAIN$target)
dtest = xgb.DMatrix(data = as.matrix(z2), label= TEST$target)

params = list(booster = "gbtree", objective = "reg:squarederror", eta=0.01, gamma=0, max_depth=15, min_chi_48ld_weight=1, subsample=1, colsample_bytree=1)
xgb_plant2_tem_in_loc2_48 = xgb.train( params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_48d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant2_tem_in_loc2_48, dtest)
## k = xgb.importance(colnames(dtrain), model = xgb_plant2_tem_in_loc2_48)
## xgb.ggplot.importance(k, rel_to_first = TRUE, xlab = "Relative importance")
TEST$ind = seq(1:nrow(TEST))
z = data.frame(x=TEST$target, y=y_pred, t=TEST$ind)
g5 = ggplot(z) + 
  geom_line(aes(x=t, y=x, color='#348ABD')) + 
  geom_line(aes(x=t, y=y, color='#A60628')) + 
  ggtitle('24시간 후 tem_in_loc2') + 
  scale_color_manual(name='온도',
                     values = c('#348ABD', '#A60628'),
                     labels = c('실제', '예측'))

p2_tem_in_loc2_rmse_48 = sqrt(sum((TEST$target - y_pred)^2)/length(y_pred))
```

## p2 tem_coil_Loc2
```{r p2_tem_coil_Loc2}
target1 = dataset3[dataset3$mea_ddhr >= '2017-05-03 02:00:00',]$tem_coil_loc2
target2 = dataset4[dataset4$mea_ddhr >= '2018-07-03 02:00:00',]$tem_coil_loc2
dataset_3 = dataset3[1:length(target1),]
dataset_4 = dataset4[1:length(target2),]
dataset = rbind(dataset_3, dataset_4)
target = c(target1, target2)
dataset = cbind(dataset, target=target)
SL=sample(1:nrow(dataset),nrow(dataset)*0.8,replace=FALSE)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN

TRAIN2$hum_48_sq_tem_48 = TRAIN2$hum_48 ** 2 * TRAIN2$tem_48
TRAIN2$summer_0_tem_48_sq = TRAIN2$summer_0 * TRAIN2$tem_48 ** 2
TRAIN2$wd_48_n_hum_48_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_s_hum_48_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_w_hum_48_ws_48 = TRAIN2$wd_48_w * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_n_hum_48_summer_0_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0
TRAIN2$wd_48_s_hum_48_summer_0_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0
TRAIN2$tem_in_loc2_sq_tem_48 = TRAIN2$tem_in_loc2 ** 2 * TRAIN2$tem_48
TRAIN2$tem_pred_loc2_48 = predict(xgb_plant2_tem_in_loc2_48, 
                                   as.matrix(TRAIN2[,c('hum_48', 'tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48',  'hi_48', 'tem_in_loc2', 'tem_in_loc2_sq_tem_48')]))

z = TRAIN2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'time_1',
               'summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48', 'tem_in_loc2', 'tem_in_loc2_sq_tem_48', 'tem_coil_loc2', 'tem_pred_loc2_48')]

TEST2 = TEST

TEST2$hum_48_sq_tem_48 = TEST2$hum_48 ** 2 * TEST2$tem_48
TEST2$summer_0_tem_48_sq = TEST2$summer_0 * TEST2$tem_48 ** 2
TEST2$wd_48_n_hum_48_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_s_hum_48_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_w_hum_48_ws_48 = TEST2$wd_48_w * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_n_hum_48_summer_0_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0
TEST2$wd_48_s_hum_48_summer_0_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0
TEST2$tem_in_loc2_sq_tem_48 = TEST2$tem_in_loc2 ** 2 * TEST2$tem_48
TEST2$tem_pred_loc2_48 = predict(xgb_plant2_tem_in_loc2_48, 
                                   as.matrix(TEST2[,c('hum_48', 'tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48',  'hi_48', 'tem_in_loc2', 'tem_in_loc2_sq_tem_48')]))

z2 = TEST2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'time_1',
               'summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48', 'tem_in_loc2', 'tem_in_loc2_sq_tem_48', 'tem_coil_loc2', 'tem_pred_loc2_48')]


dtrain = xgb.DMatrix(data = as.matrix(z), label= TRAIN$target)
dtest = xgb.DMatrix(data = as.matrix(z2), label= TEST$target)

params = list(booster = "gbtree", objective = "reg:squarederror", eta=0.01, gamma=0, max_depth=15, min_chi_48ld_weight=1, subsample=1, colsample_bytree=1)

xgb_plant2_tem_coil_loc2_48 = xgb.train( params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_48d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant2_tem_coil_loc2_48, dtest)
## k = xgb.importance(colnames(dtrain), model = xgb_plant2_tem_coil_loc2_48)
## xgb.ggplot.importance(k, rel_to_first = TRUE, xlab = "Relative importance")
TEST$ind = seq(1:nrow(TEST))
z = data.frame(x=TEST$target, y=y_pred, t=TEST$ind)
g6 = ggplot(z) + 
  geom_line(aes(x=t, y=x, color='#348ABD')) + 
  geom_line(aes(x=t, y=y, color='#A60628')) + 
  ggtitle('24시간 후 tem_coil_loc2') + 
  scale_color_manual(name='코일온도',
                     values = c('#348ABD', '#A60628'),
                     labels = c('실제', '예측'))

p2_tem_coil_loc2_rmse_48 = sqrt(sum((TEST$target - y_pred)^2)/length(y_pred))
```

# plant2 location3 온도, 습도, 코일 예측 48시간 후

## hum_in_loc3
```{r p2_hum_in_loc3}
target1 = dataset3[dataset3$mea_ddhr >= '2017-05-03 02:00:00',]$hum_in_loc3
target2 = dataset4[dataset4$mea_ddhr >= '2018-07-03 02:00:00',]$hum_in_loc3
dataset_3 = dataset3[1:length(target1),]
dataset_4 = dataset4[1:length(target2),]
dataset = rbind(dataset_3, dataset_4)
target = c(target1, target2)
dataset = cbind(dataset, target=target)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN
TRAIN2$hum_48_sq_tem_48 = TRAIN2$hum_48 ** 2 * TRAIN2$tem_48
TRAIN2$summer_1_hum_48 = TRAIN2$summer_1 * TRAIN2$hum_48
TRAIN2$summer_0_hum_48 = TRAIN2$summer_0 * TRAIN2$hum_48
TRAIN2$summer_0_tem_48_sq = TRAIN2$summer_0 * TRAIN2$tem_48 ** 2
TRAIN2$wd_48_n_hum_48_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_s_hum_48_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_w_hum_48_ws_48 = TRAIN2$wd_48_w * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_n_hum_48_summer_0_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0
TRAIN2$wd_48_s_hum_48_summer_0_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0


z = TRAIN2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'hi_48', 'summer_1', 'summer_0', 'summer_1_hum_48',
               'summer_0_hum_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48')]

TEST2 = TEST
TEST2$hum_48_sq_tem_48 = TEST2$hum_48 ** 2 * TEST2$tem_48
TEST2$summer_1_hum_48 = TEST2$summer_1 * TEST2$hum_48
TEST2$summer_0_hum_48 = TEST2$summer_0 * TEST2$hum_48
TEST2$summer_0_tem_48_sq = TEST2$summer_0 * TEST2$tem_48 ** 2
TEST2$wd_48_n_hum_48_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_s_hum_48_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_w_hum_48_ws_48 = TEST2$wd_48_w * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_n_hum_48_summer_0_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0
TEST2$wd_48_s_hum_48_summer_0_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0


z2 = TEST2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'hi_48', 'summer_1', 'summer_0', 'summer_1_hum_48',
               'summer_0_hum_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48')]

dtrain = xgb.DMatrix(data = as.matrix(z), label= TRAIN$target)
dtest = xgb.DMatrix(data = as.matrix(z2), label= TEST$target)

params = list(booster = "gbtree", objective = "reg:squarederror", eta=0.01, gamma=0, max_depth=15, min_chi_48ld_weight=1, subsample=1, colsample_bytree=1)

xgb_plant2_hum_in_loc3_48 = xgb.train( params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_48d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant2_hum_in_loc3_48, dtest)
## k = xgb.importance(colnames(dtrain), model = xgb_plant2_hum_in_loc3_48)
## xgb.ggplot.importance(k, rel_to_first = TRUE, xlab = "Relative importance")
TEST$ind = seq(1:nrow(TEST))
z = data.frame(x=TEST$target, y=y_pred, t=TEST$ind)
g24 = ggplot(z) + 
  geom_line(aes(x=t, y=x, color='#348ABD')) + 
  geom_line(aes(x=t, y=y, color='#A60628')) + 
  ggtitle('24시간 후 hum_in_loc3') + 
  scale_color_manual(name='습도',
                     values = c('#348ABD', '#A60628'),
                     labels = c('실제', '예측'))

p2_hum_in_loc3_rmse_48 = sqrt(sum((TEST$target - y_pred)^2)/length(y_pred))

```

## tem_in_loc3
```{r p2_tem_in_loc3}
target1 = dataset3[dataset3$mea_ddhr >= '2017-05-03 02:00:00',]$tem_in_loc3
target2 = dataset4[dataset4$mea_ddhr >= '2018-07-03 02:00:00',]$tem_in_loc3
dataset_3 = dataset3[1:length(target1),]
dataset_4 = dataset4[1:length(target2),]
dataset = rbind(dataset_3, dataset_4)
target = c(target1, target2)
dataset = cbind(dataset, target=target)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN
TRAIN2$hum_48_sq_tem_48 = TRAIN2$hum_48 ** 2 * TRAIN2$tem_48
TRAIN2$summer_0_tem_48_sq = TRAIN2$summer_0 * TRAIN2$tem_48 ** 2
TRAIN2$wd_48_n_hum_48_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_s_hum_48_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_w_hum_48_ws_48 = TRAIN2$wd_48_w * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_n_hum_48_summer_0_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0
TRAIN2$wd_48_s_hum_48_summer_0_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0
TRAIN2$tem_in_loc3_sq_tem_48 = TRAIN2$tem_in_loc3 ** 2 * TRAIN2$tem_48


z = TRAIN2[,c('hum_48', 'tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'hi_48', 'tem_in_loc3', 'tem_in_loc3_sq_tem_48')]

TEST2 = TEST
TEST2$hum_48_sq_tem_48 = TEST2$hum_48 ** 2 * TEST2$tem_48
TEST2$summer_0_tem_48_sq = TEST2$summer_0 * TEST2$tem_48 ** 2
TEST2$wd_48_n_hum_48_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_s_hum_48_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_w_hum_48_ws_48 = TEST2$wd_48_w * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_n_hum_48_summer_0_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0
TEST2$wd_48_s_hum_48_summer_0_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0
TEST2$tem_in_loc3_sq_tem_48 = TEST2$tem_in_loc3 ** 2 * TEST2$tem_48

z2 = TEST2[,c('hum_48', 'tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'hi_48', 'tem_in_loc3', 'tem_in_loc3_sq_tem_48')]


dtrain = xgb.DMatrix(data = as.matrix(z), label= TRAIN$target)
dtest = xgb.DMatrix(data = as.matrix(z2), label= TEST$target)

params = list(booster = "gbtree", objective = "reg:squarederror", eta=0.01, gamma=0, max_depth=15, min_chi_48ld_weight=1, subsample=1, colsample_bytree=1)

xgb_plant2_tem_in_loc3_48 = xgb.train( params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_48d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant2_tem_in_loc3_48, dtest)
## k = xgb.importance(colnames(dtrain), model = xgb8)
## xgb.ggplot.importance(k, rel_to_first = TRUE, xlab = "Relative importance")
TEST$ind = seq(1:nrow(TEST))
z = data.frame(x=TEST$target, y=y_pred, t=TEST$ind)
g25 = ggplot(z) + 
  geom_line(aes(x=t, y=x, color='#348ABD')) + 
  geom_line(aes(x=t, y=y, color='#A60628')) + 
  ggtitle('24시간 후 tem_in_loc3') + 
  scale_color_manual(name='온도',
                     values = c('#348ABD', '#A60628'),
                     labels = c('실제', '예측'))

p2_tem_in_loc3_rmse_48 = sqrt(sum((TEST$target - y_pred)^2)/length(y_pred))
```

## tem_coil_loc3
```{r p2_tem_coil_loc3}

target1 = dataset3[dataset3$mea_ddhr >= '2017-05-03 02:00:00',]$tem_coil_loc3
target2 = dataset4[dataset4$mea_ddhr >= '2018-07-03 02:00:00',]$tem_coil_loc3
dataset_3 = dataset3[1:length(target1),]
dataset_4 = dataset4[1:length(target2),]
dataset = rbind(dataset_3, dataset_4)
target = c(target1, target2)
dataset = cbind(dataset, target=target)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN

TRAIN2$hum_48_sq_tem_48 = TRAIN2$hum_48 ** 2 * TRAIN2$tem_48
TRAIN2$summer_0_tem_48_sq = TRAIN2$summer_0 * TRAIN2$tem_48 ** 2
TRAIN2$wd_48_n_hum_48_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_s_hum_48_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_w_hum_48_ws_48 = TRAIN2$wd_48_w * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_n_hum_48_summer_0_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0
TRAIN2$wd_48_s_hum_48_summer_0_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0
TRAIN2$tem_in_loc3_sq_tem_48 = TRAIN2$tem_in_loc3 ** 2 * TRAIN2$tem_48
TRAIN2$tem_pred_loc3_48 = predict(xgb_plant2_tem_in_loc3_48, 
                                   as.matrix(TRAIN2[,c('hum_48', 'tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48',  'hi_48', 'tem_in_loc3', 'tem_in_loc3_sq_tem_48')]))

z = TRAIN2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'time_1',
               'summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48', 'tem_in_loc3', 'tem_in_loc3_sq_tem_48', 'tem_coil_loc3', 'tem_pred_loc3_48')]

TEST2 = TEST

TEST2$hum_48_sq_tem_48 = TEST2$hum_48 ** 2 * TEST2$tem_48
TEST2$summer_0_tem_48_sq = TEST2$summer_0 * TEST2$tem_48 ** 2
TEST2$wd_48_n_hum_48_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_s_hum_48_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_w_hum_48_ws_48 = TEST2$wd_48_w * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_n_hum_48_summer_0_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0
TEST2$wd_48_s_hum_48_summer_0_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0
TEST2$tem_in_loc3_sq_tem_48 = TEST2$tem_in_loc3 ** 2 * TEST2$tem_48
TEST2$tem_pred_loc3_48 = predict(xgb_plant2_tem_in_loc3_48, 
                                   as.matrix(TEST2[,c('hum_48', 'tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48',  'hi_48', 'tem_in_loc3', 'tem_in_loc3_sq_tem_48')]))

z2 = TEST2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'time_1',
               'summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48', 'tem_in_loc3', 'tem_in_loc3_sq_tem_48', 'tem_coil_loc3', 'tem_pred_loc3_48')]


dtrain = xgb.DMatrix(data = as.matrix(z), label= TRAIN$target)
dtest = xgb.DMatrix(data = as.matrix(z2), label= TEST$target)

params = list(booster = "gbtree", objective = "reg:squarederror", eta=0.01, gamma=0, max_depth=15, min_chi_48ld_weight=1, subsample=1, colsample_bytree=1)

xgb_plant2_tem_coil_loc3_48 = xgb.train( params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_48d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant2_tem_coil_loc3_48, dtest)
## k = xgb.importance(colnames(dtrain), model = xgb_plant2_tem_coil_loc3_48)
## xgb.ggplot.importance(k, rel_to_first = TRUE, xlab = "Relative importance")
TEST$ind = seq(1:nrow(TEST))
z = data.frame(x=TEST$target, y=y_pred, t=TEST$ind)
g26 = ggplot(z) + 
  geom_line(aes(x=t, y=x, color='#348ABD')) + 
  geom_line(aes(x=t, y=y, color='#A60628')) + 
  ggtitle('24시간 후 tem_coil_loc3') + 
  scale_color_manual(name='코일온도',
                     values = c('#348ABD', '#A60628'),
                     labels = c('실제', '예측'))

p2_tem_coil_loc3_rmse_48 = sqrt(sum((TEST$target - y_pred)^2)/length(y_pred))
```



# plant1 24시간 후 결로 예측 모델

## p1 loc1_24h
```{r p1_loc1_24h}
target1 = dataset1[dataset1$mea_ddhr >= '2017-05-02 02:00:00',]$cond_loc1
target2 = dataset2[dataset2$mea_ddhr >= '2018-07-02 02:00:00',]$cond_loc1

dataset_1 = dataset1[1:length(target1),]
dataset_2 = dataset2[1:length(target2),]

dataset = rbind(dataset_1, dataset_2)
dataset = dataset[,c(-24)]
target = c(target1, target2)
dataset = cbind(dataset, target=target) %>% na.omit()

SL=sample(1:nrow(dataset),nrow(dataset)*0.9, replace=TRUE)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]
p2_tem_in_loc3_rmse_48
TRAIN2$hum_24
TRAIN2$hum_24_sq_tem_24 = TRAIN2$hum_24 ** 2 * TRAIN2$tem_24
TRAIN2$summer_1_hum_24 = TRAIN2$summer_1 * TRAIN2$hum_24
TRAIN2$summer_0_hum_24 = TRAIN2$summer_0 * TRAIN2$hum_24
TRAIN2$summer_0_tem_24_sq = TRAIN2$summer_0 * TRAIN2$tem_24 ** 2
TRAIN2$wd_24_n_hum_24_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_s_hum_24_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_w_hum_24_ws_24 = TRAIN2$wd_24_w * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_n_hum_24_summer_0_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$wd_24_s_hum_24_summer_0_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$tem_24
TRAIN2$hum_24_sq_tem_24 = TRAIN2$hum_24 ** 2 * TRAIN2$tem_24
TRAIN2$tem_in_loc1_sq_tem_24 = TRAIN2$tem_in_loc1 ** 2 * TRAIN2$tem_24
TRAIN2$tem_pred_loc1_24 = predict(xgb_plant1_tem_in_loc1_24, 
                                   as.matrix(TRAIN2[,c('hum_24', 'tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24',  'hi_24', 'tem_in_loc1', 'tem_in_loc1_sq_tem_24')]))

TRAIN2$coil_pred_loc1_24 = predict(xgb_plant1_tem_coil_loc1_24, as.matrix(TRAIN2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24', 'tem_in_loc1', 'tem_in_loc1_sq_tem_24', 'tem_coil_loc1', 'tem_pred_loc1_24')]))


TRAIN2$dif_24 = TRAIN2$coil_pred_loc1_24 - dew_point(TRAIN2$tem_24, TRAIN2$hum_24)
TRAIN2$dif_out_24 = TRAIN2$tem_coil_loc1 - dew_point(TRAIN2$tem_out_loc1, TRAIN2$hum_out_loc1)
TRAIN2$tem_pred_loc1_24 = predict(xgb_plant1_tem_in_loc1_24, 
                                   as.matrix(TRAIN2[,c('hum_24', 'tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24', 'hi_24', 'tem_in_loc1', 'tem_in_loc1_sq_tem_24')]))


TRAIN2$hum_pred_loc1_24 = predict(xgb_plant1_hum_in_loc1_24, 
                                   as.matrix(TRAIN2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24', 'hi_24', 'summer_0', 'summer_1_hum_24',
                                                       'summer_0_hum_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24')]))
TRAIN2$pred_dif_loc1_24 = TRAIN2$coil_pred_loc1_24 - dew_point(TRAIN2$tem_pred_loc1_24, TRAIN2$hum_pred_loc1_24)
TRAIN2$pred_dif_dum_loc1_24 = as.integer(ifelse(TRAIN2$pred_dif_loc1_24 > 0.99, 0, 1))

z = TRAIN2[,c('pred_dif_dum_loc1_24', 'hum_24_sq_tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24', 'hi_24'
               ,'tem_in_loc1', 'tem_coil_loc1', 'dif', 'dif_24', 'coil_pred_loc1_24', 'dif_out_24', 'tem_pred_loc1_24', 'hum_pred_loc1_24', 'pred_dif_loc1_24')]

TEST2 = TEST
TEST2$hum_24_sq_tem_24 = TEST2$hum_24 ** 2 * TEST2$tem_24
TEST2$summer_1_hum_24 = TEST2$summer_1 * TEST2$hum_24
TEST2$summer_0_hum_24 = TEST2$summer_0 * TEST2$hum_24
TEST2$summer_0_tem_24_sq = TEST2$summer_0 * TEST2$tem_24 ** 2
TEST2$wd_24_n_hum_24_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_s_hum_24_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_w_hum_24_ws_24 = TEST2$wd_24_w * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_n_hum_24_summer_0_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0
TEST2$wd_24_s_hum_24_summer_0_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0

TEST2$hum_24_sq_tem_24 = TEST2$hum_24 ** 2 * TEST2$tem_24
TEST2$tem_in_loc1_sq_tem_24 = TEST2$tem_in_loc1 ** 2 * TEST2$tem_24
TEST2$tem_pred_loc1_24 = predict(xgb_plant1_tem_in_loc1_24, 
                                   as.matrix(TEST2[,c('hum_24', 'tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24',  'hi_24', 'tem_in_loc1', 'tem_in_loc1_sq_tem_24')]))

TEST2$coil_pred_loc1_24 = predict(xgb_plant1_tem_coil_loc1_24, 
                                   as.matrix(TEST2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24', 'tem_in_loc1', 'tem_in_loc1_sq_tem_24', 'tem_coil_loc1',
                                                      'tem_pred_loc1_24')]))
TEST2$dif_24 = TEST2$coil_pred_loc1_24 - dew_point(TEST2$tem_24, TEST2$hum_24)
TEST2$dif_out_24 = TEST2$tem_coil_loc1- dew_point(TEST2$tem_out_loc1, TEST2$hum_out_loc1)
TEST2$tem_pred_loc1_24 = predict(xgb_plant1_tem_in_loc1_24, 
                                  as.matrix(TEST2[,c('hum_24', 'tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24', 'hi_24', 'tem_in_loc1', 'tem_in_loc1_sq_tem_24')]))


TEST2$hum_pred_loc1_24 = predict(xgb_plant1_hum_in_loc1_24, 
                                  as.matrix(TEST2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24', 'hi_24', 'summer_0', 'summer_1_hum_24',
                                                     'summer_0_hum_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24')]))
TEST2$pred_dif_loc1_24 = TEST2$coil_pred_loc1_24 - dew_point(TEST2$tem_pred_loc1_24, TEST2$hum_pred_loc1_24)
TEST2$pred_dif_dum_loc1_24 = as.integer(ifelse(TEST2$pred_dif_loc1_24 > 0.99, 0, 1))

z2 = TEST2[,c('pred_dif_dum_loc1_24', 'hum_24_sq_tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24', 'hi_24'
               ,'tem_in_loc1', 'tem_coil_loc1', 'dif', 'dif_24', 'coil_pred_loc1_24', 'dif_out_24', 'tem_pred_loc1_24', 'hum_pred_loc1_24', 'pred_dif_loc1_24')]


dtrain = xgb.DMatrix(data = as.matrix(z), label= as.integer(TRAIN2$target))
dtest = xgb.DMatrix(data = as.matrix(z2), label= as.integer(TEST2$target))

params = list(booster = "gbtree", objective = "binary:logistic", eta=0.01, gamma=0, max_depth=15, min_child_weight=5, subsample=1, colsample_bytree=1)
xgb_plant1_loc1_24h = xgb.train(params = params, data = dtrain, nrounds = 1000, nfold = 3, shows_48d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant1_loc1_24h, dtest)
## k = xgb.importance(feature_names=colnames(dtest), model = xgb_plant1_loc1_24h)
## g11 =xgb.ggplot.importance(k)
library(caret)
confusionMatrix(as.factor(ifelse(y_pred > 0.5, 1, 0)), as.factor(TEST2$target))
```

## p1 loc2_24h
```{r p1_loc2_24h}
target1 = dataset1[dataset1$mea_ddhr >= '2017-05-02 02:00:00',]$cond_loc2
target2 = dataset2[dataset2$mea_ddhr >= '2018-07-02 02:00:00',]$cond_loc2

dataset_1 = dataset1[1:length(target1),]
dataset_2 = dataset2[1:length(target2),]

dataset = rbind(dataset_1, dataset_2)
dataset = dataset[,c(-24)]
target = c(target1, target2)
dataset = cbind(dataset, target=target) %>% na.omit()
SL=sample(1:nrow(dataset),nrow(dataset)*0.9, replace=TRUE)

TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN
TRAIN2$hum_24_sq_tem_24 = TRAIN2$hum_24 ** 2 * TRAIN2$tem_24
TRAIN2$summer_1_hum_24 = TRAIN2$summer_1 * TRAIN2$hum_24
TRAIN2$summer_0_hum_24 = TRAIN2$summer_0 * TRAIN2$hum_24
TRAIN2$summer_0_tem_24_sq = TRAIN2$summer_0 * TRAIN2$tem_24 ** 2
TRAIN2$wd_24_n_hum_24_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_s_hum_24_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_w_hum_24_ws_24 = TRAIN2$wd_24_w * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_n_hum_24_summer_0_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$wd_24_s_hum_24_summer_0_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0

TRAIN2$hum_24_sq_tem_24 = TRAIN2$hum_24 ** 2 * TRAIN2$tem_24
TRAIN2$tem_in_loc2_sq_tem_24 = TRAIN2$tem_in_loc2 ** 2 * TRAIN2$tem_24
TRAIN2$tem_pred_loc2_24 = predict(xgb_plant1_tem_in_loc2_24, 
                                   as.matrix(TRAIN2[,c('hum_24', 'tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'hi_24', 'tem_in_loc2', 'tem_in_loc2_sq_tem_24')]))

TRAIN2$coil_pred_loc2_24 = predict(xgb_plant1_tem_coil_loc2_24, 
                                    as.matrix(TRAIN2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24', 'tem_in_loc2', 'tem_in_loc2_sq_tem_24', 'tem_coil_loc2',
                                                        'tem_pred_loc2_24')]))
TRAIN2$dif_24 = TRAIN2$coil_pred_loc2_24 - dew_point(TRAIN2$tem_24, TRAIN2$hum_24)
TRAIN2$dif_out_24 = TRAIN2$tem_coil_loc2 - dew_point(TRAIN2$tem_out_loc1, TRAIN2$hum_out_loc1)
TRAIN2$tem_pred_loc2_24 = predict(xgb_plant1_tem_in_loc2_24, 
                                   as.matrix(TRAIN2[,c('hum_24', 'tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'hi_24', 'tem_in_loc2', 'tem_in_loc2_sq_tem_24')]))

TRAIN2$hum_pred_loc2_24 = predict(xgb_plant1_hum_in_loc2_24, 
                                   as.matrix(TRAIN2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'hi_24', 'summer_1', 'summer_0', 'summer_1_hum_24',
                                                       'summer_0_hum_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24')]))
TRAIN2$pred_dif_loc2_24 = TRAIN2$coil_pred_loc2_24 - dew_point(TRAIN2$tem_pred_loc2_24, TRAIN2$hum_pred_loc2_24)
TRAIN2$pred_dif_dum_loc2_24 = as.integer(ifelse(TRAIN2$pred_dif_loc2_24 > 0.99, 0, 1))

z = TRAIN2[,c('pred_dif_dum_loc2_24', 'hum_24_sq_tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'hi_24'
               ,'tem_in_loc2', 'tem_coil_loc2', 'dif', 'dif_24', 'coil_pred_loc2_24', 'dif_out_24', 'tem_pred_loc2_24', 'hum_pred_loc2_24', 'pred_dif_loc2_24')]

TEST2 = TEST
TEST2$hum_24_sq_tem_24 = TEST2$hum_24 ** 2 * TEST2$tem_24
TEST2$summer_1_hum_24 = TEST2$summer_1 * TEST2$hum_24
TEST2$summer_0_hum_24 = TEST2$summer_0 * TEST2$hum_24
TEST2$summer_0_tem_24_sq = TEST2$summer_0 * TEST2$tem_24 ** 2
TEST2$wd_24_n_hum_24_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_s_hum_24_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_w_hum_24_ws_24 = TEST2$wd_24_w * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_n_hum_24_summer_0_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0
TEST2$wd_24_s_hum_24_summer_0_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0

TEST2$hum_24_sq_tem_24 = TEST2$hum_24 ** 2 * TEST2$tem_24
TEST2$tem_in_loc2_sq_tem_24 = TEST2$tem_in_loc2 ** 2 * TEST2$tem_24
TEST2$tem_pred_loc2_24 = predict(xgb_plant1_tem_in_loc2_24, 
                                   as.matrix(TEST2[,c('hum_24', 'tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'hi_24', 'tem_in_loc2', 'tem_in_loc2_sq_tem_24')]))

TEST2$coil_pred_loc2_24 = predict(xgb_plant1_tem_coil_loc2_24, 
                                   as.matrix(TEST2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24', 'tem_in_loc2', 'tem_in_loc2_sq_tem_24', 'tem_coil_loc2',
                                                      'tem_pred_loc2_24')]))
TEST2$dif_24 = TEST2$coil_pred_loc2_24 - dew_point(TEST2$tem_24, TEST2$hum_24)
TEST2$dif_out_24 = TEST2$tem_coil_loc2 - dew_point(TEST2$tem_out_loc1, TEST2$hum_out_loc1)
TEST2$tem_pred_loc2_24 = predict(xgb_plant1_tem_in_loc2_24, 
                                  as.matrix(TEST2[,c('hum_24', 'tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'hi_24', 'tem_in_loc2', 'tem_in_loc2_sq_tem_24')]))

TEST2$hum_pred_loc2_24 = predict(xgb_plant1_hum_in_loc2_24, 
                                  as.matrix(TEST2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'hi_24', 'summer_1', 'summer_0', 'summer_1_hum_24',
                                                     'summer_0_hum_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24')]))
TEST2$pred_dif_loc2_24 = TEST2$coil_pred_loc2_24 - dew_point(TEST2$tem_pred_loc2_24, TEST2$hum_pred_loc2_24)
TEST2$pred_dif_dum_loc2_24 = as.integer(ifelse(TEST2$pred_dif_loc2_24 > 0.99, 0, 1))

z2 = TEST2[,c('pred_dif_dum_loc2_24', 'hum_24_sq_tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'hi_24'
               ,'tem_in_loc2', 'tem_coil_loc2', 'dif', 'dif_24', 'coil_pred_loc2_24', 'dif_out_24', 'tem_pred_loc2_24', 'hum_pred_loc2_24', 'pred_dif_loc2_24')]


dtrain = xgb.DMatrix(data = as.matrix(z), label= as.integer(TRAIN2$target))
dtest = xgb.DMatrix(data = as.matrix(z2), label= as.integer(TEST2$target))

params = list(booster = "gbtree", objective = "binary:logistic", eta=0.01, gamma=0, max_depth=15, min_child_weight=5, subsample=1, colsample_bytree=1)
xgb_plant1_loc2_24h = xgb.train(params = params, data = dtrain, nrounds = 1000, nfold = 3, shows_48d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant1_loc2_24h, dtest)
## k = xgb.importance(feature_names=colnames(dtest), model = xgb_plant1_loc2_24h)
## g12 =xgb.ggplot.importance(k)
library(caret)
confusionMatrix(as.factor(ifelse(y_pred > 0.5, 1, 0)), as.factor(TEST2$target))
```

## p1 loc3_24h
```{r p1_loc3_24h}
dataset1 = plant1_1
dataset2 = plant1_2

target1 = dataset1[dataset1$mea_ddhr >= '2017-05-02 02:00:00',]$cond_loc3
target2 = dataset2[dataset2$mea_ddhr >= '2018-07-02 02:00:00',]$cond_loc3

dataset_1 = dataset1[1:length(target1),]
dataset_2 = dataset2[1:length(target2),]

dataset = rbind(dataset_1, dataset_2)
dataset = dataset[,c(-24)]
target = c(target1, target2)
dataset = cbind(dataset, target=target) %>% na.omit()
SL=sample(1:nrow(dataset),nrow(dataset)*0.9, replace=TRUE)

TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN
TRAIN2$hum_24_sq_tem_24 = TRAIN2$hum_24 ** 2 * TRAIN2$tem_24
TRAIN2$summer_1_hum_24 = TRAIN2$summer_1 * TRAIN2$hum_24
TRAIN2$summer_0_hum_24 = TRAIN2$summer_0 * TRAIN2$hum_24
TRAIN2$summer_0_tem_24_sq = TRAIN2$summer_0 * TRAIN2$tem_24 ** 2
TRAIN2$wd_24_n_hum_24_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_s_hum_24_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_w_hum_24_ws_24 = TRAIN2$wd_24_w * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_n_hum_24_summer_0_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$wd_24_s_hum_24_summer_0_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0

TRAIN2$hum_24_sq_tem_24 = TRAIN2$hum_24 ** 2 * TRAIN2$tem_24
TRAIN2$tem_in_loc3_sq_tem_24 = TRAIN2$tem_in_loc3 ** 2 * TRAIN2$tem_24
TRAIN2$tem_pred_loc3_24 = predict(xgb_plant1_tem_in_loc3_24, 
                                   as.matrix(TRAIN2[,c('hum_24', 'tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'hi_24', 'tem_in_loc3', 'tem_in_loc3_sq_tem_24')]))

TRAIN2$coil_pred_loc3_24 = predict(xgb_plant1_tem_coil_loc3_24, 
                                    as.matrix(TRAIN2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24', 'tem_in_loc3', 'tem_in_loc3_sq_tem_24', 'tem_coil_loc3',
                                                        'tem_pred_loc3_24')]))
TRAIN2$dif_24 = TRAIN2$coil_pred_loc3_24 - dew_point(TRAIN2$tem_24, TRAIN2$hum_24)
TRAIN2$dif_out_24 = TRAIN2$tem_coil_loc3 - dew_point(TRAIN2$tem_out_loc1, TRAIN2$hum_out_loc1)
TRAIN2$tem_pred_loc3_24 = predict(xgb_plant1_tem_in_loc3_24, 
                                   as.matrix(TRAIN2[,c('hum_24', 'tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'hi_24', 'tem_in_loc3', 'tem_in_loc3_sq_tem_24')]))

TRAIN2$hum_pred_loc3_24 = predict(xgb_plant1_hum_in_loc3_24, 
                                   as.matrix(TRAIN2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'hi_24', 'summer_1', 'summer_0', 'summer_1_hum_24',
                                                       'summer_0_hum_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24')]))
TRAIN2$pred_dif_loc3_24 = TRAIN2$coil_pred_loc3_24 - dew_point(TRAIN2$tem_pred_loc3_24, TRAIN2$hum_pred_loc3_24)
TRAIN2$pred_dif_dum_loc3_24 = as.integer(ifelse(TRAIN2$pred_dif_loc3_24 > 0.99, 0, 1))

z = TRAIN2[,c('pred_dif_dum_loc3_24', 'hum_24_sq_tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'hi_24'
               ,'tem_in_loc3', 'tem_coil_loc3', 'dif', 'dif_24', 'coil_pred_loc3_24', 'dif_out_24', 'tem_pred_loc3_24', 'hum_pred_loc3_24', 'pred_dif_loc3_24')]

TEST2 = TEST
TEST2$hum_24_sq_tem_24 = TEST2$hum_24 ** 2 * TEST2$tem_24
TEST2$summer_1_hum_24 = TEST2$summer_1 * TEST2$hum_24
TEST2$summer_0_hum_24 = TEST2$summer_0 * TEST2$hum_24
TEST2$summer_0_tem_24_sq = TEST2$summer_0 * TEST2$tem_24 ** 2
TEST2$wd_24_n_hum_24_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_s_hum_24_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_w_hum_24_ws_24 = TEST2$wd_24_w * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_n_hum_24_summer_0_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0
TEST2$wd_24_s_hum_24_summer_0_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0

TEST2$hum_24_sq_tem_24 = TEST2$hum_24 ** 2 * TEST2$tem_24
TEST2$tem_in_loc3_sq_tem_24 = TEST2$tem_in_loc3 ** 2 * TEST2$tem_24
TEST2$tem_pred_loc3_24 = predict(xgb_plant1_tem_in_loc3_24, 
                                   as.matrix(TEST2[,c('hum_24', 'tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'hi_24', 'tem_in_loc3', 'tem_in_loc3_sq_tem_24')]))

TEST2$coil_pred_loc3_24 = predict(xgb_plant1_tem_coil_loc3_24, 
                                   as.matrix(TEST2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24', 'tem_in_loc3', 'tem_in_loc3_sq_tem_24', 'tem_coil_loc3',
                                                      'tem_pred_loc3_24')]))
TEST2$dif_24 = TEST2$coil_pred_loc3_24 - dew_point(TEST2$tem_24, TEST2$hum_24)
TEST2$dif_out_24 = TEST2$tem_coil_loc3 - dew_point(TEST2$tem_out_loc1, TEST2$hum_out_loc1)
TEST2$tem_pred_loc3_24 = predict(xgb_plant1_tem_in_loc3_24, 
                                  as.matrix(TEST2[,c('hum_24', 'tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'hi_24', 'tem_in_loc3', 'tem_in_loc3_sq_tem_24')]))

TEST2$hum_pred_loc3_24 = predict(xgb_plant1_hum_in_loc3_24, 
                                  as.matrix(TEST2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'hi_24', 'summer_1', 'summer_0', 'summer_1_hum_24',
                                                     'summer_0_hum_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24')]))
TEST2$pred_dif_loc3_24 = TEST2$coil_pred_loc3_24 - dew_point(TEST2$tem_pred_loc3_24, TEST2$hum_pred_loc3_24)
TEST2$pred_dif_dum_loc3_24 = as.integer(ifelse(TEST2$pred_dif_loc3_24 > 0.99, 0, 1))

z2 = TEST2[,c('pred_dif_dum_loc3_24', 'hum_24_sq_tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'hi_24'
               ,'tem_in_loc3', 'tem_coil_loc3', 'dif', 'dif_24', 'coil_pred_loc3_24', 'dif_out_24', 'tem_pred_loc3_24', 'hum_pred_loc3_24', 'pred_dif_loc3_24')]


dtrain = xgb.DMatrix(data = as.matrix(z), label= as.integer(TRAIN2$target))
dtest = xgb.DMatrix(data = as.matrix(z2), label= as.integer(TEST2$target))

params = list(booster = "gbtree", objective = "binary:logistic", eta=0.01, gamma=0, max_depth=15, min_child_weight=5, subsample=1, colsample_bytree=1)
xgb_plant1_loc3_24h = xgb.train(params = params, data = dtrain, nrounds = 1000, nfold = 3, shows_48d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant1_loc3_24h, dtest)
## k = xgb.importance(feature_names=colnames(dtest), model = xgb_plant1_loc2_24h)
## g12 =xgb.ggplot.importance(k)
library(caret)
confusionMatrix(as.factor(ifelse(y_pred > 0.5, 1, 0)), as.factor(TEST2$target))


```

# plant1 48시간 후 결로 예측 모델

## p1 loc1_48h
```{r p1_loc1_48h}

dataset1 = plant1_1
dataset2 = plant1_2

target1 = dataset1[dataset1$mea_ddhr >= '2017-05-03 02:00:00',]$cond_loc1
target2 = dataset2[dataset2$mea_ddhr >= '2018-07-03 02:00:00',]$cond_loc1

dataset_1 = dataset1[1:length(target1),]
dataset_2 = dataset2[1:length(target2),]

dataset = rbind(dataset_1, dataset_2)
target = c(target1, target2)
dataset = dataset[,c(-24)]
dataset = cbind(dataset, target=target) %>% na.omit
SL=sample(1:nrow(dataset),nrow(dataset)*0.9, replace=TRUE)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN
TRAIN2$hum_48_sq_tem_48 = TRAIN2$hum_48 ** 2 * TRAIN2$tem_48
TRAIN2$summer_1_hum_48 = TRAIN2$summer_1 * TRAIN2$hum_48
TRAIN2$summer_0_hum_48 = TRAIN2$summer_0 * TRAIN2$hum_48
TRAIN2$summer_0_tem_48_sq = TRAIN2$summer_0 * TRAIN2$tem_48 ** 2
TRAIN2$wd_48_n_hum_48_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_s_hum_48_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_w_hum_48_ws_48 = TRAIN2$wd_48_w * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_n_hum_48_summer_0_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0
TRAIN2$wd_48_s_hum_48_summer_0_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0

TRAIN2$hum_48_sq_tem_48 = TRAIN2$hum_48 ** 2 * TRAIN2$tem_48
TRAIN2$tem_in_loc1_sq_tem_48 = TRAIN2$tem_in_loc1 ** 2 * TRAIN2$tem_48
TRAIN2$tem_pred_loc1_48 = predict(xgb_plant1_tem_in_loc1_48, 
                                   as.matrix(TRAIN2[,c('hum_48', 'tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'hi_48', 'tem_in_loc1', 'tem_in_loc1_sq_tem_48')]))

TRAIN2$coil_pred_loc1_48 = predict(xgb_plant1_tem_coil_loc1_48, 
                                    as.matrix(TRAIN2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48', 'tem_in_loc1', 'tem_in_loc1_sq_tem_48', 'tem_coil_loc1',
                                                        'tem_pred_loc1_48')]))
TRAIN2$dif_48 = TRAIN2$coil_pred_loc1_48 - dew_point(TRAIN2$tem_48, TRAIN2$hum_48)
TRAIN2$dif_out_48 = TRAIN2$tem_coil_loc1 - dew_point(TRAIN2$tem_out_loc1, TRAIN2$hum_out_loc1)
TRAIN2$tem_pred_loc1_48 = predict(xgb_plant1_tem_in_loc1_48, 
                                   as.matrix(TRAIN2[,c('hum_48', 'tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'hi_48', 'tem_in_loc1', 'tem_in_loc1_sq_tem_48')]))


TRAIN2$hum_pred_loc1_48 = predict(xgb_plant1_hum_in_loc1_48, 
                                   as.matrix(TRAIN2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'hi_48', 'summer_0', 'summer_1_hum_48',
                                                       'summer_0_hum_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48')]))
TRAIN2$pred_dif_loc1_48 = TRAIN2$coil_pred_loc1_48 - dew_point(TRAIN2$tem_pred_loc1_48, TRAIN2$hum_pred_loc1_48)
TRAIN2$pred_dif_dum_loc1_48 = as.integer(ifelse(TRAIN2$pred_dif_loc1_48 > 0.99, 0, 1))

z = TRAIN2[,c('pred_dif_dum_loc1_48', 'hum_48_sq_tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'hi_48'
               ,'tem_in_loc1', 'tem_coil_loc1', 'dif', 'dif_48', 'coil_pred_loc1_48', 'dif_out_48', 'tem_pred_loc1_48', 'hum_pred_loc1_48', 'pred_dif_loc1_48')]

TEST2 = TEST
TEST2$hum_48_sq_tem_48 = TEST2$hum_48 ** 2 * TEST2$tem_48
TEST2$summer_1_hum_48 = TEST2$summer_1 * TEST2$hum_48
TEST2$summer_0_hum_48 = TEST2$summer_0 * TEST2$hum_48
TEST2$summer_0_tem_48_sq = TEST2$summer_0 * TEST2$tem_48 ** 2
TEST2$wd_48_n_hum_48_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_s_hum_48_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_w_hum_48_ws_48 = TEST2$wd_48_w * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_n_hum_48_summer_0_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0
TEST2$wd_48_s_hum_48_summer_0_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0

TEST2$hum_48_sq_tem_48 = TEST2$hum_48 ** 2 * TEST2$tem_48
TEST2$tem_in_loc1_sq_tem_48 = TEST2$tem_in_loc1 ** 2 * TEST2$tem_48
TEST2$tem_pred_loc1_48 = predict(xgb_plant1_tem_in_loc1_48, 
                                   as.matrix(TEST2[,c('hum_48', 'tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'hi_48', 'tem_in_loc1', 'tem_in_loc1_sq_tem_48')]))

TEST2$coil_pred_loc1_48 = predict(xgb_plant1_tem_coil_loc1_48, 
                                   as.matrix(TEST2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48', 'tem_in_loc1', 'tem_in_loc1_sq_tem_48', 'tem_coil_loc1',
                                                      'tem_pred_loc1_48')]))
TEST2$dif_48 = TEST2$coil_pred_loc1_48 - dew_point(TEST2$tem_48, TEST2$hum_48)
TEST2$dif_out_48 = TEST2$tem_coil_loc1 - dew_point(TEST2$tem_out_loc1, TEST2$hum_out_loc1)
TEST2$tem_pred_loc1_48 = predict(xgb_plant1_tem_in_loc1_48, 
                                  as.matrix(TEST2[,c('hum_48', 'tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'hi_48', 'tem_in_loc1', 'tem_in_loc1_sq_tem_48')]))


TEST2$hum_pred_loc1_48 = predict(xgb_plant1_hum_in_loc1_48, 
                                  as.matrix(TEST2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'hi_48', 'summer_0', 'summer_1_hum_48',
                                                     'summer_0_hum_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48')]))
TEST2$pred_dif_loc1_48 = TEST2$coil_pred_loc1_48 - dew_point(TEST2$tem_pred_loc1_48, TEST2$hum_pred_loc1_48)
TEST2$pred_dif_dum_loc1_48 = as.integer(ifelse(TEST2$pred_dif_loc1_48 > 0.99, 0, 1))

z2 = TEST2[,c('pred_dif_dum_loc1_48', 'hum_48_sq_tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'hi_48'
               ,'tem_in_loc1', 'tem_coil_loc1', 'dif', 'dif_48', 'coil_pred_loc1_48', 'dif_out_48', 'tem_pred_loc1_48', 'hum_pred_loc1_48', 'pred_dif_loc1_48')]


dtrain = xgb.DMatrix(data = as.matrix(z), label= as.integer(TRAIN2$target))
dtest = xgb.DMatrix(data = as.matrix(z2), label= as.integer(TEST2$target))

params = list(booster = "gbtree", objective = "binary:logistic", eta=0.01, gamma=0, max_depth=15, min_child_weight=1, subsample=1, colsample_bytree=1)
xgb_plant1_loc1_48h = xgb.train(params = params, data = dtrain, nrounds = 1000, nfold = 3, shows_48d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant1_loc1_48h, dtest)
## k = xgb.importance(feature_names=colnames(dtest), model = xgb_plant1_loc1_48h)
## g14 = xgb.ggplot.importance(k)
library(caret)
confusionMatrix(as.factor(ifelse(y_pred > 0.5, 1, 0)), as.factor(TEST2$target))
```

## p1 loc2_48h
```{r p1_loc2_48h}
dataset1 = plant1_1
dataset2 = plant1_2

target1 = dataset1[dataset1$mea_ddhr >= '2017-05-03 02:00:00',]$cond_loc2
target2 = dataset2[dataset2$mea_ddhr >= '2018-07-03 02:00:00',]$cond_loc2

dataset_1 = dataset1[1:length(target1),]
dataset_2 = dataset2[1:length(target2),]

dataset = rbind(dataset_1, dataset_2)
target = c(target1, target2)
dataset = dataset[,c(-24)]
dataset = cbind(dataset, target=target) %>% na.omit
SL=sample(1:nrow(dataset),nrow(dataset)*0.9, replace=TRUE)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN
TRAIN2$hum_48_sq_tem_48 = TRAIN2$hum_48 ** 2 * TRAIN2$tem_48
TRAIN2$summer_1_hum_48 = TRAIN2$summer_1 * TRAIN2$hum_48
TRAIN2$summer_0_hum_48 = TRAIN2$summer_0 * TRAIN2$hum_48
TRAIN2$summer_0_tem_48_sq = TRAIN2$summer_0 * TRAIN2$tem_48 ** 2
TRAIN2$wd_48_n_hum_48_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_s_hum_48_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_w_hum_48_ws_48 = TRAIN2$wd_48_w * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_n_hum_48_summer_0_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0
TRAIN2$wd_48_s_hum_48_summer_0_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0

TRAIN2$hum_48_sq_tem_48 = TRAIN2$hum_48 ** 2 * TRAIN2$tem_48
TRAIN2$tem_in_loc2_sq_tem_48 = TRAIN2$tem_in_loc2 ** 2 * TRAIN2$tem_48
TRAIN2$tem_pred_loc2_48 = predict(xgb_plant1_tem_in_loc2_48, 
                                   as.matrix(TRAIN2[,c('hum_48', 'tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'hi_48', 'tem_in_loc2', 'tem_in_loc2_sq_tem_48')]))


TRAIN2$coil_pred_loc2_48 = predict(xgb_plant1_tem_coil_loc2_48, 
                                    as.matrix(TRAIN2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48', 'tem_in_loc2', 'tem_in_loc2_sq_tem_48', 'tem_coil_loc2',
                                                        'tem_pred_loc2_48')]))
TRAIN2$dif_48 = TRAIN2$coil_pred_loc2_48 - dew_point(TRAIN2$tem_48, TRAIN2$hum_48)
TRAIN2$dif_out_48 = TRAIN2$tem_coil_loc2 - dew_point(TRAIN2$tem_out_loc1, TRAIN2$hum_out_loc1)
TRAIN2$tem_pred_loc2_48 = predict(xgb_plant1_tem_in_loc2_48, 
                                   as.matrix(TRAIN2[,c('hum_48', 'tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'hi_48', 'tem_in_loc2', 'tem_in_loc2_sq_tem_48')]))


TRAIN2$hum_pred_loc2_48 = predict(xgb_plant1_hum_in_loc2_48, 
                                   as.matrix(TRAIN2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'hi_48', 'summer_1', 'summer_0', 'summer_1_hum_48',
                                                       'summer_0_hum_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48')]))
TRAIN2$pred_dif_loc2_48 = TRAIN2$coil_pred_loc2_48 - dew_point(TRAIN2$tem_pred_loc2_48, TRAIN2$hum_pred_loc2_48)
TRAIN2$pred_dif_dum_loc2_48 = as.integer(ifelse(TRAIN2$pred_dif_loc2_48 > 0.99, 0, 1))

z = TRAIN2[,c('pred_dif_dum_loc2_48', 'hum_48_sq_tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'hi_48'
               ,'tem_in_loc2', 'tem_coil_loc2', 'dif', 'dif_48', 'coil_pred_loc2_48', 'dif_out_48', 'tem_pred_loc2_48', 'hum_pred_loc2_48', 'pred_dif_loc2_48')]

TEST2 = TEST
TEST2$hum_48_sq_tem_48 = TEST2$hum_48 ** 2 * TEST2$tem_48
TEST2$summer_1_hum_48 = TEST2$summer_1 * TEST2$hum_48
TEST2$summer_0_hum_48 = TEST2$summer_0 * TEST2$hum_48
TEST2$summer_0_tem_48_sq = TEST2$summer_0 * TEST2$tem_48 ** 2
TEST2$wd_48_n_hum_48_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_s_hum_48_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_w_hum_48_ws_48 = TEST2$wd_48_w * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_n_hum_48_summer_0_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0
TEST2$wd_48_s_hum_48_summer_0_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0

TEST2$hum_48_sq_tem_48 = TEST2$hum_48 ** 2 * TEST2$tem_48
TEST2$tem_in_loc2_sq_tem_48 = TEST2$tem_in_loc2 ** 2 * TEST2$tem_48
TEST2$tem_pred_loc2_48 = predict(xgb_plant1_tem_in_loc2_48, 
                                   as.matrix(TEST2[,c('hum_48', 'tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'hi_48', 'tem_in_loc2', 'tem_in_loc2_sq_tem_48')]))


TEST2$coil_pred_loc2_48 = predict(xgb_plant1_tem_coil_loc2_48, 
                                   as.matrix(TEST2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48', 'tem_in_loc2', 'tem_in_loc2_sq_tem_48', 'tem_coil_loc2',
                                                      'tem_pred_loc2_48')]))
TEST2$dif_48 = TEST2$coil_pred_loc2_48 - dew_point(TEST2$tem_48, TEST2$hum_48)
TEST2$dif_out_48 = TEST2$tem_coil_loc2 - dew_point(TEST2$tem_out_loc1, TEST2$hum_out_loc1)
TEST2$tem_pred_loc2_48 = predict(xgb_plant1_tem_in_loc2_48, 
                                  as.matrix(TEST2[,c('hum_48', 'tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'hi_48', 'tem_in_loc2', 'tem_in_loc2_sq_tem_48')]))


TEST2$hum_pred_loc2_48 = predict(xgb_plant1_hum_in_loc2_48, 
                                  as.matrix(TEST2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'hi_48', 'summer_1', 'summer_0', 'summer_1_hum_48',
                                                     'summer_0_hum_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48')]))
TEST2$pred_dif_loc2_48 = TEST2$coil_pred_loc2_48 - dew_point(TEST2$tem_pred_loc2_48, TEST2$hum_pred_loc2_48)
TEST2$pred_dif_dum_loc2_48 = as.integer(ifelse(TEST2$pred_dif_loc2_48 > 0.99, 0, 1))



z2 = TEST2[,c('pred_dif_dum_loc2_48', 'hum_48_sq_tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'hi_48'
               ,'tem_in_loc2', 'tem_coil_loc2', 'dif', 'dif_48', 'coil_pred_loc2_48', 'dif_out_48', 'tem_pred_loc2_48', 'hum_pred_loc2_48', 'pred_dif_loc2_48')]


dtrain = xgb.DMatrix(data = as.matrix(z), label= as.integer(TRAIN2$target))
dtest = xgb.DMatrix(data = as.matrix(z2), label= as.integer(TEST2$target))

params = list(booster = "gbtree", objective = "binary:logistic", eta=0.01, gamma=0, max_depth=15, min_child_weight=1, subsample=1, colsample_bytree=1)
xgb_plant1_loc2_48h = xgb.train(params = params, data = dtrain, nrounds = 1000, nfold = 3, shows_48d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant1_loc2_48h, dtest)
## k = xgb.importance(feature_names=colnames(dtest), model = xgb_plant1_48h)
## g15 = xgb.ggplot.importance(k)
library(caret)
confusionMatrix(as.factor(ifelse(y_pred > 0.5, 1, 0)), as.factor(TEST2$target))

```

## p1 loc3_48h
```{r p1_loc3_48h}

dataset1 = plant1_1
dataset2 = plant1_2

target1 = dataset1[dataset1$mea_ddhr >= '2017-05-03 02:00:00',]$cond_loc3
target2 = dataset2[dataset2$mea_ddhr >= '2018-07-03 02:00:00',]$cond_loc3

dataset_1 = dataset1[1:length(target1),]
dataset_2 = dataset2[1:length(target2),]

dataset = rbind(dataset_1, dataset_2)
target = c(target1, target2)
dataset = dataset[,c(-24)]
dataset = cbind(dataset, target=target) %>% na.omit
SL=sample(1:nrow(dataset),nrow(dataset)*0.9, replace=TRUE)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN
TRAIN2$hum_48_sq_tem_48 = TRAIN2$hum_48 ** 2 * TRAIN2$tem_48
TRAIN2$summer_1_hum_48 = TRAIN2$summer_1 * TRAIN2$hum_48
TRAIN2$summer_0_hum_48 = TRAIN2$summer_0 * TRAIN2$hum_48
TRAIN2$summer_0_tem_48_sq = TRAIN2$summer_0 * TRAIN2$tem_48 ** 2
TRAIN2$wd_48_n_hum_48_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_s_hum_48_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_w_hum_48_ws_48 = TRAIN2$wd_48_w * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_n_hum_48_summer_0_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0
TRAIN2$wd_48_s_hum_48_summer_0_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0

TRAIN2$hum_48_sq_tem_48 = TRAIN2$hum_48 ** 2 * TRAIN2$tem_48
TRAIN2$tem_in_loc3_sq_tem_48 = TRAIN2$tem_in_loc3 ** 2 * TRAIN2$tem_48
TRAIN2$tem_pred_loc3_48 = predict(xgb_plant1_tem_in_loc3_48, 
                                   as.matrix(TRAIN2[,c('hum_48', 'tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'hi_48', 'tem_in_loc3', 'tem_in_loc3_sq_tem_48')]))


TRAIN2$coil_pred_loc3_48 = predict(xgb_plant1_tem_coil_loc3_48, 
                                    as.matrix(TRAIN2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48', 'tem_in_loc3', 'tem_in_loc3_sq_tem_48', 'tem_coil_loc3',
                                                        'tem_pred_loc3_48')]))
TRAIN2$dif_48 = TRAIN2$coil_pred_loc3_48 - dew_point(TRAIN2$tem_48, TRAIN2$hum_48)
TRAIN2$dif_out_48 = TRAIN2$tem_coil_loc3 - dew_point(TRAIN2$tem_out_loc1, TRAIN2$hum_out_loc1)
TRAIN2$tem_pred_loc3_48 = predict(xgb_plant1_tem_in_loc3_48, 
                                   as.matrix(TRAIN2[,c('hum_48', 'tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'hi_48', 'tem_in_loc3', 'tem_in_loc3_sq_tem_48')]))


TRAIN2$hum_pred_loc3_48 = predict(xgb_plant1_hum_in_loc3_48, 
                                   as.matrix(TRAIN2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'hi_48', 'summer_1', 'summer_0', 'summer_1_hum_48',
                                                       'summer_0_hum_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48')]))
TRAIN2$pred_dif_loc3_48 = TRAIN2$coil_pred_loc3_48 - dew_point(TRAIN2$tem_pred_loc3_48, TRAIN2$hum_pred_loc3_48)
TRAIN2$pred_dif_dum_loc3_48 = as.integer(ifelse(TRAIN2$pred_dif_loc3_48 > 0.99, 0, 1))

z = TRAIN2[,c('pred_dif_dum_loc3_48', 'hum_48_sq_tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'hi_48'
               ,'tem_in_loc3', 'tem_coil_loc3', 'dif', 'dif_48', 'coil_pred_loc3_48', 'dif_out_48', 'tem_pred_loc3_48', 'hum_pred_loc3_48', 'pred_dif_loc3_48')]

TEST2 = TEST
TEST2$hum_48_sq_tem_48 = TEST2$hum_48 ** 2 * TEST2$tem_48
TEST2$summer_1_hum_48 = TEST2$summer_1 * TEST2$hum_48
TEST2$summer_0_hum_48 = TEST2$summer_0 * TEST2$hum_48
TEST2$summer_0_tem_48_sq = TEST2$summer_0 * TEST2$tem_48 ** 2
TEST2$wd_48_n_hum_48_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_s_hum_48_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_w_hum_48_ws_48 = TEST2$wd_48_w * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_n_hum_48_summer_0_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0
TEST2$wd_48_s_hum_48_summer_0_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0

TEST2$hum_48_sq_tem_48 = TEST2$hum_48 ** 2 * TEST2$tem_48
TEST2$tem_in_loc3_sq_tem_48 = TEST2$tem_in_loc3 ** 2 * TEST2$tem_48
TEST2$tem_pred_loc3_48 = predict(xgb_plant1_tem_in_loc3_48, 
                                   as.matrix(TEST2[,c('hum_48', 'tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'hi_48', 'tem_in_loc3', 'tem_in_loc3_sq_tem_48')]))


TEST2$coil_pred_loc3_48 = predict(xgb_plant1_tem_coil_loc3_48, 
                                   as.matrix(TEST2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48', 'tem_in_loc3', 'tem_in_loc3_sq_tem_48', 'tem_coil_loc3',
                                                      'tem_pred_loc3_48')]))
TEST2$dif_48 = TEST2$coil_pred_loc3_48 - dew_point(TEST2$tem_48, TEST2$hum_48)
TEST2$dif_out_48 = TEST2$tem_coil_loc3 - dew_point(TEST2$tem_out_loc1, TEST2$hum_out_loc1)
TEST2$tem_pred_loc3_48 = predict(xgb_plant1_tem_in_loc3_48, 
                                  as.matrix(TEST2[,c('hum_48', 'tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'hi_48', 'tem_in_loc3', 'tem_in_loc3_sq_tem_48')]))


TEST2$hum_pred_loc3_48 = predict(xgb_plant1_hum_in_loc3_48, 
                                  as.matrix(TEST2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'hi_48', 'summer_1', 'summer_0', 'summer_1_hum_48',
                                                     'summer_0_hum_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48')]))
TEST2$pred_dif_loc3_48 = TEST2$coil_pred_loc3_48 - dew_point(TEST2$tem_pred_loc3_48, TEST2$hum_pred_loc3_48)
TEST2$pred_dif_dum_loc3_48 = as.integer(ifelse(TEST2$pred_dif_loc3_48 > 0.99, 0, 1))

z2 = TEST2[,c('pred_dif_dum_loc3_48', 'hum_48_sq_tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'hi_48'
               ,'tem_in_loc3', 'tem_coil_loc3', 'dif', 'dif_48', 'coil_pred_loc3_48', 'dif_out_48', 'tem_pred_loc3_48', 'hum_pred_loc3_48', 'pred_dif_loc3_48')]

dtrain = xgb.DMatrix(data = as.matrix(z), label= as.integer(TRAIN2$target))
dtest = xgb.DMatrix(data = as.matrix(z2), label= as.integer(TEST2$target))

params = list(booster = "gbtree", objective = "binary:logistic", eta=0.01, gamma=0, max_depth=15, min_child_weight=1, subsample=1, colsample_bytree=1)
xgb_plant1_loc3_48h = xgb.train(params = params, data = dtrain, nrounds = 1000, nfold = 3, shows_48d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant1_loc3_48h, dtest)
## k = xgb.importance(feature_names=colnames(dtest), model = xgb_plant1_loc3_48h)
## g16 = xgb.ggplot.importance(k)
library(caret)
confusionMatrix(as.factor(ifelse(y_pred > 0.5, 1, 0)), as.factor(TEST2$target))

```

# plant2 24시간 후 결로 예측 모델

## p2 loc1_24h
```{r p2_loc1_24h}

dataset3 = plant2_1
dataset4 = plant2_2

target1 = dataset3[dataset3$mea_ddhr >= '2017-05-02 02:00:00',]$cond_loc1
target2 = dataset4[dataset4$mea_ddhr >= '2018-07-02 02:00:00',]$cond_loc1

dataset_3 = dataset3[1:length(target1),]
dataset_4 = dataset4[1:length(target2),]

dataset = rbind(dataset_3, dataset_4)
dataset = dataset[,c(-23)]
target = c(target1, target2)
dataset = cbind(dataset, target=target) %>% na.omit()
SL=sample(1:nrow(dataset),nrow(dataset)*0.9, replace=TRUE)

TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN
TRAIN2$hum_24_sq_tem_24 = TRAIN2$hum_24 ** 2 * TRAIN2$tem_24
TRAIN2$summer_1_hum_24 = TRAIN2$summer_1 * TRAIN2$hum_24
TRAIN2$summer_0_hum_24 = TRAIN2$summer_0 * TRAIN2$hum_24
TRAIN2$summer_0_tem_24_sq = TRAIN2$summer_0 * TRAIN2$tem_24 ** 2
TRAIN2$wd_24_n_hum_24_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_s_hum_24_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_w_hum_24_ws_24 = TRAIN2$wd_24_w * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_n_hum_24_summer_0_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$wd_24_s_hum_24_summer_0_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0

TRAIN2$hum_24_sq_tem_24 = TRAIN2$hum_24 ** 2 * TRAIN2$tem_24
TRAIN2$tem_in_loc1_sq_tem_24 = TRAIN2$tem_in_loc1 ** 2 * TRAIN2$tem_24
TRAIN2$tem_pred_loc1_24 = predict(xgb_plant2_tem_in_loc1_24, 
                                   as.matrix(TRAIN2[,c('hum_24', 'tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24',  'hi_24', 'tem_in_loc1', 'tem_in_loc1_sq_tem_24')]))

TRAIN2$coil_pred_loc1_24 = predict(xgb_plant2_tem_coil_loc1_24, 
                                    as.matrix(TRAIN2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24', 'tem_in_loc1', 'tem_in_loc1_sq_tem_24', 'tem_coil_loc1',
                                                        'tem_pred_loc1_24')]))
TRAIN2$dif_24 = TRAIN2$coil_pred_loc1_24 - dew_point(TRAIN2$tem_24, TRAIN2$hum_24)
TRAIN2$dif_out_24 = TRAIN2$tem_coil_loc1 - dew_point(TRAIN2$tem_out_loc1, TRAIN2$hum_out_loc1)
TRAIN2$tem_pred_loc1_24 = predict(xgb_plant2_tem_in_loc1_24, 
                                   as.matrix(TRAIN2[,c('hum_24', 'tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24', 'hi_24', 'tem_in_loc1', 'tem_in_loc1_sq_tem_24')]))


TRAIN2$hum_pred_loc1_24 = predict(xgb_plant2_hum_in_loc1_24, 
                                   as.matrix(TRAIN2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24', 'hi_24', 'summer_0', 'summer_1_hum_24',
                                                       'summer_0_hum_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24')]))
TRAIN2$pred_dif_loc1_24 = TRAIN2$coil_pred_loc1_24 - dew_point(TRAIN2$tem_pred_loc1_24, TRAIN2$hum_pred_loc1_24)
TRAIN2$pred_dif_dum_loc1_24 = as.integer(ifelse(TRAIN2$pred_dif_loc1_24 > 0.99, 0, 1))

z = TRAIN2[,c('pred_dif_dum_loc1_24', 'hum_24_sq_tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24', 'hi_24'
               ,'tem_in_loc1', 'tem_coil_loc1', 'dif', 'dif_24', 'coil_pred_loc1_24', 'dif_out_24', 'tem_pred_loc1_24', 'hum_pred_loc1_24', 'pred_dif_loc1_24')]

TEST2 = TEST
TEST2$hum_24_sq_tem_24 = TEST2$hum_24 ** 2 * TEST2$tem_24
TEST2$summer_1_hum_24 = TEST2$summer_1 * TEST2$hum_24
TEST2$summer_0_hum_24 = TEST2$summer_0 * TEST2$hum_24
TEST2$summer_0_tem_24_sq = TEST2$summer_0 * TEST2$tem_24 ** 2
TEST2$wd_24_n_hum_24_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_s_hum_24_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_w_hum_24_ws_24 = TEST2$wd_24_w * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_n_hum_24_summer_0_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0
TEST2$wd_24_s_hum_24_summer_0_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0

TEST2$hum_24_sq_tem_24 = TEST2$hum_24 ** 2 * TEST2$tem_24
TEST2$tem_in_loc1_sq_tem_24 = TEST2$tem_in_loc1 ** 2 * TEST2$tem_24
TEST2$tem_pred_loc1_24 = predict(xgb_plant2_tem_in_loc1_24, 
                                   as.matrix(TEST2[,c('hum_24', 'tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24',  'hi_24', 'tem_in_loc1', 'tem_in_loc1_sq_tem_24')]))

TEST2$coil_pred_loc1_24 = predict(xgb_plant2_tem_coil_loc1_24, 
                                   as.matrix(TEST2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24', 'tem_in_loc1', 'tem_in_loc1_sq_tem_24', 'tem_coil_loc1',
                                                      'tem_pred_loc1_24')]))
TEST2$dif_24 = TEST2$coil_pred_loc1_24 - dew_point(TEST2$tem_24, TEST2$hum_24)
TEST2$dif_out_24 = TEST2$tem_coil_loc1- dew_point(TEST2$tem_out_loc1, TEST2$hum_out_loc1)
TEST2$tem_pred_loc1_24 = predict(xgb_plant2_tem_in_loc1_24, 
                                  as.matrix(TEST2[,c('hum_24', 'tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24', 'hi_24', 'tem_in_loc1', 'tem_in_loc1_sq_tem_24')]))


TEST2$hum_pred_loc1_24 = predict(xgb_plant2_hum_in_loc1_24, 
                                  as.matrix(TEST2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24', 'hi_24', 'summer_0', 'summer_1_hum_24',
                                                     'summer_0_hum_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24')]))
TEST2$pred_dif_loc1_24 = TEST2$coil_pred_loc1_24 - dew_point(TEST2$tem_pred_loc1_24, TEST2$hum_pred_loc1_24)
TEST2$pred_dif_dum_loc1_24 = as.integer(ifelse(TEST2$pred_dif_loc1_24 > 0.99, 0, 1))

z2 = TEST2[,c('pred_dif_dum_loc1_24', 'hum_24_sq_tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24', 'hi_24'
               ,'tem_in_loc1', 'tem_coil_loc1', 'dif', 'dif_24', 'coil_pred_loc1_24', 'dif_out_24', 'tem_pred_loc1_24', 'hum_pred_loc1_24', 'pred_dif_loc1_24')]


dtrain = xgb.DMatrix(data = as.matrix(z), label= as.integer(TRAIN2$target))
dtest = xgb.DMatrix(data = as.matrix(z2), label= as.integer(TEST2$target))

params = list(booster = "gbtree", objective = "binary:logistic", eta=0.01, gamma=0, max_depth=15, min_child_weight=5, subsample=1, colsample_bytree=1)
xgb_plant2_loc1_24h = xgb.train(params = params, data = dtrain, nrounds = 1000, nfold = 3, shows_48d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant2_loc1_24h, dtest)
## k = xgb.importance(feature_names=colnames(dtest), model = xgb_plant2_loc1_24h)
## g11 =xgb.ggplot.importance(k)
library(caret)
confusionMatrix(as.factor(ifelse(y_pred > 0.5, 1, 0)), as.factor(TEST2$target))

```

## p2 loc2_24h
```{r p2_loc2_24h}
dataset3 = plant2_1
dataset4 = plant2_2

target1 = dataset3[dataset3$mea_ddhr >= '2017-05-02 02:00:00',]$cond_loc2
target2 = dataset4[dataset4$mea_ddhr >= '2018-07-02 02:00:00',]$cond_loc2

dataset_3 = dataset3[1:length(target1),]
dataset_4 = dataset4[1:length(target2),]

dataset = rbind(dataset_3, dataset_4)
dataset = dataset[,c(-23)]
target = c(target1, target2)
dataset = cbind(dataset, target=target) %>% na.omit()
SL=sample(1:nrow(dataset),nrow(dataset)*0.9, replace=TRUE)

TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN
TRAIN2$hum_24_sq_tem_24 = TRAIN2$hum_24 ** 2 * TRAIN2$tem_24
TRAIN2$summer_1_hum_24 = TRAIN2$summer_1 * TRAIN2$hum_24
TRAIN2$summer_0_hum_24 = TRAIN2$summer_0 * TRAIN2$hum_24
TRAIN2$summer_0_tem_24_sq = TRAIN2$summer_0 * TRAIN2$tem_24 ** 2
TRAIN2$wd_24_n_hum_24_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_s_hum_24_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_w_hum_24_ws_24 = TRAIN2$wd_24_w * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_n_hum_24_summer_0_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$wd_24_s_hum_24_summer_0_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0

TRAIN2$hum_24_sq_tem_24 = TRAIN2$hum_24 ** 2 * TRAIN2$tem_24
TRAIN2$tem_in_loc2_sq_tem_24 = TRAIN2$tem_in_loc2 ** 2 * TRAIN2$tem_24
TRAIN2$tem_pred_loc2_24 = predict(xgb_plant2_tem_in_loc2_24, 
                                   as.matrix(TRAIN2[,c('hum_24', 'tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24',  'hi_24', 'tem_in_loc2', 'tem_in_loc2_sq_tem_24')]))

TRAIN2$coil_pred_loc2_24 = predict(xgb_plant2_tem_coil_loc2_24, 
                                    as.matrix(TRAIN2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24', 'tem_in_loc2', 'tem_in_loc2_sq_tem_24', 'tem_coil_loc2',
                                                        'tem_pred_loc2_24')]))
TRAIN2$dif_24 = TRAIN2$coil_pred_loc2_24 - dew_point(TRAIN2$tem_24, TRAIN2$hum_24)
TRAIN2$dif_out_24 = TRAIN2$tem_coil_loc2 - dew_point(TRAIN2$tem_out_loc1, TRAIN2$hum_out_loc1)
TRAIN2$tem_pred_loc2_24 = predict(xgb_plant2_tem_in_loc2_24, 
                                   as.matrix(TRAIN2[,c('hum_24', 'tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'hi_24', 'tem_in_loc2', 'tem_in_loc2_sq_tem_24')]))

TRAIN2$hum_pred_loc2_24 = predict(xgb_plant2_hum_in_loc2_24, 
                                   as.matrix(TRAIN2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'hi_24', 'summer_1', 'summer_0', 'summer_1_hum_24',
                                                       'summer_0_hum_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24')]))
TRAIN2$pred_dif_loc2_24 = TRAIN2$coil_pred_loc2_24 - dew_point(TRAIN2$tem_pred_loc2_24, TRAIN2$hum_pred_loc2_24)
TRAIN2$pred_dif_dum_loc2_24 = as.integer(ifelse(TRAIN2$pred_dif_loc2_24 > 0.99, 0, 1))

z = TRAIN2[,c('pred_dif_dum_loc2_24', 'hum_24_sq_tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'hi_24'
               ,'tem_in_loc2', 'tem_coil_loc2', 'dif', 'dif_24', 'coil_pred_loc2_24', 'dif_out_24', 'tem_pred_loc2_24', 'hum_pred_loc2_24', 'pred_dif_loc2_24')]

TEST2 = TEST
TEST2$hum_24_sq_tem_24 = TEST2$hum_24 ** 2 * TEST2$tem_24
TEST2$summer_1_hum_24 = TEST2$summer_1 * TEST2$hum_24
TEST2$summer_0_hum_24 = TEST2$summer_0 * TEST2$hum_24
TEST2$summer_0_tem_24_sq = TEST2$summer_0 * TEST2$tem_24 ** 2
TEST2$wd_24_n_hum_24_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_s_hum_24_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_w_hum_24_ws_24 = TEST2$wd_24_w * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_n_hum_24_summer_0_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0
TEST2$wd_24_s_hum_24_summer_0_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0

TEST2$hum_24_sq_tem_24 = TEST2$hum_24 ** 2 * TEST2$tem_24
TEST2$tem_in_loc2_sq_tem_24 = TEST2$tem_in_loc2 ** 2 * TEST2$tem_24
TEST2$tem_pred_loc2_24 = predict(xgb_plant2_tem_in_loc2_24, 
                                   as.matrix(TEST2[,c('hum_24', 'tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24',  'hi_24', 'tem_in_loc2', 'tem_in_loc2_sq_tem_24')]))

TEST2$coil_pred_loc2_24 = predict(xgb_plant2_tem_coil_loc2_24, 
                                   as.matrix(TEST2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24', 'tem_in_loc2', 'tem_in_loc2_sq_tem_24', 'tem_coil_loc2',
                                                      'tem_pred_loc2_24')]))
TEST2$dif_24 = TEST2$coil_pred_loc2_24 - dew_point(TEST2$tem_24, TEST2$hum_24)
TEST2$dif_out_24 = TEST2$tem_coil_loc2 - dew_point(TEST2$tem_out_loc1, TEST2$hum_out_loc1)
TEST2$tem_pred_loc2_24 = predict(xgb_plant2_tem_in_loc2_24, 
                                  as.matrix(TEST2[,c('hum_24', 'tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'hi_24', 'tem_in_loc2', 'tem_in_loc2_sq_tem_24')]))

TEST2$hum_pred_loc2_24 = predict(xgb_plant2_hum_in_loc2_24, 
                                  as.matrix(TEST2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'hi_24', 'summer_1', 'summer_0', 'summer_1_hum_24',
                                                     'summer_0_hum_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24')]))
TEST2$pred_dif_loc2_24 = TEST2$coil_pred_loc2_24 - dew_point(TEST2$tem_pred_loc2_24, TEST2$hum_pred_loc2_24)
TEST2$pred_dif_dum_loc2_24 = as.integer(ifelse(TEST2$pred_dif_loc2_24 > 0.99, 0, 1))

z2 = TEST2[,c('pred_dif_dum_loc2_24', 'hum_24_sq_tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'hi_24'
               ,'tem_in_loc2', 'tem_coil_loc2', 'dif', 'dif_24', 'coil_pred_loc2_24', 'dif_out_24', 'tem_pred_loc2_24', 'hum_pred_loc2_24', 'pred_dif_loc2_24')]


dtrain = xgb.DMatrix(data = as.matrix(z), label= as.integer(TRAIN2$target))
dtest = xgb.DMatrix(data = as.matrix(z2), label= as.integer(TEST2$target))

params = list(booster = "gbtree", objective = "binary:logistic", eta=0.01, gamma=0, max_depth=15, min_child_weight=5, subsample=1, colsample_bytree=1)
xgb_plant2_loc2_24h = xgb.train(params = params, data = dtrain, nrounds = 1000, nfold = 3, shows_48d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant2_loc2_24h, dtest)
## k = xgb.importance(feature_names=colnames(dtest), model = xgb_plant2_loc2_24h)
## g12 =xgb.ggplot.importance(k)
library(caret)
confusionMatrix(as.factor(ifelse(y_pred > 0.5, 1, 0)), as.factor(TEST2$target))
```

## p2 loc3_24h
```{r p2_loc3_24h}
dataset3 = plant2_1
dataset4 = plant2_2

target1 = dataset3[dataset3$mea_ddhr >= '2017-05-02 02:00:00',]$cond_loc3
target2 = dataset4[dataset4$mea_ddhr >= '2018-07-02 02:00:00',]$cond_loc3

dataset_3 = dataset3[1:length(target1),]
dataset_4 = dataset4[1:length(target2),]

dataset = rbind(dataset_3, dataset_4)
dataset = dataset[,c(-23)]
target = c(target1, target2)
dataset = cbind(dataset, target=target) %>% na.omit()
SL=sample(1:nrow(dataset),nrow(dataset)*0.9, replace=TRUE)

TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN
TRAIN2$hum_24_sq_tem_24 = TRAIN2$hum_24 ** 2 * TRAIN2$tem_24
TRAIN2$summer_1_hum_24 = TRAIN2$summer_1 * TRAIN2$hum_24
TRAIN2$summer_0_hum_24 = TRAIN2$summer_0 * TRAIN2$hum_24
TRAIN2$summer_0_tem_24_sq = TRAIN2$summer_0 * TRAIN2$tem_24 ** 2
TRAIN2$wd_24_n_hum_24_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_s_hum_24_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_w_hum_24_ws_24 = TRAIN2$wd_24_w * TRAIN2$hum_24 * TRAIN2$ws_24
TRAIN2$wd_24_n_hum_24_summer_0_ws_24 = TRAIN2$wd_24_n * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0
TRAIN2$wd_24_s_hum_24_summer_0_ws_24 = TRAIN2$wd_24_s * TRAIN2$hum_24 * TRAIN2$ws_24 * TRAIN2$summer_0

TRAIN2$hum_24_sq_tem_24 = TRAIN2$hum_24 ** 2 * TRAIN2$tem_24
TRAIN2$tem_in_loc3_sq_tem_24 = TRAIN2$tem_in_loc3 ** 2 * TRAIN2$tem_24
TRAIN2$tem_pred_loc3_24 = predict(xgb_plant2_tem_in_loc3_24, 
                                   as.matrix(TRAIN2[,c('hum_24', 'tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24',  'hi_24', 'tem_in_loc3', 'tem_in_loc3_sq_tem_24')]))

TRAIN2$coil_pred_loc3_24 = predict(xgb_plant2_tem_coil_loc3_24, 
                                    as.matrix(TRAIN2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24', 'tem_in_loc3', 'tem_in_loc3_sq_tem_24', 'tem_coil_loc3',
                                                        'tem_pred_loc3_24')]))
TRAIN2$dif_24 = TRAIN2$coil_pred_loc3_24 - dew_point(TRAIN2$tem_24, TRAIN2$hum_24)
TRAIN2$dif_out_24 = TRAIN2$tem_coil_loc3 - dew_point(TRAIN2$tem_out_loc1, TRAIN2$hum_out_loc1)
TRAIN2$tem_pred_loc3_24 = predict(xgb_plant2_tem_in_loc3_24, 
                                   as.matrix(TRAIN2[,c('hum_24', 'tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'hi_24', 'tem_in_loc3', 'tem_in_loc3_sq_tem_24')]))

TRAIN2$hum_pred_loc3_24 = predict(xgb_plant2_hum_in_loc3_24, 
                                   as.matrix(TRAIN2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'hi_24', 'summer_1', 'summer_0', 'summer_1_hum_24',
                                                       'summer_0_hum_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24')]))
TRAIN2$pred_dif_loc3_24 = TRAIN2$coil_pred_loc3_24 - dew_point(TRAIN2$tem_pred_loc3_24, TRAIN2$hum_pred_loc3_24)
TRAIN2$pred_dif_dum_loc3_24 = as.integer(ifelse(TRAIN2$pred_dif_loc3_24 > 0.99, 0, 1))

z = TRAIN2[,c('pred_dif_dum_loc3_24', 'hum_24_sq_tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'hi_24'
               ,'tem_in_loc3', 'tem_coil_loc3', 'dif', 'dif_24', 'coil_pred_loc3_24', 'dif_out_24', 'tem_pred_loc3_24', 'hum_pred_loc3_24', 'pred_dif_loc3_24')]

TEST2 = TEST
TEST2$hum_24_sq_tem_24 = TEST2$hum_24 ** 2 * TEST2$tem_24
TEST2$summer_1_hum_24 = TEST2$summer_1 * TEST2$hum_24
TEST2$summer_0_hum_24 = TEST2$summer_0 * TEST2$hum_24
TEST2$summer_0_tem_24_sq = TEST2$summer_0 * TEST2$tem_24 ** 2
TEST2$wd_24_n_hum_24_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_s_hum_24_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_w_hum_24_ws_24 = TEST2$wd_24_w * TEST2$hum_24 * TEST2$ws_24
TEST2$wd_24_n_hum_24_summer_0_ws_24 = TEST2$wd_24_n * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0
TEST2$wd_24_s_hum_24_summer_0_ws_24 = TEST2$wd_24_s * TEST2$hum_24 * TEST2$ws_24 * TEST2$summer_0

TEST2$hum_24_sq_tem_24 = TEST2$hum_24 ** 2 * TEST2$tem_24
TEST2$tem_in_loc3_sq_tem_24 = TEST2$tem_in_loc3 ** 2 * TEST2$tem_24
TEST2$tem_pred_loc3_24 = predict(xgb_plant2_tem_in_loc3_24, 
                                   as.matrix(TEST2[,c('hum_24', 'tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24',  'hi_24', 'tem_in_loc3', 'tem_in_loc3_sq_tem_24')]))

TEST2$coil_pred_loc3_24 = predict(xgb_plant2_tem_coil_loc3_24, 
                                   as.matrix(TEST2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24', 'tem_in_loc3', 'tem_in_loc3_sq_tem_24', 'tem_coil_loc3',
                                                      'tem_pred_loc3_24')]))
TEST2$dif_24 = TEST2$coil_pred_loc3_24 - dew_point(TEST2$tem_24, TEST2$hum_24)
TEST2$dif_out_24 = TEST2$tem_coil_loc3 - dew_point(TEST2$tem_out_loc1, TEST2$hum_out_loc1)
TEST2$tem_pred_loc3_24 = predict(xgb_plant2_tem_in_loc3_24, 
                                  as.matrix(TEST2[,c('hum_24', 'tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'hi_24', 'tem_in_loc3', 'tem_in_loc3_sq_tem_24')]))

TEST2$hum_pred_loc3_24 = predict(xgb_plant2_hum_in_loc3_24, 
                                  as.matrix(TEST2[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'hi_24', 'summer_1', 'summer_0', 'summer_1_hum_24',
                                                     'summer_0_hum_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24')]))
TEST2$pred_dif_loc3_24 = TEST2$coil_pred_loc3_24 - dew_point(TEST2$tem_pred_loc3_24, TEST2$hum_pred_loc3_24)
TEST2$pred_dif_dum_loc3_24 = as.integer(ifelse(TEST2$pred_dif_loc3_24 > 0.99, 0, 1))

z2 = TEST2[,c('pred_dif_dum_loc3_24', 'hum_24_sq_tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'hi_24'
               ,'tem_in_loc3', 'tem_coil_loc3', 'dif', 'dif_24', 'coil_pred_loc3_24', 'dif_out_24', 'tem_pred_loc3_24', 'hum_pred_loc3_24', 'pred_dif_loc3_24')]


dtrain = xgb.DMatrix(data = as.matrix(z), label= as.integer(TRAIN2$target))
dtest = xgb.DMatrix(data = as.matrix(z2), label= as.integer(TEST2$target))

params = list(booster = "gbtree", objective = "binary:logistic", eta=0.01, gamma=0, max_depth=15, min_child_weight=1, subsample=1, colsample_bytree=1)
xgb_plant2_loc3_24h = xgb.train(params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_48d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant2_loc3_24h, dtest)
## k = xgb.importance(feature_names=colnames(dtest), model = xgb_plant2_loc2_24h)
## g12 =xgb.ggplot.importance(k)
library(caret)
confusionMatrix(as.factor(ifelse(y_pred > 0.5, 1, 0)), as.factor(TEST2$target))

```

# plant2 48시간 후 결로 예측 모델

## p2 loc1_48h
```{r p2_loc1_48h}
dataset3 = plant2_1
dataset4 = plant2_2

target1 = dataset3[dataset3$mea_ddhr >= '2017-05-03 02:00:00',]$cond_loc1
target2 = dataset4[dataset4$mea_ddhr >= '2018-07-03 02:00:00',]$cond_loc1

dataset_3 = dataset3[1:length(target1),]
dataset_4 = dataset4[1:length(target2),]

dataset = rbind(dataset_3, dataset_4)
target = c(target1, target2)
dataset = dataset[,c(-23)]
dataset = cbind(dataset, target=target) %>% na.omit
SL=sample(1:nrow(dataset),nrow(dataset)*0.9, replace=TRUE)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN
TRAIN2$hum_48_sq_tem_48 = TRAIN2$hum_48 ** 2 * TRAIN2$tem_48
TRAIN2$summer_1_hum_48 = TRAIN2$summer_1 * TRAIN2$hum_48
TRAIN2$summer_0_hum_48 = TRAIN2$summer_0 * TRAIN2$hum_48
TRAIN2$summer_0_tem_48_sq = TRAIN2$summer_0 * TRAIN2$tem_48 ** 2
TRAIN2$wd_48_n_hum_48_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_s_hum_48_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_w_hum_48_ws_48 = TRAIN2$wd_48_w * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_n_hum_48_summer_0_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0
TRAIN2$wd_48_s_hum_48_summer_0_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0

TRAIN2$hum_48_sq_tem_48 = TRAIN2$hum_48 ** 2 * TRAIN2$tem_48
TRAIN2$tem_in_loc1_sq_tem_48 = TRAIN2$tem_in_loc1 ** 2 * TRAIN2$tem_48
TRAIN2$tem_pred_loc1_48 = predict(xgb_plant2_tem_in_loc1_48, 
                                   as.matrix(TRAIN2[,c('hum_48', 'tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48',  'hi_48', 'tem_in_loc1', 'tem_in_loc1_sq_tem_48')]))

TRAIN2$coil_pred_loc1_48 = predict(xgb_plant2_tem_coil_loc1_48, 
                                    as.matrix(TRAIN2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48', 'tem_in_loc1', 'tem_in_loc1_sq_tem_48', 'tem_coil_loc1',
                                                        'tem_pred_loc1_48')]))
TRAIN2$dif_48 = TRAIN2$coil_pred_loc1_48 - dew_point(TRAIN2$tem_48, TRAIN2$hum_48)
TRAIN2$dif_out_48 = TRAIN2$tem_coil_loc1 - dew_point(TRAIN2$tem_out_loc1, TRAIN2$hum_out_loc1)
TRAIN2$tem_pred_loc1_48 = predict(xgb_plant2_tem_in_loc1_48, 
                                   as.matrix(TRAIN2[,c('hum_48', 'tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'hi_48', 'tem_in_loc1', 'tem_in_loc1_sq_tem_48')]))


TRAIN2$hum_pred_loc1_48 = predict(xgb_plant2_hum_in_loc1_48, 
                                   as.matrix(TRAIN2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'hi_48', 'summer_0', 'summer_1_hum_48',
                                                       'summer_0_hum_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48')]))
TRAIN2$pred_dif_loc1_48 = TRAIN2$coil_pred_loc1_48 - dew_point(TRAIN2$tem_pred_loc1_48, TRAIN2$hum_pred_loc1_48)
TRAIN2$pred_dif_dum_loc1_48 = as.integer(ifelse(TRAIN2$pred_dif_loc1_48 > 0.99, 0, 1))

z = TRAIN2[,c('pred_dif_dum_loc1_48', 'hum_48_sq_tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'hi_48'
               ,'tem_in_loc1', 'tem_coil_loc1', 'dif', 'dif_48', 'coil_pred_loc1_48', 'dif_out_48', 'tem_pred_loc1_48', 'hum_pred_loc1_48', 'pred_dif_loc1_48')]

TEST2 = TEST
TEST2$hum_48_sq_tem_48 = TEST2$hum_48 ** 2 * TEST2$tem_48
TEST2$summer_1_hum_48 = TEST2$summer_1 * TEST2$hum_48
TEST2$summer_0_hum_48 = TEST2$summer_0 * TEST2$hum_48
TEST2$summer_0_tem_48_sq = TEST2$summer_0 * TEST2$tem_48 ** 2
TEST2$wd_48_n_hum_48_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_s_hum_48_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_w_hum_48_ws_48 = TEST2$wd_48_w * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_n_hum_48_summer_0_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0
TEST2$wd_48_s_hum_48_summer_0_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0

TEST2$hum_48_sq_tem_48 = TEST2$hum_48 ** 2 * TEST2$tem_48
TEST2$tem_in_loc1_sq_tem_48 = TEST2$tem_in_loc1 ** 2 * TEST2$tem_48
TEST2$tem_pred_loc1_48 = predict(xgb_plant2_tem_in_loc1_48, 
                                   as.matrix(TEST2[,c('hum_48', 'tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48',  'hi_48', 'tem_in_loc1', 'tem_in_loc1_sq_tem_48')]))

TEST2$coil_pred_loc1_48 = predict(xgb_plant2_tem_coil_loc1_48, 
                                   as.matrix(TEST2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48', 'tem_in_loc1', 'tem_in_loc1_sq_tem_48', 'tem_coil_loc1',
                                                      'tem_pred_loc1_48')]))
TEST2$dif_48 = TEST2$coil_pred_loc1_48 - dew_point(TEST2$tem_48, TEST2$hum_48)
TEST2$dif_out_48 = TEST2$tem_coil_loc1 - dew_point(TEST2$tem_out_loc1, TEST2$hum_out_loc1)
TEST2$tem_pred_loc1_48 = predict(xgb_plant2_tem_in_loc1_48, 
                                  as.matrix(TEST2[,c('hum_48', 'tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'hi_48', 'tem_in_loc1', 'tem_in_loc1_sq_tem_48')]))


TEST2$hum_pred_loc1_48 = predict(xgb_plant2_hum_in_loc1_48, 
                                  as.matrix(TEST2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'hi_48', 'summer_0', 'summer_1_hum_48',
                                                     'summer_0_hum_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48')]))
TEST2$pred_dif_loc1_48 = TEST2$coil_pred_loc1_48 - dew_point(TEST2$tem_pred_loc1_48, TEST2$hum_pred_loc1_48)
TEST2$pred_dif_dum_loc1_48 = as.integer(ifelse(TEST2$pred_dif_loc1_48 > 0.99, 0, 1))

z2 = TEST2[,c('pred_dif_dum_loc1_48', 'hum_48_sq_tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'hi_48'
               ,'tem_in_loc1', 'tem_coil_loc1', 'dif', 'dif_48', 'coil_pred_loc1_48', 'dif_out_48', 'tem_pred_loc1_48', 'hum_pred_loc1_48', 'pred_dif_loc1_48')]


dtrain = xgb.DMatrix(data = as.matrix(z), label= as.integer(TRAIN2$target))
dtest = xgb.DMatrix(data = as.matrix(z2), label= as.integer(TEST2$target))

params = list(booster = "gbtree", objective = "binary:logistic", eta=0.01, gamma=0, max_depth=15, min_child_weight=1, subsample=1, colsample_bytree=1)
xgb_plant2_loc1_48h = xgb.train(params = params, data = dtrain, nrounds = 1000, nfold = 3, shows_48d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant2_loc1_48h, dtest)
## k = xgb.importance(feature_names=colnames(dtest), model = xgb_plant2_loc1_48h)
## g14 = xgb.ggplot.importance(k)
library(caret)
confusionMatrix(as.factor(ifelse(y_pred > 0.5, 1, 0)), as.factor(TEST2$target))

```

## p2 loc2_48h
```{r p2_loc2_48h}

dataset3 = plant2_1
dataset4 = plant2_2

target1 = dataset3[dataset3$mea_ddhr >= '2017-05-03 02:00:00',]$cond_loc2
target2 = dataset4[dataset4$mea_ddhr >= '2018-07-03 02:00:00',]$cond_loc2

dataset_3 = dataset3[1:length(target1),]
dataset_4 = dataset4[1:length(target2),]

dataset = rbind(dataset_3, dataset_4)
target = c(target1, target2)
dataset = dataset[,c(-23)]
dataset = cbind(dataset, target=target) %>% na.omit
SL=sample(1:nrow(dataset),nrow(dataset)*0.9, replace=TRUE)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN
TRAIN2$hum_48_sq_tem_48 = TRAIN2$hum_48 ** 2 * TRAIN2$tem_48
TRAIN2$summer_1_hum_48 = TRAIN2$summer_1 * TRAIN2$hum_48
TRAIN2$summer_0_hum_48 = TRAIN2$summer_0 * TRAIN2$hum_48
TRAIN2$summer_0_tem_48_sq = TRAIN2$summer_0 * TRAIN2$tem_48 ** 2
TRAIN2$wd_48_n_hum_48_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_s_hum_48_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_w_hum_48_ws_48 = TRAIN2$wd_48_w * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_n_hum_48_summer_0_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0
TRAIN2$wd_48_s_hum_48_summer_0_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0

TRAIN2$hum_48_sq_tem_48 = TRAIN2$hum_48 ** 2 * TRAIN2$tem_48
TRAIN2$tem_in_loc2_sq_tem_48 = TRAIN2$tem_in_loc2 ** 2 * TRAIN2$tem_48
TRAIN2$tem_pred_loc2_48 = predict(xgb_plant2_tem_in_loc2_48, 
                                   as.matrix(TRAIN2[,c('hum_48', 'tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48',  'hi_48', 'tem_in_loc2', 'tem_in_loc2_sq_tem_48')]))

TRAIN2$coil_pred_loc2_48 = predict(xgb_plant2_tem_coil_loc2_48, 
                                    as.matrix(TRAIN2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48', 'tem_in_loc2', 'tem_in_loc2_sq_tem_48', 'tem_coil_loc2',
                                                        'tem_pred_loc2_48')]))
TRAIN2$dif_48 = TRAIN2$coil_pred_loc2_48 - dew_point(TRAIN2$tem_48, TRAIN2$hum_48)
TRAIN2$dif_out_48 = TRAIN2$tem_coil_loc2 - dew_point(TRAIN2$tem_out_loc1, TRAIN2$hum_out_loc1)
TRAIN2$tem_pred_loc2_48 = predict(xgb_plant2_tem_in_loc2_48, 
                                   as.matrix(TRAIN2[,c('hum_48', 'tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'hi_48', 'tem_in_loc2', 'tem_in_loc2_sq_tem_48')]))


TRAIN2$hum_pred_loc2_48 = predict(xgb_plant2_hum_in_loc2_48, 
                                   as.matrix(TRAIN2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'hi_48', 'summer_1', 'summer_0', 'summer_1_hum_48',
                                                       'summer_0_hum_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48')]))
TRAIN2$pred_dif_loc2_48 = TRAIN2$coil_pred_loc2_48 - dew_point(TRAIN2$tem_pred_loc2_48, TRAIN2$hum_pred_loc2_48)
TRAIN2$pred_dif_dum_loc2_48 = as.integer(ifelse(TRAIN2$pred_dif_loc2_48 > 0.99, 0, 1))

z = TRAIN2[,c('pred_dif_dum_loc2_48', 'hum_48_sq_tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'hi_48'
               ,'tem_in_loc2', 'tem_coil_loc2', 'dif', 'dif_48', 'coil_pred_loc2_48', 'dif_out_48', 'tem_pred_loc2_48', 'hum_pred_loc2_48', 'pred_dif_loc2_48')]

TEST2 = TEST
TEST2$hum_48_sq_tem_48 = TEST2$hum_48 ** 2 * TEST2$tem_48
TEST2$summer_1_hum_48 = TEST2$summer_1 * TEST2$hum_48
TEST2$summer_0_hum_48 = TEST2$summer_0 * TEST2$hum_48
TEST2$summer_0_tem_48_sq = TEST2$summer_0 * TEST2$tem_48 ** 2
TEST2$wd_48_n_hum_48_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_s_hum_48_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_w_hum_48_ws_48 = TEST2$wd_48_w * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_n_hum_48_summer_0_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0
TEST2$wd_48_s_hum_48_summer_0_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0

TEST2$hum_48_sq_tem_48 = TEST2$hum_48 ** 2 * TEST2$tem_48
TEST2$tem_in_loc2_sq_tem_48 = TEST2$tem_in_loc2 ** 2 * TEST2$tem_48
TEST2$tem_pred_loc2_48 = predict(xgb_plant2_tem_in_loc2_48, 
                                   as.matrix(TEST2[,c('hum_48', 'tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48',  'hi_48', 'tem_in_loc2', 'tem_in_loc2_sq_tem_48')]))

TEST2$coil_pred_loc2_48 = predict(xgb_plant2_tem_coil_loc2_48, 
                                   as.matrix(TEST2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48', 'tem_in_loc2', 'tem_in_loc2_sq_tem_48', 'tem_coil_loc2',
                                                      'tem_pred_loc2_48')]))
TEST2$dif_48 = TEST2$coil_pred_loc2_48 - dew_point(TEST2$tem_48, TEST2$hum_48)
TEST2$dif_out_48 = TEST2$tem_coil_loc2 - dew_point(TEST2$tem_out_loc1, TEST2$hum_out_loc1)
TEST2$tem_pred_loc2_48 = predict(xgb_plant2_tem_in_loc2_48, 
                                  as.matrix(TEST2[,c('hum_48', 'tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'hi_48', 'tem_in_loc2', 'tem_in_loc2_sq_tem_48')]))


TEST2$hum_pred_loc2_48 = predict(xgb_plant2_hum_in_loc2_48, 
                                  as.matrix(TEST2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'hi_48', 'summer_1', 'summer_0', 'summer_1_hum_48',
                                                     'summer_0_hum_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48')]))
TEST2$pred_dif_loc2_48 = TEST2$coil_pred_loc2_48 - dew_point(TEST2$tem_pred_loc2_48, TEST2$hum_pred_loc2_48)
TEST2$pred_dif_dum_loc2_48 = as.integer(ifelse(TEST2$pred_dif_loc2_48 > 0.99, 0, 1))



z2 = TEST2[,c('pred_dif_dum_loc2_48', 'hum_48_sq_tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'hi_48'
               ,'tem_in_loc2', 'tem_coil_loc2', 'dif', 'dif_48', 'coil_pred_loc2_48', 'dif_out_48', 'tem_pred_loc2_48', 'hum_pred_loc2_48', 'pred_dif_loc2_48')]


dtrain = xgb.DMatrix(data = as.matrix(z), label= as.integer(TRAIN2$target))
dtest = xgb.DMatrix(data = as.matrix(z2), label= as.integer(TEST2$target))

params = list(booster = "gbtree", objective = "binary:logistic", eta=0.01, gamma=0, max_depth=15, min_child_weight=1, subsample=1, colsample_bytree=1)
xgb_plant2_loc2_48h = xgb.train(params = params, data = dtrain, nrounds = 1000, nfold = 3, shows_48d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant2_loc2_48h, dtest)
## k = xgb.importance(feature_names=colnames(dtest), model = xgb_plant2_48h)
## g15 = xgb.ggplot.importance(k)
library(caret)
confusionMatrix(as.factor(ifelse(y_pred > 0.5, 1, 0)), as.factor(TEST2$target))

```

## p2 loc3_48h
```{r p2_loc3_48h}

dataset3 = plant2_1
dataset4 = plant2_2

target1 = dataset3[dataset3$mea_ddhr >= '2017-05-03 02:00:00',]$cond_loc3
target2 = dataset4[dataset4$mea_ddhr >= '2018-07-03 02:00:00',]$cond_loc3

dataset_3 = dataset3[1:length(target1),]
dataset_4 = dataset4[1:length(target2),]

dataset = rbind(dataset_3, dataset_4)
target = c(target1, target2)
dataset = dataset[,c(-23)]
dataset = cbind(dataset, target=target) %>% na.omit
SL=sample(1:nrow(dataset),nrow(dataset)*0.9, replace=TRUE)
TRAIN=dataset[SL,]
TEST=dataset[-SL,]

TRAIN2 = TRAIN
TRAIN2$hum_48_sq_tem_48 = TRAIN2$hum_48 ** 2 * TRAIN2$tem_48
TRAIN2$summer_1_hum_48 = TRAIN2$summer_1 * TRAIN2$hum_48
TRAIN2$summer_0_hum_48 = TRAIN2$summer_0 * TRAIN2$hum_48
TRAIN2$summer_0_tem_48_sq = TRAIN2$summer_0 * TRAIN2$tem_48 ** 2
TRAIN2$wd_48_n_hum_48_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_s_hum_48_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_w_hum_48_ws_48 = TRAIN2$wd_48_w * TRAIN2$hum_48 * TRAIN2$ws_48
TRAIN2$wd_48_n_hum_48_summer_0_ws_48 = TRAIN2$wd_48_n * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0
TRAIN2$wd_48_s_hum_48_summer_0_ws_48 = TRAIN2$wd_48_s * TRAIN2$hum_48 * TRAIN2$ws_48 * TRAIN2$summer_0

TRAIN2$hum_48_sq_tem_48 = TRAIN2$hum_48 ** 2 * TRAIN2$tem_48
TRAIN2$tem_in_loc3_sq_tem_48 = TRAIN2$tem_in_loc3 ** 2 * TRAIN2$tem_48
TRAIN2$tem_pred_loc3_48 = predict(xgb_plant2_tem_in_loc3_48, 
                                   as.matrix(TRAIN2[,c('hum_48', 'tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48',  'hi_48', 'tem_in_loc3', 'tem_in_loc3_sq_tem_48')]))

TRAIN2$coil_pred_loc3_48 = predict(xgb_plant2_tem_coil_loc3_48, 
                                    as.matrix(TRAIN2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48', 'tem_in_loc3', 'tem_in_loc3_sq_tem_48', 'tem_coil_loc3',
                                                        'tem_pred_loc3_48')]))
TRAIN2$dif_48 = TRAIN2$coil_pred_loc3_48 - dew_point(TRAIN2$tem_48, TRAIN2$hum_48)
TRAIN2$dif_out_48 = TRAIN2$tem_coil_loc3 - dew_point(TRAIN2$tem_out_loc1, TRAIN2$hum_out_loc1)
TRAIN2$tem_pred_loc3_48 = predict(xgb_plant2_tem_in_loc3_48, 
                                   as.matrix(TRAIN2[,c('hum_48', 'tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'hi_48', 'tem_in_loc3', 'tem_in_loc3_sq_tem_48')]))


TRAIN2$hum_pred_loc3_48 = predict(xgb_plant2_hum_in_loc3_48, 
                                   as.matrix(TRAIN2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'hi_48', 'summer_1', 'summer_0', 'summer_1_hum_48',
                                                       'summer_0_hum_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48')]))
TRAIN2$pred_dif_loc3_48 = TRAIN2$coil_pred_loc3_48 - dew_point(TRAIN2$tem_pred_loc3_48, TRAIN2$hum_pred_loc3_48)
TRAIN2$pred_dif_dum_loc3_48 = as.integer(ifelse(TRAIN2$pred_dif_loc3_48 > 0.99, 0, 1))

z = TRAIN2[,c('pred_dif_dum_loc3_48', 'hum_48_sq_tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'hi_48'
               ,'tem_in_loc3', 'tem_coil_loc3', 'dif', 'dif_48', 'coil_pred_loc3_48', 'dif_out_48', 'tem_pred_loc3_48', 'hum_pred_loc3_48', 'pred_dif_loc3_48')]

TEST2 = TEST
TEST2$hum_48_sq_tem_48 = TEST2$hum_48 ** 2 * TEST2$tem_48
TEST2$summer_1_hum_48 = TEST2$summer_1 * TEST2$hum_48
TEST2$summer_0_hum_48 = TEST2$summer_0 * TEST2$hum_48
TEST2$summer_0_tem_48_sq = TEST2$summer_0 * TEST2$tem_48 ** 2
TEST2$wd_48_n_hum_48_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_s_hum_48_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_w_hum_48_ws_48 = TEST2$wd_48_w * TEST2$hum_48 * TEST2$ws_48
TEST2$wd_48_n_hum_48_summer_0_ws_48 = TEST2$wd_48_n * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0
TEST2$wd_48_s_hum_48_summer_0_ws_48 = TEST2$wd_48_s * TEST2$hum_48 * TEST2$ws_48 * TEST2$summer_0

TEST2$hum_48_sq_tem_48 = TEST2$hum_48 ** 2 * TEST2$tem_48
TEST2$tem_in_loc3_sq_tem_48 = TEST2$tem_in_loc3 ** 2 * TEST2$tem_48
TEST2$tem_pred_loc3_48 = predict(xgb_plant2_tem_in_loc3_48, 
                                   as.matrix(TEST2[,c('hum_48', 'tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48',  'hi_48', 'tem_in_loc3', 'tem_in_loc3_sq_tem_48')]))
                                   
TEST2$coil_pred_loc3_48 = predict(xgb_plant2_tem_coil_loc3_48, 
                                   as.matrix(TEST2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48', 'tem_in_loc3', 'tem_in_loc3_sq_tem_48', 'tem_coil_loc3',
                                                      'tem_pred_loc3_48')]))
TEST2$dif_48 = TEST2$coil_pred_loc3_48 - dew_point(TEST2$tem_48, TEST2$hum_48)
TEST2$dif_out_48 = TEST2$tem_coil_loc3 - dew_point(TEST2$tem_out_loc1, TEST2$hum_out_loc1)
TEST2$tem_pred_loc3_48 = predict(xgb_plant2_tem_in_loc3_48, 
                                  as.matrix(TEST2[,c('hum_48', 'tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'hi_48', 'tem_in_loc3', 'tem_in_loc3_sq_tem_48')]))


TEST2$hum_pred_loc3_48 = predict(xgb_plant2_hum_in_loc3_48, 
                                  as.matrix(TEST2[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'hi_48', 'summer_1', 'summer_0', 'summer_1_hum_48',
                                                     'summer_0_hum_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48')]))
TEST2$pred_dif_loc3_48 = TEST2$coil_pred_loc3_48 - dew_point(TEST2$tem_pred_loc3_48, TEST2$hum_pred_loc3_48)
TEST2$pred_dif_dum_loc3_48 = as.integer(ifelse(TEST2$pred_dif_loc3_48 > 0.99, 0, 1))

z2 = TEST2[,c('pred_dif_dum_loc3_48', 'hum_48_sq_tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'hi_48'
               ,'tem_in_loc3', 'tem_coil_loc3', 'dif', 'dif_48', 'coil_pred_loc3_48', 'dif_out_48', 'tem_pred_loc3_48', 'hum_pred_loc3_48', 'pred_dif_loc3_48')]

              
dtrain = xgb.DMatrix(data = as.matrix(z), label= as.integer(TRAIN2$target))
dtest = xgb.DMatrix(data = as.matrix(z2), label= as.integer(TEST2$target))

params = list(booster = "gbtree", objective = "binary:logistic", eta=0.01, gamma=0, max_depth=15, min_child_weight=1, subsample=1, colsample_bytree=1)
xgb_plant2_loc3_48h = xgb.train(params = params, data = dtrain, nrounds = 1000, nfold = 5, shows_48d = T, stratified = T, maximize = F)
y_pred = predict(xgb_plant2_loc3_48h, dtest)
## k = xgb.importance(feature_names=colnames(dtest), model = xgb_plant2_loc3_48h)
## g16 = xgb.ggplot.importance(k)
library(caret)
confusionMatrix(as.factor(ifelse(y_pred > 0.5, 1, 0)), as.factor(TEST2$target))
```

# test data 결로 예측
```{r test}
songac_tem_test = read.csv("C:/Users/todtj/OneDrive/바탕 화면/본선/본선/test_tem.csv")
names(songac_tem_test) = c('day', 'hour', 'lag', 'value')

songac_hum_test = read.csv("C:/Users/todtj/OneDrive/바탕 화면/본선/본선/test_hum.csv")
names(songac_hum_test) = c('day', 'hour', 'lag', 'value')

songac_rainprob_test = read.csv("C:/Users/todtj/OneDrive/바탕 화면/본선/본선/test_rainprob.csv")
names(songac_rainprob_test) = c('day', 'hour', 'lag', 'value')

songac_ws_test = read.csv("C:/Users/todtj/OneDrive/바탕 화면/본선/본선/test_ws.csv")
names(songac_ws_test) = c('day', 'hour', 'lag', 'value')

songac_wd_test = read.csv("C:/Users/todtj/OneDrive/바탕 화면/본선/본선/test_wd.csv")
names(songac_wd_test) = c('day', 'hour', 'lag', 'value')


songac_hum_24 = songac_hum_test[songac_hum_test$lag == 16,] %>% na.omit()
songac_tem_24 = songac_tem_test[songac_tem_test$lag == 16,] %>% na.omit()
songac_rainprob_24 = songac_rainprob_test[songac_rainprob_test$lag == 16,] %>% na.omit()
songac_ws_24 = songac_ws_test[songac_ws_test$lag == 16,] %>% na.omit()
songac_wd_24 = songac_wd_test[songac_wd_test$lag == 16,] %>% na.omit()

songac_hum_48 = songac_hum_test[songac_hum_test$lag == 40,] %>% na.omit()
songac_tem_48 = songac_tem_test[songac_tem_test$lag == 40,] %>% na.omit()
songac_rainprob_48 = songac_rainprob_test[songac_rainprob_test$lag == 40,] %>% na.omit()
songac_ws_48 = songac_ws_test[songac_ws_test$lag == 40,] %>% na.omit()
songac_wd_48 = songac_wd_test[songac_wd_test$lag == 40,] %>% na.omit()

songac_test = cbind(songac_hum_24, 
                         tem_24 = songac_tem_24$value, 
                         rainprob_24 = songac_rainprob_24$value,
                         ws_24 = songac_ws_24$value,
                         wd_24 = songac_wd_24$value,
                         hum_48 = songac_hum_48$value, 
                         tem_48 = songac_tem_48$value, 
                         rainprob_48 = songac_rainprob_48$value,
                         ws_48 = songac_ws_48$value,
                         wd_48 = songac_wd_48$value)

library(lubridate)

start_date = as.Date('2019-03-31')
z2 = apply(songac_test, 2, as.numeric)
z2 = as.data.frame(z2)
z2$day = as.numeric(rep(1:366, each=8))
y = sapply(z2$day,function(x) start_date + ddays(x))
z2$date = ymd(as.Date(y, origin='1970-01-01'), tz='Asia/Seoul')
z2$hour = z2$hour / 100
y = mapply(function(date, hour) date + dhours(hour), z2$date, z2$hour)
z2$mea_ddhr = as.POSIXct(y, origin='1970-01-01')
z2$date_point = as.POSIXct(y, origin='1970-01-01')
y = mapply(function(date, lag) date + dhours(lag), z2$mea_ddhr, z2$lag)
z2$mea_ddhr = as.POSIXct(y, origin='1970-01-01')
z2 = cbind(mea_ddhr = z2$mea_ddhr, 
                tem_24 = z2$tem_24, 
                hum_24 = z2$value,
                rainprob_24 = z2$rainprob_24,
                ws_24 = z2$ws_24,
                wd_24 = z2$wd_24,
                tem_48 = z2$tem_48, 
                hum_48 = z2$hum_48,
                rainprob_48 = z2$rainprob_48,
                ws_48 = z2$ws_48,
                wd_48 = z2$wd_48,
                point = z2$date_point)

plant_test_1 = read.csv("C:/Users/todtj/OneDrive/바탕 화면/본선/본선/plant_test.csv")
plant_test = read.csv("C:/Users/todtj/OneDrive/바탕 화면/본선/본선/plant_test.csv")
plant_test = plant_test[, c(-1)]

before = names(plant_test)
after = vector()
for (i in 1:12){
  after = c(after, strsplit(before, "plant_test.")[[i]][2])
}

names(plant_test) = after
plant_test$mea_ddhr = ymd_hm(plant_test$mea_ddhr, tz='Asia/Seoul')
plant_test$hour = as.factor(mapply(hour, plant_test$mea_ddhr))
plant_test$day = as.factor(mapply(day, plant_test$mea_ddhr))
plant_test$month = as.factor(mapply(month, plant_test$mea_ddhr))
plant_test$year = as.factor(mapply(year, plant_test$mea_ddhr))
plant_test$x24h_tma = ymd_hm(plant_test$x24h_tma, tz='Asia/Seoul')
plant_test$x48h_tma = ymd_hm(plant_test$x48h_tma, tz='Asia/Seoul')
plant_test

ts = seq(as.POSIXct("2019-04-01 00:00:00", tz = 'Asia/Seoul'),
          as.POSIXct("2020-03-31 19:30:00", tz = 'Asia/Seoul'),
          by = "30 min")
ts = data.frame(ts)
test_merged = merge(ts, z2, by.x='ts', by.y='point', all.x=T)

test_merged$hum_24 = na.interp(test_merged$hum_24)
test_merged$tem_24 = na.interp(test_merged$tem_24)
test_merged$rainprob_24 = na.interp(test_merged$rainprob_24)
test_merged$ws_24 = na.interp(test_merged$ws_24)
test_merged$wd_24 = na.interp(test_merged$wd_24)
test_merged$hum_48 = na.interp(test_merged$hum_48)
test_merged$tem_48 = na.interp(test_merged$tem_48)
test_merged$rainprob_48 = na.interp(test_merged$rainprob_48)
test_merged$ws_48 = na.interp(test_merged$ws_48)
test_merged$wd_48 = na.interp(test_merged$wd_48)
final_set = merge(plant_test, test_merged, by.x='mea_ddhr', by.y='ts', all.x=T)


final_set$wd_24 = ifelse(final_set$wd_24 >= 0 & final_set$wd_24 <45, 'North',
                          ifelse(final_set$wd_24 >= 315 & final_set$wd_24 <= 360, 'North',
                                 ifelse(final_set$wd_24 >= 45 & final_set$wd_24 < 135, 'East',
                                        ifelse(final_set$wd_24 >= 135 & final_set$wd_24 < 225, 'South',
                                               ifelse(final_set$wd_24 >= 225 & final_set$wd_24 < 315, 'West', 'What')))))

final_set$wd_48 = ifelse(final_set$wd_48 >= 0 & final_set$wd_48 <45, 'North',
                          ifelse(final_set$wd_48 >= 315 & final_set$wd_48 <= 360, 'North',
                                 ifelse(final_set$wd_48 >= 45 & final_set$wd_48 < 135, 'East',
                                        ifelse(final_set$wd_48 >= 135 & final_set$wd_48 < 225, 'South',
                                               ifelse(final_set$wd_48 >= 225 & final_set$wd_48 < 315, 'West', 'What')))))

final_set = final_set %>% transform( 
  wd_24_n = ifelse (final_set$wd_24 == 'North', 1, 0),
  wd_24_e = ifelse (final_set$wd_24 == 'East', 1, 0),
  wd_24_s = ifelse (final_set$wd_24 == 'South', 1, 0),
  wd_24_w = ifelse (final_set$wd_24 == 'West', 1, 0))

final_set = final_set %>% transform( 
  wd_48_n = ifelse (final_set$wd_48 == 'North', 1, 0),
  wd_48_e = ifelse (final_set$wd_48 == 'East', 1, 0),
  wd_48_s = ifelse (final_set$wd_48 == 'South', 1, 0),
  wd_48_w = ifelse (final_set$wd_48 == 'West', 1, 0))


final_set = final_set %>% transform( 
  summer_1 = ifelse (final_set$tem_in_loc3 > 20 , 1, 0),
  summer_0 = ifelse (final_set$tem_in_loc3<= 20, 1, 0),
  time_0 = ifelse (final_set$tem_in_loc3 >20, 1, 0),
  time_1 = ifelse (final_set$hour %in% c(9, 10, 11, 12, 13, 14, 15, 16, 17), 1, 0),
  time_2 = ifelse (final_set$hour %in% c(18, 19, 20, 21, 22, 23, 34), 1, 0))


HI = function(tem, hum){
  -42.379 + 2.04901523 * tem + 10.14333127 * hum - 
    0.22475541 * tem * hum - 6.83783 * 10 ** (-3) * tem ** 2 - 5.481717 * 10 ** (-2) * hum ** 2 +
    1.22874 * 10 ** (-3) * tem ** 2 * hum + 8.5282 * 10 ** (-4) * tem * hum ** 2 -
    1.99 * 10 ** (-6) * tem ** (2) * hum ** (2)
}

final_set$hi_24 = mapply(HI, final_set$tem_24, final_set$hum_24)
final_set$hi_48 = mapply(HI, final_set$tem_48, final_set$hum_48)

dew_point = function(temp,hum){
  a = 243.12*(log(hum/100)+ (17.62*temp)/(243.12+temp))
  b = 17.62-(log(hum/100) + (17.62*temp)/(243.12+temp))
  return(a/b)
}

final_set$dif = final_set$tem_coil - mapply(dew_point, final_set[,c('tem_in')], final_set[,c('hum_in')])
#####################################

z = final_set[1,]

boxbox = function(i){
  box = c()
  if (i['plant'] == 1 & i['loc'] == 1){
    i = dplyr::rename(i, tem_in_loc1 = tem_in, hum_in_loc1 = hum_in, tem_coil_loc1 = tem_coil)
    
    i$hum_24_sq_tem_24 = i$hum_24 ** 2 * i$tem_24
    i$summer_1_hum_24 = i$summer_1 * i$hum_24
    i$summer_0_hum_24 = i$summer_0 * i$hum_24
    i$summer_0_tem_24_sq = i$summer_0 * i$tem_24 ** 2
    i$wd_24_n_hum_24_ws_24 = i$wd_24_n * i$hum_24 * i$ws_24
    i$wd_24_s_hum_24_ws_24 = i$wd_24_s * i$hum_24 * i$ws_24
    i$wd_24_w_hum_24_ws_24 = i$wd_24_w * i$hum_24 * i$ws_24
    i$wd_24_n_hum_24_summer_0_ws_24 = i$wd_24_n * i$hum_24 * i$ws_24 * i$summer_0
    i$wd_24_s_hum_24_summer_0_ws_24 = i$wd_24_s * i$hum_24 * i$ws_24 * i$summer_0
    
    i$hum_24_sq_tem_24 = i$hum_24 ** 2 * i$tem_24
    i$tem_in_loc1_sq_tem_24 = i$tem_in_loc1 ** 2 * i$tem_24
    
    i$coil_pred_loc1_24 = predict(xgb_plant1_tem_coil_loc1_24, 
                                   as.matrix(i[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24', 'tem_in_loc1', 'tem_in_loc1_sq_tem_24', 'tem_coil_loc1')]))
    i$dif_24 = i$coil_pred_loc1_24 - dew_point(i$tem_24, i$hum_24)
    i$dif_out_24 = i$tem_coil_loc1 - dew_point(i$tem_out_loc1, i$hum_out_loc1)
    i$tem_pred_loc1_24 = predict(xgb_plant1_tem_in_loc1_24, 
                                  as.matrix(i[,c('hum_24', 'tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24', 'hi_24', 'tem_in_loc1', 'tem_in_loc1_sq_tem_24')]))
    
    
    i$hum_pred_loc1_24 = predict(xgb_plant1_hum_in_loc1_24, 
                                  as.matrix(i[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24', 'hi_24', 'summer_0', 'summer_1_hum_24',
                                                 'summer_0_hum_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24')]))
    i$pred_dif_loc1_24 = i$coil_pred_loc1_24 - dew_point(i$tem_pred_loc1_24, i$hum_pred_loc1_24)
    i$pred_dif_dum_loc1_24 = as.integer(ifelse(i$pred_dif_loc1_24 > 0.99, 0, 1))
    
    i$hum_48_sq_tem_48 = i$hum_48 ** 2 * i$tem_48
    i$summer_1_hum_48 = i$summer_1 * i$hum_48
    i$summer_0_hum_48 = i$summer_0 * i$hum_48
    i$summer_0_tem_48_sq = i$summer_0 * i$tem_48 ** 2
    i$wd_48_n_hum_48_ws_48 = i$wd_48_n * i$hum_48 * i$ws_48
    i$wd_48_s_hum_48_ws_48 = i$wd_48_s * i$hum_48 * i$ws_48
    i$wd_48_w_hum_48_ws_48 = i$wd_48_w * i$hum_48 * i$ws_48
    i$wd_48_n_hum_48_summer_0_ws_48 = i$wd_48_n * i$hum_48 * i$ws_48 * i$summer_0
    i$wd_48_s_hum_48_summer_0_ws_48 = i$wd_48_s * i$hum_48 * i$ws_48 * i$summer_0
    
    i$hum_48_sq_tem_48 = i$hum_48 ** 2 * i$tem_48
    i$tem_in_loc1_sq_tem_48 = i$tem_in_loc1 ** 2 * i$tem_48
    
    i$coil_pred_loc1_48 = predict(xgb_plant1_tem_coil_loc1_48, 
                                   as.matrix(i[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48', 'tem_in_loc1', 'tem_in_loc1_sq_tem_48', 'tem_coil_loc1')]))
    i$dif_48 = i$coil_pred_loc1_48 - dew_point(i$tem_48, i$hum_48)
    i$dif_out_48 = i$tem_coil_loc1 - dew_point(i$tem_out_loc1, i$hum_out_loc1)
    i$tem_pred_loc1_48 = predict(xgb_plant1_tem_in_loc1_48, 
                                  as.matrix(i[,c('hum_48', 'tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'hi_48', 'tem_in_loc1', 'tem_in_loc1_sq_tem_48')]))
    
    
    i$hum_pred_loc1_48 = predict(xgb_plant1_hum_in_loc1_48, 
                                  as.matrix(i[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'hi_48', 'summer_0', 'summer_1_hum_48',
                                                 'summer_0_hum_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48')]))
    i$pred_dif_loc1_48 = i$coil_pred_loc1_48 - dew_point(i$tem_pred_loc1_48, i$hum_pred_loc1_48)
    i$pred_dif_dum_loc1_48 = as.integer(ifelse(i$pred_dif_loc1_48 > 0.99, 0, 1))
    
    i1 = i[,c('pred_dif_dum_loc1_24', 'hum_24_sq_tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24', 'hi_24'
               ,'tem_in_loc1', 'tem_coil_loc1', 'dif', 'dif_24', 'coil_pred_loc1_24', 'dif_out_24', 'tem_pred_loc1_24', 'hum_pred_loc1_24', 'pred_dif_loc1_24')]
    
    i2 = i[,c('pred_dif_dum_loc1_48', 'hum_48_sq_tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'hi_48'
               ,'tem_in_loc1', 'tem_coil_loc1', 'dif', 'dif_48', 'coil_pred_loc1_48', 'dif_out_48', 'tem_pred_loc1_48', 'hum_pred_loc1_48', 'pred_dif_loc1_48')]
    
    
    result1 = predict(xgb_plant1_loc1_24h, xgb.DMatrix(as.matrix(i1)))
    
    result2 = predict(xgb_plant1_loc1_48h, xgb.DMatrix(as.matrix(i2)))
    
    box = c(result1, result2)
    
  } else if (i['plant'] == 1 & i['loc'] == 2){
    
    i = dplyr::rename(i, tem_in_loc2 = tem_in, hum_in_loc2 = hum_in, tem_coil_loc2 = tem_coil)
    
    i$hum_24_sq_tem_24 = i$hum_24 ** 2 * i$tem_24
    i$summer_1_hum_24 = i$summer_1 * i$hum_24
    i$summer_0_hum_24 = i$summer_0 * i$hum_24
    i$summer_0_tem_24_sq = i$summer_0 * i$tem_24 ** 2
    i$wd_24_n_hum_24_ws_24 = i$wd_24_n * i$hum_24 * i$ws_24
    i$wd_24_s_hum_24_ws_24 = i$wd_24_s * i$hum_24 * i$ws_24
    i$wd_24_w_hum_24_ws_24 = i$wd_24_w * i$hum_24 * i$ws_24
    i$wd_24_n_hum_24_summer_0_ws_24 = i$wd_24_n * i$hum_24 * i$ws_24 * i$summer_0
    i$wd_24_s_hum_24_summer_0_ws_24 = i$wd_24_s * i$hum_24 * i$ws_24 * i$summer_0
    
    i$hum_24_sq_tem_24 = i$hum_24 ** 2 * i$tem_24
    i$tem_in_loc2_sq_tem_24 = i$tem_in_loc2 ** 2 * i$tem_24
    
    i$coil_pred_loc2_24 = predict(xgb_plant1_tem_coil_loc2_24, 
                                   as.matrix(i[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24', 'tem_in_loc2', 'tem_in_loc2_sq_tem_24', 'tem_coil_loc2')]))
    i$dif_24 = i$coil_pred_loc2_24 - dew_point(i$tem_24, i$hum_24)
    i$dif_out_24 = i$tem_coil_loc2 - dew_point(i$tem_out_loc1, i$hum_out_loc1)
    i$tem_pred_loc2_24 = predict(xgb_plant1_tem_in_loc2_24, 
                                  as.matrix(i[,c('hum_24', 'tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'hi_24', 'tem_in_loc2', 'tem_in_loc2_sq_tem_24')]))
    
    i$hum_pred_loc2_24 = predict(xgb_plant1_hum_in_loc2_24, 
                                  as.matrix(i[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'hi_24', 'summer_1', 'summer_0', 'summer_1_hum_24',
                                                 'summer_0_hum_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24')]))
    i$pred_dif_loc2_24 = i$coil_pred_loc2_24 - dew_point(i$tem_pred_loc2_24, i$hum_pred_loc2_24)
    i$pred_dif_dum_loc2_24 = as.integer(ifelse(i$pred_dif_loc2_24 > 0.99, 0, 1))
    
    
    i$hum_48_sq_tem_48 = i$hum_48 ** 2 * i$tem_48
    i$summer_1_hum_48 = i$summer_1 * i$hum_48
    i$summer_0_hum_48 = i$summer_0 * i$hum_48
    i$summer_0_tem_48_sq = i$summer_0 * i$tem_48 ** 2
    i$wd_48_n_hum_48_ws_48 = i$wd_48_n * i$hum_48 * i$ws_48
    i$wd_48_s_hum_48_ws_48 = i$wd_48_s * i$hum_48 * i$ws_48
    i$wd_48_w_hum_48_ws_48 = i$wd_48_w * i$hum_48 * i$ws_48
    i$wd_48_n_hum_48_summer_0_ws_48 = i$wd_48_n * i$hum_48 * i$ws_48 * i$summer_0
    i$wd_48_s_hum_48_summer_0_ws_48 = i$wd_48_s * i$hum_48 * i$ws_48 * i$summer_0
    
    i$hum_48_sq_tem_48 = i$hum_48 ** 2 * i$tem_48
    i$tem_in_loc2_sq_tem_48 = i$tem_in_loc2 ** 2 * i$tem_48
    
    i$coil_pred_loc2_48 = predict(xgb_plant1_tem_coil_loc2_48, 
                                   as.matrix(i[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48', 'tem_in_loc2', 'tem_in_loc2_sq_tem_48', 'tem_coil_loc2')]))
    i$dif_48 = i$coil_pred_loc2_48 - dew_point(i$tem_48, i$hum_48)
    i$dif_out_48 = i$tem_coil_loc2 - dew_point(i$tem_out_loc1, i$hum_out_loc1)
    i$tem_pred_loc2_48 = predict(xgb_plant1_tem_in_loc2_48, 
                                  as.matrix(i[,c('hum_48', 'tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'hi_48', 'tem_in_loc2', 'tem_in_loc2_sq_tem_48')]))
    
    
    i$hum_pred_loc2_48 = predict(xgb_plant1_hum_in_loc2_48, 
                                  as.matrix(i[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'hi_48', 'summer_1', 'summer_0', 'summer_1_hum_48',
                                                 'summer_0_hum_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48')]))
    i$pred_dif_loc2_48 = i$coil_pred_loc2_48 - dew_point(i$tem_pred_loc2_48, i$hum_pred_loc2_48)
    i$pred_dif_dum_loc2_48 = as.integer(ifelse(i$pred_dif_loc2_48 > 0.99, 0, 1))
    
    i1 = i[,c('pred_dif_dum_loc2_24', 'hum_24_sq_tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'hi_24'
               ,'tem_in_loc2', 'tem_coil_loc2', 'dif', 'dif_24', 'coil_pred_loc2_24', 'dif_out_24', 'tem_pred_loc2_24', 'hum_pred_loc2_24', 'pred_dif_loc2_24')]
    
    i2 = i[,c('pred_dif_dum_loc2_48', 'hum_48_sq_tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'hi_48'
               ,'tem_in_loc2', 'tem_coil_loc2', 'dif', 'dif_48', 'coil_pred_loc2_48', 'dif_out_48', 'tem_pred_loc2_48', 'hum_pred_loc2_48', 'pred_dif_loc2_48')]
    
    
    result1 = predict(xgb_plant1_loc2_24h, xgb.DMatrix(as.matrix(i1)))
    
    result2 = predict(xgb_plant1_loc2_48h, xgb.DMatrix(as.matrix(i2)))
    box = c(result1, result2)
  } else if (i['plant'] == 1 & i['loc'] == 3){
    i = dplyr::rename(i, tem_in_loc3 = tem_in, hum_in_loc3 = hum_in, tem_coil_loc3 = tem_coil)
    
    i$hum_24_sq_tem_24 = i$hum_24 ** 2 * i$tem_24
    i$summer_1_hum_24 = i$summer_1 * i$hum_24
    i$summer_0_hum_24 = i$summer_0 * i$hum_24
    i$summer_0_tem_24_sq = i$summer_0 * i$tem_24 ** 2
    i$wd_24_n_hum_24_ws_24 = i$wd_24_n * i$hum_24 * i$ws_24
    i$wd_24_s_hum_24_ws_24 = i$wd_24_s * i$hum_24 * i$ws_24
    i$wd_24_w_hum_24_ws_24 = i$wd_24_w * i$hum_24 * i$ws_24
    i$wd_24_n_hum_24_summer_0_ws_24 = i$wd_24_n * i$hum_24 * i$ws_24 * i$summer_0
    i$wd_24_s_hum_24_summer_0_ws_24 = i$wd_24_s * i$hum_24 * i$ws_24 * i$summer_0
    
    i$hum_24_sq_tem_24 = i$hum_24 ** 2 * i$tem_24
    i$tem_in_loc3_sq_tem_24 = i$tem_in_loc3 ** 2 * i$tem_24
    
    i$coil_pred_loc3_24 = predict(xgb_plant1_tem_coil_loc3_24, 
                                   as.matrix(i[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24', 'tem_in_loc3', 'tem_in_loc3_sq_tem_24', 'tem_coil_loc3')]))
    i$dif_24 = i$coil_pred_loc3_24 - dew_point(i$tem_24, i$hum_24)
    i$dif_out_24 = i$tem_coil_loc3 - dew_point(i$tem_out_loc1, i$hum_out_loc1)
    i$tem_pred_loc3_24 = predict(xgb_plant1_tem_in_loc3_24, 
                                  as.matrix(i[,c('hum_24', 'tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'hi_24', 'tem_in_loc3', 'tem_in_loc3_sq_tem_24')]))
    
    i$hum_pred_loc3_24 = predict(xgb_plant1_hum_in_loc3_24, 
                                  as.matrix(i[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'hi_24', 'summer_1', 'summer_0', 'summer_1_hum_24',
                                                 'summer_0_hum_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24')]))
    i$pred_dif_loc3_24 = i$coil_pred_loc3_24 - dew_point(i$tem_pred_loc3_24, i$hum_pred_loc3_24)
    i$pred_dif_dum_loc3_24 = as.integer(ifelse(i$pred_dif_loc3_24 > 0.99, 0, 1))
    
    i$hum_48_sq_tem_48 = i$hum_48 ** 2 * i$tem_48
    i$summer_1_hum_48 = i$summer_1 * i$hum_48
    i$summer_0_hum_48 = i$summer_0 * i$hum_48
    i$summer_0_tem_48_sq = i$summer_0 * i$tem_48 ** 2
    i$wd_48_n_hum_48_ws_48 = i$wd_48_n * i$hum_48 * i$ws_48
    i$wd_48_s_hum_48_ws_48 = i$wd_48_s * i$hum_48 * i$ws_48
    i$wd_48_w_hum_48_ws_48 = i$wd_48_w * i$hum_48 * i$ws_48
    i$wd_48_n_hum_48_summer_0_ws_48 = i$wd_48_n * i$hum_48 * i$ws_48 * i$summer_0
    i$wd_48_s_hum_48_summer_0_ws_48 = i$wd_48_s * i$hum_48 * i$ws_48 * i$summer_0
    
    i$hum_48_sq_tem_48 = i$hum_48 ** 2 * i$tem_48
    i$tem_in_loc3_sq_tem_48 = i$tem_in_loc3 ** 2 * i$tem_48
    
    i$coil_pred_loc3_48 = predict(xgb_plant1_tem_coil_loc3_48, 
                                   as.matrix(i[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48', 'tem_in_loc3', 'tem_in_loc3_sq_tem_48', 'tem_coil_loc3')]))
    i$dif_48 = i$coil_pred_loc3_48 - dew_point(i$tem_48, i$hum_48)
    i$dif_out_48 = i$tem_coil_loc3 - dew_point(i$tem_out_loc1, i$hum_out_loc1)
    i$tem_pred_loc3_48 = predict(xgb_plant1_tem_in_loc3_48, 
                                  as.matrix(i[,c('hum_48', 'tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'hi_48', 'tem_in_loc3', 'tem_in_loc3_sq_tem_48')]))
    
    
    i$hum_pred_loc3_48 = predict(xgb_plant1_hum_in_loc3_48, 
                                  as.matrix(i[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'hi_48', 'summer_1', 'summer_0', 'summer_1_hum_48',
                                                 'summer_0_hum_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48')]))
    i$pred_dif_loc3_48 = i$coil_pred_loc3_48 - dew_point(i$tem_pred_loc3_48, i$hum_pred_loc3_48)
    i$pred_dif_dum_loc3_48 = as.integer(ifelse(i$pred_dif_loc3_48 > 0.99, 0, 1))
    
    i1 = i[,c('pred_dif_dum_loc3_24', 'hum_24_sq_tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'hi_24'
               ,'tem_in_loc3', 'tem_coil_loc3', 'dif', 'dif_24', 'coil_pred_loc3_24', 'dif_out_24', 'tem_pred_loc3_24', 'hum_pred_loc3_24', 'pred_dif_loc3_24')]
    
    i2 = i[,c('pred_dif_dum_loc3_48', 'hum_48_sq_tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'hi_48'
               ,'tem_in_loc3', 'tem_coil_loc3', 'dif', 'dif_48', 'coil_pred_loc3_48', 'dif_out_48', 'tem_pred_loc3_48', 'hum_pred_loc3_48', 'pred_dif_loc3_48')]
    
    
    result1 = predict(xgb_plant1_loc3_24h, xgb.DMatrix(as.matrix(i1)))
    
    result2 = predict(xgb_plant1_loc3_48h, xgb.DMatrix(as.matrix(i2)))
    box = c(result1, result2)
    
  } else if (i['plant'] == 2 & i['loc'] == 1){
    i = dplyr::rename(i, tem_in_loc1 = tem_in, hum_in_loc1 = hum_in, tem_coil_loc1 = tem_coil)
    
    i$hum_24_sq_tem_24 = i$hum_24 ** 2 * i$tem_24
    i$summer_1_hum_24 = i$summer_1 * i$hum_24
    i$summer_0_hum_24 = i$summer_0 * i$hum_24
    i$summer_0_tem_24_sq = i$summer_0 * i$tem_24 ** 2
    i$wd_24_n_hum_24_ws_24 = i$wd_24_n * i$hum_24 * i$ws_24
    i$wd_24_s_hum_24_ws_24 = i$wd_24_s * i$hum_24 * i$ws_24
    i$wd_24_w_hum_24_ws_24 = i$wd_24_w * i$hum_24 * i$ws_24
    i$wd_24_n_hum_24_summer_0_ws_24 = i$wd_24_n * i$hum_24 * i$ws_24 * i$summer_0
    i$wd_24_s_hum_24_summer_0_ws_24 = i$wd_24_s * i$hum_24 * i$ws_24 * i$summer_0
    
    i$hum_24_sq_tem_24 = i$hum_24 ** 2 * i$tem_24
    i$tem_in_loc1_sq_tem_24 = i$tem_in_loc1 ** 2 * i$tem_24
    
    i$coil_pred_loc1_24 = predict(xgb_plant1_tem_coil_loc1_24, 
                                   as.matrix(i[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24', 'tem_in_loc1', 'tem_in_loc1_sq_tem_24', 'tem_coil_loc1')]))
    i$dif_24 = i$coil_pred_loc1_24 - dew_point(i$tem_24, i$hum_24)
    i$dif_out_24 = i$tem_coil_loc1 - dew_point(i$tem_out_loc1, i$hum_out_loc1)
    i$tem_pred_loc1_24 = predict(xgb_plant1_tem_in_loc1_24, 
                                  as.matrix(i[,c('hum_24', 'tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24', 'hi_24', 'tem_in_loc1', 'tem_in_loc1_sq_tem_24')]))
    
    
    i$hum_pred_loc1_24 = predict(xgb_plant1_hum_in_loc1_24, 
                                  as.matrix(i[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24', 'hi_24', 'summer_0', 'summer_1_hum_24',
                                                 'summer_0_hum_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24')]))
    i$pred_dif_loc1_24 = i$coil_pred_loc1_24 - dew_point(i$tem_pred_loc1_24, i$hum_pred_loc1_24)
    i$pred_dif_dum_loc1_24 = as.integer(ifelse(i$pred_dif_loc1_24 > 0.99, 0, 1))
    
    i$hum_48_sq_tem_48 = i$hum_48 ** 2 * i$tem_48
    i$summer_1_hum_48 = i$summer_1 * i$hum_48
    i$summer_0_hum_48 = i$summer_0 * i$hum_48
    i$summer_0_tem_48_sq = i$summer_0 * i$tem_48 ** 2
    i$wd_48_n_hum_48_ws_48 = i$wd_48_n * i$hum_48 * i$ws_48
    i$wd_48_s_hum_48_ws_48 = i$wd_48_s * i$hum_48 * i$ws_48
    i$wd_48_w_hum_48_ws_48 = i$wd_48_w * i$hum_48 * i$ws_48
    i$wd_48_n_hum_48_summer_0_ws_48 = i$wd_48_n * i$hum_48 * i$ws_48 * i$summer_0
    i$wd_48_s_hum_48_summer_0_ws_48 = i$wd_48_s * i$hum_48 * i$ws_48 * i$summer_0
    
    i$hum_48_sq_tem_48 = i$hum_48 ** 2 * i$tem_48
    i$tem_in_loc1_sq_tem_48 = i$tem_in_loc1 ** 2 * i$tem_48
    
    i$coil_pred_loc1_48 = predict(xgb_plant1_tem_coil_loc1_48, 
                                   as.matrix(i[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48', 'tem_in_loc1', 'tem_in_loc1_sq_tem_48', 'tem_coil_loc1')]))
    i$dif_48 = i$coil_pred_loc1_48 - dew_point(i$tem_48, i$hum_48)
    i$dif_out_48 = i$tem_coil_loc1 - dew_point(i$tem_out_loc1, i$hum_out_loc1)
    i$tem_pred_loc1_48 = predict(xgb_plant1_tem_in_loc1_48, 
                                  as.matrix(i[,c('hum_48', 'tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'hi_48', 'tem_in_loc1', 'tem_in_loc1_sq_tem_48')]))
    
    
    i$hum_pred_loc1_48 = predict(xgb_plant1_hum_in_loc1_48, 
                                  as.matrix(i[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'hi_48', 'summer_0', 'summer_1_hum_48',
                                                 'summer_0_hum_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48')]))
    i$pred_dif_loc1_48 = i$coil_pred_loc1_48 - dew_point(i$tem_pred_loc1_48, i$hum_pred_loc1_48)
    i$pred_dif_dum_loc1_48 = as.integer(ifelse(i$pred_dif_loc1_48 > 0.99, 0, 1))
    
    i1 = i[,c('pred_dif_dum_loc1_24', 'hum_24_sq_tem_24', 'hum_in_loc1', 'rainprob_24', 'ws_24', 'hi_24'
               ,'tem_in_loc1', 'tem_coil_loc1', 'dif', 'dif_24', 'coil_pred_loc1_24', 'dif_out_24', 'tem_pred_loc1_24', 'hum_pred_loc1_24', 'pred_dif_loc1_24')]
    
    i2 = i[,c('pred_dif_dum_loc1_48', 'hum_48_sq_tem_48', 'hum_in_loc1', 'rainprob_48', 'ws_48', 'hi_48'
               ,'tem_in_loc1', 'tem_coil_loc1', 'dif', 'dif_48', 'coil_pred_loc1_48', 'dif_out_48', 'tem_pred_loc1_48', 'hum_pred_loc1_48', 'pred_dif_loc1_48')]
    
    
    result1 = predict(xgb_plant2_loc1_24h, xgb.DMatrix(as.matrix(i1)))
    
    result2 = predict(xgb_plant2_loc1_48h, xgb.DMatrix(as.matrix(i2)))
    
    box = c(result1, result2)
    
  } else if (i['plant'] == 2 & i['loc'] == 2){
    
    i = dplyr::rename(i, tem_in_loc2 = tem_in, hum_in_loc2 = hum_in, tem_coil_loc2 = tem_coil)
    
    i$hum_24_sq_tem_24 = i$hum_24 ** 2 * i$tem_24
    i$summer_1_hum_24 = i$summer_1 * i$hum_24
    i$summer_0_hum_24 = i$summer_0 * i$hum_24
    i$summer_0_tem_24_sq = i$summer_0 * i$tem_24 ** 2
    i$wd_24_n_hum_24_ws_24 = i$wd_24_n * i$hum_24 * i$ws_24
    i$wd_24_s_hum_24_ws_24 = i$wd_24_s * i$hum_24 * i$ws_24
    i$wd_24_w_hum_24_ws_24 = i$wd_24_w * i$hum_24 * i$ws_24
    i$wd_24_n_hum_24_summer_0_ws_24 = i$wd_24_n * i$hum_24 * i$ws_24 * i$summer_0
    i$wd_24_s_hum_24_summer_0_ws_24 = i$wd_24_s * i$hum_24 * i$ws_24 * i$summer_0
    
    i$hum_24_sq_tem_24 = i$hum_24 ** 2 * i$tem_24
    i$tem_in_loc2_sq_tem_24 = i$tem_in_loc2 ** 2 * i$tem_24
    
    i$coil_pred_loc2_24 = predict(xgb_plant1_tem_coil_loc2_24, 
                                   as.matrix(i[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24', 'tem_in_loc2', 'tem_in_loc2_sq_tem_24', 'tem_coil_loc2')]))
    i$dif_24 = i$coil_pred_loc2_24 - dew_point(i$tem_24, i$hum_24)
    i$dif_out_24 = i$tem_coil_loc2 - dew_point(i$tem_out_loc1, i$hum_out_loc1)
    i$tem_pred_loc2_24 = predict(xgb_plant1_tem_in_loc2_24, 
                                  as.matrix(i[,c('hum_24', 'tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'hi_24', 'tem_in_loc2', 'tem_in_loc2_sq_tem_24')]))
    
    i$hum_pred_loc2_24 = predict(xgb_plant1_hum_in_loc2_24, 
                                  as.matrix(i[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'hi_24', 'summer_1', 'summer_0', 'summer_1_hum_24',
                                                 'summer_0_hum_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24')]))
    i$pred_dif_loc2_24 = i$coil_pred_loc2_24 - dew_point(i$tem_pred_loc2_24, i$hum_pred_loc2_24)
    i$pred_dif_dum_loc2_24 = as.integer(ifelse(i$pred_dif_loc2_24 > 0.99, 0, 1))
    
    
    i$hum_48_sq_tem_48 = i$hum_48 ** 2 * i$tem_48
    i$summer_1_hum_48 = i$summer_1 * i$hum_48
    i$summer_0_hum_48 = i$summer_0 * i$hum_48
    i$summer_0_tem_48_sq = i$summer_0 * i$tem_48 ** 2
    i$wd_48_n_hum_48_ws_48 = i$wd_48_n * i$hum_48 * i$ws_48
    i$wd_48_s_hum_48_ws_48 = i$wd_48_s * i$hum_48 * i$ws_48
    i$wd_48_w_hum_48_ws_48 = i$wd_48_w * i$hum_48 * i$ws_48
    i$wd_48_n_hum_48_summer_0_ws_48 = i$wd_48_n * i$hum_48 * i$ws_48 * i$summer_0
    i$wd_48_s_hum_48_summer_0_ws_48 = i$wd_48_s * i$hum_48 * i$ws_48 * i$summer_0
    
    i$hum_48_sq_tem_48 = i$hum_48 ** 2 * i$tem_48
    i$tem_in_loc2_sq_tem_48 = i$tem_in_loc2 ** 2 * i$tem_48
    
    i$coil_pred_loc2_48 = predict(xgb_plant1_tem_coil_loc2_48, 
                                   as.matrix(i[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48', 'tem_in_loc2', 'tem_in_loc2_sq_tem_48', 'tem_coil_loc2')]))
    i$dif_48 = i$coil_pred_loc2_48 - dew_point(i$tem_48, i$hum_48)
    i$dif_out_48 = i$tem_coil_loc2 - dew_point(i$tem_out_loc1, i$hum_out_loc1)
    i$tem_pred_loc2_48 = predict(xgb_plant1_tem_in_loc2_48, 
                                  as.matrix(i[,c('hum_48', 'tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'hi_48', 'tem_in_loc2', 'tem_in_loc2_sq_tem_48')]))
    
    
    i$hum_pred_loc2_48 = predict(xgb_plant1_hum_in_loc2_48, 
                                  as.matrix(i[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'hi_48', 'summer_1', 'summer_0', 'summer_1_hum_48',
                                                 'summer_0_hum_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48')]))
    i$pred_dif_loc2_48 = i$coil_pred_loc2_48 - dew_point(i$tem_pred_loc2_48, i$hum_pred_loc2_48)
    i$pred_dif_dum_loc2_48 = as.integer(ifelse(i$pred_dif_loc2_48 > 0.99, 0, 1))
    
    i1 = i[,c('pred_dif_dum_loc2_24', 'hum_24_sq_tem_24', 'hum_in_loc2', 'rainprob_24', 'ws_24', 'hi_24'
               ,'tem_in_loc2', 'tem_coil_loc2', 'dif', 'dif_24', 'coil_pred_loc2_24', 'dif_out_24', 'tem_pred_loc2_24', 'hum_pred_loc2_24', 'pred_dif_loc2_24')]
    
    i2 = i[,c('pred_dif_dum_loc2_48', 'hum_48_sq_tem_48', 'hum_in_loc2', 'rainprob_48', 'ws_48', 'hi_48'
               ,'tem_in_loc2', 'tem_coil_loc2', 'dif', 'dif_48', 'coil_pred_loc2_48', 'dif_out_48', 'tem_pred_loc2_48', 'hum_pred_loc2_48', 'pred_dif_loc2_48')]
    
    
    result1 = predict(xgb_plant2_loc2_24h, xgb.DMatrix(as.matrix(i1)))
    
    result2 = predict(xgb_plant2_loc2_48h, xgb.DMatrix(as.matrix(i2)))
    box = c(result1, result2)
    
  } else if (i['plant'] == 2 & i['loc'] == 3){
    i = dplyr::rename(i, tem_in_loc3 = tem_in, hum_in_loc3 = hum_in, tem_coil_loc3 = tem_coil)
    
    i$hum_24_sq_tem_24 = i$hum_24 ** 2 * i$tem_24
    i$summer_1_hum_24 = i$summer_1 * i$hum_24
    i$summer_0_hum_24 = i$summer_0 * i$hum_24
    i$summer_0_tem_24_sq = i$summer_0 * i$tem_24 ** 2
    i$wd_24_n_hum_24_ws_24 = i$wd_24_n * i$hum_24 * i$ws_24
    i$wd_24_s_hum_24_ws_24 = i$wd_24_s * i$hum_24 * i$ws_24
    i$wd_24_w_hum_24_ws_24 = i$wd_24_w * i$hum_24 * i$ws_24
    i$wd_24_n_hum_24_summer_0_ws_24 = i$wd_24_n * i$hum_24 * i$ws_24 * i$summer_0
    i$wd_24_s_hum_24_summer_0_ws_24 = i$wd_24_s * i$hum_24 * i$ws_24 * i$summer_0
    
    i$hum_24_sq_tem_24 = i$hum_24 ** 2 * i$tem_24
    i$tem_in_loc3_sq_tem_24 = i$tem_in_loc3 ** 2 * i$tem_24
    
    i$coil_pred_loc3_24 = predict(xgb_plant1_tem_coil_loc3_24, 
                                   as.matrix(i[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24', 'tem_in_loc3', 'tem_in_loc3_sq_tem_24', 'tem_coil_loc3')]))
    i$dif_24 = i$coil_pred_loc3_24 - dew_point(i$tem_24, i$hum_24)
    i$dif_out_24 = i$tem_coil_loc3 - dew_point(i$tem_out_loc1, i$hum_out_loc1)
    i$tem_pred_loc3_24 = predict(xgb_plant1_tem_in_loc3_24, 
                                  as.matrix(i[,c('hum_24', 'tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'hi_24', 'tem_in_loc3', 'tem_in_loc3_sq_tem_24')]))
    
    i$hum_pred_loc3_24 = predict(xgb_plant1_hum_in_loc3_24, 
                                  as.matrix(i[,c('hum_24', 'tem_24', 'hum_24_sq_tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'hi_24', 'summer_1', 'summer_0', 'summer_1_hum_24',
                                                 'summer_0_hum_24', 'time_1','summer_0_tem_24_sq','wd_24_n_hum_24_ws_24', 'wd_24_w_hum_24_ws_24')]))
    i$pred_dif_loc3_24 = i$coil_pred_loc3_24 - dew_point(i$tem_pred_loc3_24, i$hum_pred_loc3_24)
    i$pred_dif_dum_loc3_24 = as.integer(ifelse(i$pred_dif_loc3_24 > 0.99, 0, 1))
    
    i$hum_48_sq_tem_48 = i$hum_48 ** 2 * i$tem_48
    i$summer_1_hum_48 = i$summer_1 * i$hum_48
    i$summer_0_hum_48 = i$summer_0 * i$hum_48
    i$summer_0_tem_48_sq = i$summer_0 * i$tem_48 ** 2
    i$wd_48_n_hum_48_ws_48 = i$wd_48_n * i$hum_48 * i$ws_48
    i$wd_48_s_hum_48_ws_48 = i$wd_48_s * i$hum_48 * i$ws_48
    i$wd_48_w_hum_48_ws_48 = i$wd_48_w * i$hum_48 * i$ws_48
    i$wd_48_n_hum_48_summer_0_ws_48 = i$wd_48_n * i$hum_48 * i$ws_48 * i$summer_0
    i$wd_48_s_hum_48_summer_0_ws_48 = i$wd_48_s * i$hum_48 * i$ws_48 * i$summer_0
    
    i$hum_48_sq_tem_48 = i$hum_48 ** 2 * i$tem_48
    i$tem_in_loc3_sq_tem_48 = i$tem_in_loc3 ** 2 * i$tem_48
    
    i$coil_pred_loc3_48 = predict(xgb_plant1_tem_coil_loc3_48, 
                                   as.matrix(i[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48', 'tem_in_loc3', 'tem_in_loc3_sq_tem_48', 'tem_coil_loc3')]))
    i$dif_48 = i$coil_pred_loc3_48 - dew_point(i$tem_48, i$hum_48)
    i$dif_out_48 = i$tem_coil_loc3 - dew_point(i$tem_out_loc1, i$hum_out_loc1)
    i$tem_pred_loc3_48 = predict(xgb_plant1_tem_in_loc3_48, 
                                  as.matrix(i[,c('hum_48', 'tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'hi_48', 'tem_in_loc3', 'tem_in_loc3_sq_tem_48')]))
    
    
    i$hum_pred_loc3_48 = predict(xgb_plant1_hum_in_loc3_48, 
                                  as.matrix(i[,c('hum_48', 'tem_48', 'hum_48_sq_tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'hi_48', 'summer_1', 'summer_0', 'summer_1_hum_48',
                                                 'summer_0_hum_48', 'time_1','summer_0_tem_48_sq','wd_48_n_hum_48_ws_48', 'wd_48_w_hum_48_ws_48')]))
    i$pred_dif_loc3_48 = i$coil_pred_loc3_48 - dew_point(i$tem_pred_loc3_48, i$hum_pred_loc3_48)
    i$pred_dif_dum_loc3_48 = as.integer(ifelse(i$pred_dif_loc3_48 > 0.99, 0, 1))
    
    i1 = i[,c('pred_dif_dum_loc3_24', 'hum_24_sq_tem_24', 'hum_in_loc3', 'rainprob_24', 'ws_24', 'hi_24'
               ,'tem_in_loc3', 'tem_coil_loc3', 'dif', 'dif_24', 'coil_pred_loc3_24', 'dif_out_24', 'tem_pred_loc3_24', 'hum_pred_loc3_24', 'pred_dif_loc3_24')]
    
    i2 = i[,c('pred_dif_dum_loc3_48', 'hum_48_sq_tem_48', 'hum_in_loc3', 'rainprob_48', 'ws_48', 'hi_48'
               ,'tem_in_loc3', 'tem_coil_loc3', 'dif', 'dif_48', 'coil_pred_loc3_48', 'dif_out_48', 'tem_pred_loc3_48', 'hum_pred_loc3_48', 'pred_dif_loc3_48')]
    
    
    result1 = predict(xgb_plant2_loc3_24h, xgb.DMatrix(as.matrix(i1)))
    
    result2 = predict(xgb_plant2_loc3_48h, xgb.DMatrix(as.matrix(i2)))
    box = c(result1, result2)
  }
  return(box)
}

k = rbind(z, z)

first = c()
second = c()

for (i in 1:nrow(final_set)){
  k = boxbox(final_set[i,])
  first = c(first, k[1])
  second = c(second, k[2])
  if (i %% 10 == 0){
    print(i)
  }
}



result = data.frame(plant_test.x24h_cond_loc = round(first, 2) * 100, plant_test.x48h_cond_loc = round(second, 2) * 100)

result = data.frame(plant_test.x24h_cond_loc = ifelse(result$plant_test.x24h_cond_loc > 50, 1, 0),
                     plant_test.x24h_cond_loc_prob = result$plant_test.x24h_cond_loc,
                     plant_test.x48h_cond_loc = ifelse(result$plant_test.x48h_cond_loc > 50, 1, 0),
                     plant_test.x48h_cond_loc_prob = result$plant_test.x48h_cond_loc)


write.csv(result, 'C:/Users/pogr1/Desktop/result.csv', row.names=FALSE)
```